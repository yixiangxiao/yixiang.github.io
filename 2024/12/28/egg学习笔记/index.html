<!DOCTYPE html>
<html>
<script>
  (function (i, s, o, g, r, a, m) { i["DaoVoiceObject"] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; a.charset = "utf-8"; m.parentNode.insertBefore(a, m) })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/c7dbfb59.js", "daovoice")
  daovoice('init', {
    app_id: "c7dbfb59"
  });
  daovoice('update');
</script>

<script src="//code.tidio.co/wt4o25kuyzlabgclxciy4d95cgiuozaj.js" async></script>

<head>
  <meta charset="utf-8">
  
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="dns-prefetch" href="http://yixiangxiao.github.io">
    <title>
      
        egg学习笔记 | 
            yixiangxiao
    </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
          <meta name="description" content="安装egg我们推荐直接使用脚手架，只需几条简单指令，即可快速生成项目（npm &gt;&#x3D;6.1.0）: 123mkdir egg-example &amp;&amp; cd egg-examplenpm init egg --type&#x3D;simplenpm i  启动项目: 12npm run devopen http:&#x2F;&#x2F;localhost:7001      目录结">
<meta property="og:type" content="article">
<meta property="og:title" content="egg学习笔记">
<meta property="og:url" content="http://yixiangxiao.github.io/2024/12/28/egg%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="yixiangxiao">
<meta property="og:description" content="安装egg我们推荐直接使用脚手架，只需几条简单指令，即可快速生成项目（npm &gt;&#x3D;6.1.0）: 123mkdir egg-example &amp;&amp; cd egg-examplenpm init egg --type&#x3D;simplenpm i  启动项目: 12npm run devopen http:&#x2F;&#x2F;localhost:7001      目录结">
<meta property="og:locale">
<meta property="article:published_time" content="2024-12-28T13:56:52.000Z">
<meta property="article:modified_time" content="2025-02-12T13:03:31.201Z">
<meta property="article:author" content="yixiang xiao">
<meta property="article:tag" content="egg">
<meta name="twitter:card" content="summary">
            
              <link rel="alternative" href="/atom.xml" title="yixiangxiao"
                type="application/atom+xml">
              
                
                  <link rel="icon" href="/favicon.ico">
                  
                    
                      <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
                      
                        <link rel="stylesheet" type="text/css" href="/./main.a5fda8.css">
                          <style type="text/css">
                            #container.show {
                              background: linear-gradient(200deg,#a0cfe4,#e8c37e);
                            }
                          </style>
                          

                            

                              
                                
                                  <script src="/lib/clickLove.js"></script>
                                  
                                    


                                      
                                        <script src="/lib/pace.min.js"></script>
                                        <link
                                          href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css"
                                          rel="stylesheet">
                                        



</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
	
		
			<div class="overlay"
				style="background: #4d4d4d;background: url('/img/biubiubiu.gif') no-repeat ;">
			</div>
			<div class="intrude-less">
				<header id="header" class="inner">
					<a href="/" class="profilepic">
						<img src="/img/head.png" class="js-avatar">
					</a>
					<hgroup>
						<h1 class="header-author"><a href="/">
								yixiang xiao
							</a></h1>
					</hgroup>
					

							<nav class="header-menu">
								<ul>
									
										<li><a href="/" target="_blank">主页</a></li>
										
										<li><a href="/tags" target="_blank">标签</a></li>
										
										<li><a href="/categories" target="_blank">分类</a></li>
										
										<li><a href="/archives" target="_blank">归档</a></li>
										
										<li><a href="https://yixiangxiao.github.io/categories/作品/" target="_blank">作品</a></li>
										
										<li><a href="https://yixiangxiao.github.io/cv-master/dist/index.html" target="_blank">个人简历</a></li>
										
										<li><a href="https://yixiangxiao.github.io/donghua/public/index.html" target="_blank">动态简历</a></li>
										
										<li><a href="https://yixiangxiao.github.io/categories/web%E5%89%8D%E7%AB%AF/" target="_blank">web前端</a></li>
										
								</ul>
							</nav>
							<nav class="header-smart-menu">
								
									
										<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">
											所有文章
										</a>
										
											
									
										<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">
											友链
										</a>
										
											
									
										<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">
											关于我
										</a>
										
											
							</nav>
							<nav class="header-nav">
								<div class="social">
									
										
											<a class="github" href="https://github.com/yixiangxiao"
												title="GitHub"
												target="_blank"><i
														class="icon-github"></i></a>
											
												
										
											<a class="gitee" href="https://gitee.com/xiao-yixiang"
												title="码云"
												target="_blank"><i
														class="icon-gitee"></i></a>
											
												
										
											<a class="cnblog" href="https://www.cnblogs.com/xiaoyixiang/"
												title="博客园"
												target="_blank"><i
														class="icon-cnblog"></i></a>
											
												
										
											<a class="blog" href="/yixiangxiao.github.io"
												title="博客"
												target="_blank"><i
														class="icon-blog"></i></a>
											
												
										
											<a class="csdn" href="https://blog.csdn.net/xycy123_com?spm=1010.2135.3001.5343&type=blog"
												title="CSDN"
												target="_blank"><i
														class="icon-csdn"></i></a>
											
												
										
											<a class="zhihu" href="https://www.zhihu.com/people/xue-ying-huan-ri/posts"
												title="知乎"
												target="_blank"><i
														class="icon-zhihu"></i></a>
											
												
										
											<a class="qq" href="/img/qq.jpg"
												title="QQ"
												target="_blank"><i
														class="icon-qq"></i></a>
											
												
										
											<a class="weixin" href="/img/weixin.jpg"
												title="微信"
												target="_blank"><i
														class="icon-weixin"></i></a>
											
												
										
											<a class="mail" href="mailto:2324094523@qq.com"
												title="邮件联系"
												target="_blank"><i
														class="icon-mail"></i></a>
											
												
								</div>
								
									
										
											
												
													<div>
														<iframe frameborder="no" border="0" marginwidth="0"
															marginheight="0" width="240"
															height="86"
															src="//music.163.com/outchain/player?type=2&id=1302694460&auto=1&height=66"></iframe>
													</div>
													
														
															<p style="font-size: 12px;">
																来首音乐，放松一下吧！
																	<p>
																		
																			
																				<div id="he-plugin-standard"></div>
																				<script>
																					WIDGET = {
																						"CONFIG": {
																							"layout": "2",
																							"width": 230,
																							"height": 270,
																							"background": "1",
																							"dataColor": "FFFFFF",
																							"borderRadius": "5",
																							"key": "888ee8fbda5e46dc83b30e4d3f09c057"
																						}
																					}
																				</script>
																				<script
																					src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

																				<script type="text/javascript"
																					id="clstr_globe"
																					src="//clustrmaps.com/globe.js?d=ZPRTQnjDB7jh9cM5F7egULV5veALMSkBynVu8GRJVRs"></script>
							</nav>
				</header>
			</div>
    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
      
      <a class="forkMe" style="position:absolute;z-index:999;top:0;right:0.5em;" 
        href="https://github.com/yixiangxiao/yixiangxiao.github.io" target="_blank">
        <img src="/img/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
      
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<a href="/">
					<img src="/img/head.png" class="js-avatar">
				</a>
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">yixiang xiao</h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
				
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						
						<a class="github" target="_blank" 
							href="https://github.com/yixiangxiao" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="gitee" target="_blank" 
							href="https://gitee.com/xiao-yixiang" title="码云"><i class="icon-gitee"></i></a>
						
					
						
						<a class="cnblog" target="_blank" 
							href="https://www.cnblogs.com/xiaoyixiang/" title="博客园"><i class="icon-cnblog"></i></a>
						
					
						
						<a class="blog" target="_blank" 
							href="/yixiangxiao.github.io" title="博客"><i class="icon-blog"></i></a>
						
					
						
						<a class="csdn" target="_blank" 
							href="https://blog.csdn.net/xycy123_com?spm=1010.2135.3001.5343&type=blog" title="CSDN"><i class="icon-csdn"></i></a>
						
					
						
						<a class="zhihu" target="_blank" 
							href="https://www.zhihu.com/people/xue-ying-huan-ri/posts" title="知乎"><i class="icon-zhihu"></i></a>
						
					
						
						<a class="qq" target="_blank" 
							href="/img/qq.jpg" title="QQ"><i class="icon-qq"></i></a>
						
					
						
						<a class="weixin" target="_blank" 
							href="/img/weixin.jpg" title="微信"><i class="icon-weixin"></i></a>
						
					
						
						<a class="mail" target="_blank" 
							href="mailto:2324094523@qq.com" title="邮件联系"><i class="icon-mail"></i></a>
						
					
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 12.5%"><a href="/">主页</a></li>
		        
					<li style="width: 12.5%"><a href="/tags">标签</a></li>
		        
					<li style="width: 12.5%"><a href="/categories">分类</a></li>
		        
					<li style="width: 12.5%"><a href="/archives">归档</a></li>
		        
					<li style="width: 12.5%"><a href="https://yixiangxiao.github.io/categories/作品/">作品</a></li>
		        
					<li style="width: 12.5%"><a href="https://yixiangxiao.github.io/cv-master/dist/index.html">个人简历</a></li>
		        
					<li style="width: 12.5%"><a href="https://yixiangxiao.github.io/donghua/public/index.html">动态简历</a></li>
		        
					<li style="width: 12.5%"><a href="https://yixiangxiao.github.io/categories/web%E5%89%8D%E7%AB%AF/">web前端</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1"
              class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-egg学习笔记"
  class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class=" article-header">
        
  
    <h1 class="article-title" itemprop="name">
      egg学习笔记
    </h1>
  


          
            
        
        <span id="busuanzi_container_page_pv" style='display:none' class="archive-article-date">
              <i class="icon-smile icon"></i> 阅读数：<span id="busuanzi_value_page_pv"></span>次
        </span>

<a href="/2024/12/28/egg%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="archive-article-date">
        <time datetime="2024-12-28T13:56:52.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2024-12-28</time>
</a>

              
                
                  
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">14.1k字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">68分</span>
    </span>
  </span>
</div>


                    
      </header>
      
        <div class="article-entry" itemprop="articleBody">
          
                    <h1 id="安装egg"><a href="#安装egg" class="headerlink" title="安装egg"></a>安装egg</h1><p>我们推荐直接使用脚手架，只需几条简单指令，即可快速生成项目（<code>npm &gt;=6.1.0</code>）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir egg-example &amp;&amp; cd egg-example</span><br><span class="line">npm init egg --type&#x3D;simple</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure>

<p>启动项目:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line">open http:&#x2F;&#x2F;localhost:7001</span><br></pre></td></tr></table></figure>





<h1 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">egg-project</span><br><span class="line">├── package.json</span><br><span class="line">├── app.js (可选)</span><br><span class="line">├── agent.js (可选)</span><br><span class="line">├── app（-----------核心------------）</span><br><span class="line">|   ├── router.js（路由）</span><br><span class="line">│   ├── controller（控制器）</span><br><span class="line">│   |   └── home.js</span><br><span class="line">│   ├── service (模型)</span><br><span class="line">│   |   └── user.js</span><br><span class="line">│   ├── middleware (中间件)</span><br><span class="line">│   |   └── response_time.js</span><br><span class="line">│   ├── schedule (可选)</span><br><span class="line">│   |   └── my_task.js</span><br><span class="line">│   ├── public (静态资源)</span><br><span class="line">│   |   └── reset.css</span><br><span class="line">│   ├── view (模板视图)</span><br><span class="line">│   |   └── home.tpl</span><br><span class="line">│   └── extend (扩展)</span><br><span class="line">│       ├── helper.js (可选)</span><br><span class="line">│       ├── request.js (可选)</span><br><span class="line">│       ├── response.js (可选)</span><br><span class="line">│       ├── context.js (可选)</span><br><span class="line">│       ├── application.js (可选)</span><br><span class="line">│       └── agent.js (可选)</span><br><span class="line">├── config</span><br><span class="line">|   ├── plugin.js</span><br><span class="line">|   ├── config.default.js</span><br><span class="line">│   ├── config.prod.js</span><br><span class="line">|   ├── config.test.js (可选)</span><br><span class="line">|   ├── config.local.js (可选)</span><br><span class="line">|   └── config.unittest.js (可选)</span><br><span class="line">└── test</span><br><span class="line">    ├── middleware</span><br><span class="line">    |   └── response_time.test.js</span><br><span class="line">    └── controller</span><br><span class="line">        └── home.test.js</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="路由相关"><a href="#路由相关" class="headerlink" title="路由相关"></a>路由相关</h1><h2 id="1-get传值"><a href="#1-get传值" class="headerlink" title="1. get传值"></a>1. get传值</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line">router.get(<span class="string">&#x27;/admin/:id&#x27;</span>, controller.admin.index);</span><br><span class="line"></span><br><span class="line"><span class="comment">// controller</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取路由get传值参数（路由:id）</span></span><br><span class="line">    ctx.params;</span><br><span class="line">    <span class="comment">// 获取url的问号get传值参数</span></span><br><span class="line">    ctx.query;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4种配置方法"><a href="#2-4种配置方法" class="headerlink" title="2. 4种配置方法"></a>2. 4种配置方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.verb(<span class="string">&#x27;path-match&#x27;</span>, app.controller.action);</span><br><span class="line">router.verb(<span class="string">&#x27;router-name&#x27;</span>, <span class="string">&#x27;path-match&#x27;</span>, app.controller.action);<span class="comment">// 第一个参数可以给name</span></span><br><span class="line">router.verb(<span class="string">&#x27;path-match&#x27;</span>, middleware1, ..., middlewareN, app.controller.action);</span><br><span class="line">router.verb(<span class="string">&#x27;router-name&#x27;</span>, <span class="string">&#x27;path-match&#x27;</span>, middleware1, ..., middlewareN, app.controller.action);</span><br></pre></td></tr></table></figure>



<h1 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h1><h2 id="1-ctx"><a href="#1-ctx" class="headerlink" title="1. ctx"></a>1. ctx</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.ctx.status = <span class="number">301</span>; <span class="comment">// 把重定向改为301</span></span><br><span class="line">    <span class="built_in">this</span>.ctx.redirect(<span class="string">&#x27;/admin/add&#x27;</span>); <span class="comment">// 默认临时重定向 302</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-路由重定向"><a href="#2-路由重定向" class="headerlink" title="2. 路由重定向"></a>2. 路由重定向</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.router.redirect(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;/home/index&#x27;</span>, <span class="number">302</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-路由分组"><a href="#3-路由分组" class="headerlink" title="3.路由分组"></a>3.路由分组</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/news&#x27;</span>)(app);</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/admin&#x27;</span>)(app);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/news.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.router.get(<span class="string">&#x27;/news/list&#x27;</span>, app.controller.news.list);</span><br><span class="line">  app.router.get(<span class="string">&#x27;/news/detail&#x27;</span>, app.controller.news.detail);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/admin.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.router.get(<span class="string">&#x27;/admin/user&#x27;</span>, app.controller.admin.user);</span><br><span class="line">  app.router.get(<span class="string">&#x27;/admin/log&#x27;</span>, app.controller.admin.log);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h1 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h1><h2 id="自定义-Controller-基类"><a href="#自定义-Controller-基类" class="headerlink" title="自定义 Controller 基类"></a>自定义 Controller 基类</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/core/base_controller.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; Controller &#125; = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">user</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.ctx.session.user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">success</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.ctx.body = &#123;</span><br><span class="line">      success: <span class="literal">true</span>,</span><br><span class="line">      data,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">notFound</span>(<span class="params">msg</span>)</span> &#123;</span><br><span class="line">    msg = msg || <span class="string">&#x27;not found&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.ctx.throw(<span class="number">404</span>, msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = BaseController;</span><br></pre></td></tr></table></figure>



<p>此时在编写应用的 Controller 时，可以继承 BaseController，直接使用基类上的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app/controller/post.js</span></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">&#x27;../core/base_controller&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">list</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> posts = <span class="keyword">await</span> <span class="built_in">this</span>.service.listByUser(<span class="built_in">this</span>.user);</span><br><span class="line">    <span class="built_in">this</span>.success(posts);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h1><h2 id="1-安装和使用ejs"><a href="#1-安装和使用ejs" class="headerlink" title="1. 安装和使用ejs"></a>1. 安装和使用ejs</h2><h3 id="（1）安装："><a href="#（1）安装：" class="headerlink" title="（1）安装："></a>（1）安装：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i egg-view-ejs --save</span><br></pre></td></tr></table></figure>

<h3 id="（2）配置：-config"><a href="#（2）配置：-config" class="headerlink" title="（2）配置：/config"></a>（2）配置：/config</h3><p>config/config.default.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">appInfo</span> =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    config.view = &#123;</span><br><span class="line">        mapping: &#123;</span><br><span class="line">            <span class="string">&#x27;.html&#x27;</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">	...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>config/plugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">// 配置ejs</span></span><br><span class="line">    ejs: &#123;</span><br><span class="line">        enable: <span class="literal">true</span>,</span><br><span class="line">        package: <span class="string">&#x27;egg-view-ejs&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="（3）使用"><a href="#（3）使用" class="headerlink" title="（3）使用"></a>（3）使用</h3><p>app/controller</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="built_in">this</span>;</span><br><span class="line">    <span class="comment">// 渲染变量</span></span><br><span class="line">    <span class="keyword">let</span> msg = <span class="string">&quot;测试内容&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">    <span class="comment">// 渲染模板（render需要加await）</span></span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">        msg,</span><br><span class="line">        list</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>app/view/index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--渲染变量--&gt;</span></span><br><span class="line">    &lt;%=msg%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;% for(var i=0; i &lt; list.length; i++)&#123; %&gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    &lt;%=list[i]%&gt;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &lt;% &#125; %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--加载 app/public 下的资源文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/public/images/find.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="服务（模型）"><a href="#服务（模型）" class="headerlink" title="服务（模型）"></a>服务（模型）</h1><p>控制器调用 <code>home</code> 模型的 <code>ceshi</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.service.home.ceshi();</span><br></pre></td></tr></table></figure>

<p>模型之间相互调用（同上）</p>
<h1 id="模型和数据库"><a href="#模型和数据库" class="headerlink" title="模型和数据库"></a>模型和数据库</h1><h2 id="配置和创建迁移文件"><a href="#配置和创建迁移文件" class="headerlink" title="配置和创建迁移文件"></a>配置和创建迁移文件</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol>
<li>安装并配置<a target="_blank" rel="noopener" href="https://github.com/eggjs/egg-sequelize">egg-sequelize</a>插件（它会辅助我们将定义好的 Model 对象加载到 app 和 ctx 上）和<a target="_blank" rel="noopener" href="https://github.com/sidorares/node-mysql2">mysql2</a>模块：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save egg-sequelize mysql2</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在<code>config/plugin.js</code>中引入 egg-sequelize 插件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exports.sequelize &#x3D; &#123;</span><br><span class="line">  enable: true,</span><br><span class="line">  package: &#39;egg-sequelize&#39;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在<code>config/config.default.js</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">config.sequelize = &#123;</span><br><span class="line">    dialect:  <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    host:  <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    username: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password:  <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    port:  <span class="number">3306</span>,</span><br><span class="line">    database:  <span class="string">&#x27;friends&#x27;</span>,</span><br><span class="line">    <span class="comment">// 中国时区</span></span><br><span class="line">    timezone:  <span class="string">&#x27;+08:00&#x27;</span>,</span><br><span class="line">    define: &#123;</span><br><span class="line">        <span class="comment">// 取消数据表名复数</span></span><br><span class="line">        freezeTableName: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 自动写入时间戳 created_at updated_at</span></span><br><span class="line">        timestamps: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 字段生成软删除时间戳 deleted_at</span></span><br><span class="line">        paranoid: <span class="literal">true</span>,</span><br><span class="line">        createdAt: <span class="string">&#x27;created_at&#x27;</span>,</span><br><span class="line">        updatedAt: <span class="string">&#x27;updated_at&#x27;</span>,</span><br><span class="line">        deletedAt: <span class="string">&#x27;deleted_at&#x27;</span>,</span><br><span class="line">        <span class="comment">// 所有驼峰命名格式化</span></span><br><span class="line">        underscored: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>sequelize 提供了<a target="_blank" rel="noopener" href="https://github.com/sequelize/cli">sequelize-cli</a>工具来实现<a target="_blank" rel="noopener" href="http://docs.sequelizejs.com/manual/tutorial/migrations.html">Migrations</a>，我们也可以在 egg 项目中引入 sequelize-cli。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev sequelize-cli</span><br></pre></td></tr></table></figure>

<ol start="5">
<li> egg 项目中，我们希望将所有数据库 Migrations 相关的内容都放在<code>database</code>目录下，所以我们在项目根目录下新建一个<code>.sequelizerc</code>配置文件：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  config: path.join(__dirname, <span class="string">&#x27;database/config.json&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;migrations-path&#x27;</span>: path.join(__dirname, <span class="string">&#x27;database/migrations&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;seeders-path&#x27;</span>: path.join(__dirname, <span class="string">&#x27;database/seeders&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;models-path&#x27;</span>: path.join(__dirname, <span class="string">&#x27;app/model&#x27;</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>初始化 Migrations 配置文件和目录</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize init:config</span><br><span class="line">npx sequelize init:migrations</span><br><span class="line"><span class="comment">// npx sequelize init:models</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>行完后会生成<code>database/config.json</code>文件和<code>database/migrations</code>目录，我们修改一下<code>database/config.json</code>中的内容，将其改成我们项目中使用的数据库配置：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;development&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;database&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timezone&quot;</span>: <span class="string">&quot;+08:00&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>创建数据库</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:create</span><br></pre></td></tr></table></figure>

<h3 id="创建数据迁移表"><a href="#创建数据迁移表" class="headerlink" title="创建数据迁移表"></a>创建数据迁移表</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize migration:generate --name=init-users</span><br></pre></td></tr></table></figure>

<p>1.执行完命令后，会在database / migrations / 目录下生成数据表迁移文件，然后定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    up: <span class="keyword">async</span> (queryInterface, Sequelize) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; INTEGER, STRING, DATE, ENUM &#125; = Sequelize;</span><br><span class="line">        <span class="comment">// 创建表</span></span><br><span class="line">        <span class="keyword">await</span> queryInterface.createTable(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">            id: &#123; <span class="attr">type</span>: INTEGER(<span class="number">20</span>).UNSIGNED, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            username: &#123; <span class="attr">type</span>: STRING(<span class="number">30</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户名称&#x27;</span>, <span class="attr">unique</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">            email: &#123; <span class="attr">type</span>: STRING(<span class="number">160</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>,  <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户邮箱&#x27;</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            password: &#123; <span class="attr">type</span>: STRING(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">            avatar_url: &#123; <span class="attr">type</span>: STRING(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">            mobile: &#123; <span class="attr">type</span>: STRING(<span class="number">20</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户手机&#x27;</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            prifix: &#123; <span class="attr">type</span>: STRING(<span class="number">32</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">            abstract: &#123; <span class="attr">type</span>: STRING(<span class="number">255</span>), <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">            role_id:&#123;</span><br><span class="line">                type: INTEGER,</span><br><span class="line">                <span class="comment">//  定义外键（重要）</span></span><br><span class="line">                references: &#123;</span><br><span class="line">                    model: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// 对应表名称（数据表名称）</span></span><br><span class="line">                    key: <span class="string">&#x27;id&#x27;</span> <span class="comment">// 对应表的主键</span></span><br><span class="line">                &#125;,</span><br><span class="line">                onUpdate: <span class="string">&#x27;restrict&#x27;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">                onDelete: <span class="string">&#x27;cascade&#x27;</span>  <span class="comment">// 删除时操作</span></span><br><span class="line">            &#125;,</span><br><span class="line">            gender: &#123; <span class="attr">type</span>: ENUM, <span class="attr">values</span>: [<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;保密&#x27;</span>], <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;男&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户性别&#x27;</span>&#125;,</span><br><span class="line">            created_at: DATE,</span><br><span class="line">            updated_at: DATE</span><br><span class="line">        &#125;, &#123; <span class="attr">engine</span>: <span class="string">&#x27;MYISAM&#x27;</span> &#125;);</span><br><span class="line">        <span class="comment">// 添加索引</span></span><br><span class="line">        queryInterface.addIndex(<span class="string">&#x27;users&#x27;</span>, [<span class="string">&#x27;gender&#x27;</span>]);</span><br><span class="line">        <span class="comment">// 添加唯一索引</span></span><br><span class="line">        queryInterface.addIndex(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">            name: <span class="string">&quot;name&quot;</span>, <span class="comment">// 索引名称</span></span><br><span class="line">            unique: <span class="literal">true</span>, <span class="comment">// 唯一索引</span></span><br><span class="line">            fields: [<span class="string">&#x27;name&#x27;</span>] <span class="comment">// 索引对应字段</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    down: <span class="keyword">async</span> queryInterface =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> queryInterface.dropTable(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行 migrate 进行数据库变更</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 升级数据库</span></span><br><span class="line">npx sequelize db:migrate</span><br><span class="line"><span class="comment"># 如果有问题需要回滚，可以通过 `db:migrate:undo` 回退一个变更</span></span><br><span class="line"><span class="comment"># npx sequelize db:migrate:undo</span></span><br><span class="line"><span class="comment"># 可以通过 `db:migrate:undo:all` 回退到初始状态</span></span><br><span class="line"><span class="comment"># npx sequelize db:migrate:undo:all</span></span><br></pre></td></tr></table></figure>



<h3 id="已创建新增字段"><a href="#已创建新增字段" class="headerlink" title="已创建新增字段"></a>已创建新增字段</h3><p>1.创建迁移文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize migration:generate --name&#x3D;user-addcolumn</span><br></pre></td></tr></table></figure>

<p>2.执行完命令后，会在database / migrations / 目录下生成数据表迁移文件，然后定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.sequelize.transaction(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">          queryInterface.addColumn(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;role_id&#x27;</span>, &#123;</span><br><span class="line">              type: Sequelize.INTEGER</span><br><span class="line">          &#125;, &#123; <span class="attr">transaction</span>: t &#125;),</span><br><span class="line">          queryInterface.addColumn(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;ceshi&#x27;</span>, &#123;</span><br><span class="line">              type: Sequelize.STRING,</span><br><span class="line">          &#125;, &#123; <span class="attr">transaction</span>: t &#125;)</span><br><span class="line">      ])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.sequelize.transaction(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">          queryInterface.removeColumn(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;role_id&#x27;</span>, &#123; <span class="attr">transaction</span>: t &#125;),</span><br><span class="line">          queryInterface.removeColumn(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;ceshi&#x27;</span>, &#123; <span class="attr">transaction</span>: t &#125;)</span><br><span class="line">      ])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3.执行 migrate 进行数据库变更</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:migrate</span><br></pre></td></tr></table></figure>



<h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app / model / user.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; STRING, INTEGER, DATE &#125; = app.Sequelize;</span><br><span class="line">  <span class="comment">// 配置（重要：一定要配置详细，一定要！！！）</span></span><br><span class="line">  <span class="keyword">const</span> User = app.model.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    id: &#123; <span class="attr">type</span>: INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    name: STRING(<span class="number">30</span>),</span><br><span class="line">    age: INTEGER,</span><br><span class="line">    created_at: DATE,</span><br><span class="line">    updated_at: DATE,</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    timestamps: <span class="literal">true</span>, <span class="comment">// 是否自动写入时间戳</span></span><br><span class="line">    tableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// 自定义数据表名称</span></span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> User;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个 Model 就可以在 Controller 和 Service 中通过 <code>app.model.User</code> 或者 <code>ctx.model.User</code> 访问到了，例如我们编写 <code>app/controller/users.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/users.js</span></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toInt</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> str;</span><br><span class="line">  <span class="keyword">if</span> (!str) <span class="keyword">return</span> str;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseInt</span>(str, <span class="number">10</span>) || <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.ctx;</span><br><span class="line">    <span class="keyword">const</span> query = &#123; <span class="attr">limit</span>: toInt(ctx.query.limit), <span class="attr">offset</span>: toInt(ctx.query.offset) &#125;;</span><br><span class="line">    ctx.body = <span class="keyword">await</span> ctx.model.User.findAll(query);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">show</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.ctx;</span><br><span class="line">    ctx.body = <span class="keyword">await</span> ctx.model.User.findByPk(toInt(ctx.params.id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">create</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.ctx;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, age &#125; = ctx.request.body;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> ctx.model.User.create(&#123; name, age &#125;);</span><br><span class="line">    ctx.status = <span class="number">201</span>;</span><br><span class="line">    ctx.body = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.ctx;</span><br><span class="line">    <span class="keyword">const</span> id = toInt(ctx.params.id);</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> ctx.model.User.findByPk(id);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      ctx.status = <span class="number">404</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; name, age &#125; = ctx.request.body;</span><br><span class="line">    <span class="keyword">await</span> user.update(&#123; name, age &#125;);</span><br><span class="line">    ctx.body = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">destroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="built_in">this</span>.ctx;</span><br><span class="line">    <span class="keyword">const</span> id = toInt(ctx.params.id);</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> ctx.model.User.findByPk(id);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      ctx.status = <span class="number">404</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> user.destroy();</span><br><span class="line">    ctx.status = <span class="number">200</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UserController;</span><br></pre></td></tr></table></figure>

<p>最后我们将这个 controller 挂载到路由上：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.resources(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;/users&#x27;</span>, controller.users);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>针对 <code>users</code> 表的 CURD 操作的接口就开发完了</p>
<h3 id="模型其他参数"><a href="#模型其他参数" class="headerlink" title="模型其他参数"></a>模型其他参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置（重要）</span></span><br><span class="line">  <span class="keyword">const</span> User = app.model.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    id: &#123; <span class="attr">type</span>: INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    name: STRING(<span class="number">30</span>),</span><br><span class="line">    age: INTEGER,</span><br><span class="line">    created_at: DATE,</span><br><span class="line">    updated_at: DATE,</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="comment">// 自定义表名</span></span><br><span class="line">      <span class="string">&#x27;freezeTableName&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&#x27;xyz_users&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 是否需要增加createdAt、updatedAt、deletedAt字段</span></span><br><span class="line">      <span class="string">&#x27;timestamps&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 不需要createdAt字段</span></span><br><span class="line">      <span class="string">&#x27;createdAt&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将updatedAt字段改个名</span></span><br><span class="line">      <span class="string">&#x27;updatedAt&#x27;</span>: <span class="string">&#x27;utime&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将deletedAt字段改名</span></span><br><span class="line">      <span class="comment">// 同时需要设置paranoid为true（此种模式下，删除数据时不会进行物理删除，而是设置deletedAt为当前时间</span></span><br><span class="line">      <span class="string">&#x27;deletedAt&#x27;</span>: <span class="string">&#x27;dtime&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;paranoid&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>



<h3 id="sequelize-命令"><a href="#sequelize-命令" class="headerlink" title="sequelize 命令"></a>sequelize 命令</h3><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sequelize db:migrate</td>
<td align="left">运行迁移文件</td>
</tr>
<tr>
<td align="left">sequelize db:migrate:status</td>
<td align="left">列出所有迁移的状态</td>
</tr>
<tr>
<td align="left">sequelize db:migrate:undo</td>
<td align="left">隔离数据库：迁移：撤消</td>
</tr>
<tr>
<td align="left">sequelize db:migrate:undo:all</td>
<td align="left">还原所有运行的迁移</td>
</tr>
<tr>
<td align="left">sequelize db:create</td>
<td align="left">创建由配置指定的数据库</td>
</tr>
<tr>
<td align="left">sequelize db:drop</td>
<td align="left">删除由配置指定的数据库</td>
</tr>
</tbody></table>
<h3 id="外键约束（重要）"><a href="#外键约束（重要）" class="headerlink" title="外键约束（重要）"></a>外键约束（重要）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 迁移文件</span></span><br><span class="line">queryInterface.addConstraint(<span class="string">&#x27;tableName&#x27;</span>, [<span class="string">&#x27;user_id&#x27;</span>], &#123;</span><br><span class="line">    type: <span class="string">&#x27;foreign key&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;user_id&#x27;</span>,</span><br><span class="line">    references: &#123; <span class="comment">//Required field</span></span><br><span class="line">        table: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">        field: <span class="string">&#x27;id&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onDelete: <span class="string">&#x27;cascade&#x27;</span>,</span><br><span class="line">    onUpdate: <span class="string">&#x27;cascade&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="创建第一个种子"><a href="#创建第一个种子" class="headerlink" title="创建第一个种子"></a>创建第一个种子</h3><p>假设我们希望在默认情况下将一些数据插入到几个表中. 如果我们跟进前面的例子,我们可以考虑为 <code>User</code> 表创建演示用户.</p>
<p>要管理所有数据迁移,你可以使用 <code>seeders</code>. 种子文件是数据的一些变化,可用于使用样本数据或测试数据填充数据库表.</p>
<p>让我们创建一个种子文件,它会将一个演示用户添加到我们的 <code>User</code> 表中.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize seed:generate --name demo-user</span><br></pre></td></tr></table></figure>

<p>这个命令将会在 <code>seeders</code> 文件夹中创建一个种子文件.文件名看起来像是 <code>XXXXXXXXXXXXXX-demo-user.js</code>,它遵循相同的 <code>up/down</code> 语义,如迁移文件.</p>
<p>现在我们应该编辑这个文件,将演示用户插入<code>User</code>表.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  up: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.bulkInsert(<span class="string">&#x27;Users&#x27;</span>, [&#123;</span><br><span class="line">        firstName: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">        lastName: <span class="string">&#x27;Doe&#x27;</span>,</span><br><span class="line">        email: <span class="string">&#x27;demo@demo.com&#x27;</span>,</span><br><span class="line">        createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">        updatedAt: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">      &#125;], &#123;&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  down: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.bulkDelete(<span class="string">&#x27;Users&#x27;</span>, <span class="literal">null</span>, &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="运行种子"><a href="#运行种子" class="headerlink" title="运行种子"></a>运行种子</h3><p>在上一步中,你创建了一个种子文件. 但它还没有保存到数据库. 为此,我们需要运行一个简单的命令.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:seed:all</span><br></pre></td></tr></table></figure>

<p>这将执行该种子文件,你将有一个演示用户插入 <code>User</code> 表.</p>
<p><strong>注意:</strong> _ <code>seeders</code> 执行不会存储在任何使用 <code>SequelizeMeta</code> 表的迁移的地方. 如果你想覆盖这个,请阅读 <code>存储</code> 部分_</p>
<h3 id="撤销种子"><a href="#撤销种子" class="headerlink" title="撤销种子"></a>撤销种子</h3><p>Seeders 如果使用了任何存储那么就可以被撤消. 有两个可用的命令</p>
<p>如果你想撤消最近的种子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:seed:undo</span><br></pre></td></tr></table></figure>

<p>如果你想撤消特定的种子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:seed:undo --seed name-of-seed-as-in-data</span><br></pre></td></tr></table></figure>

<p>如果你想撤消所有的种子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:seed:undo:all</span><br></pre></td></tr></table></figure>



<h2 id="关联操作"><a href="#关联操作" class="headerlink" title="关联操作"></a>关联操作</h2><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p>模型层：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个用户对应一个用户资料</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app/model/user.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; STRING, INTEGER, DATE &#125; = app.Sequelize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> User = app.model.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">        id: &#123; <span class="attr">type</span>: INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        name: STRING(<span class="number">30</span>),</span><br><span class="line">        age: INTEGER,</span><br><span class="line">        created_at: DATE,</span><br><span class="line">        updated_at: DATE,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 关联关系</span></span><br><span class="line">    User.associate = <span class="function"><span class="keyword">function</span>(<span class="params">models</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 关联用户资料 一对一</span></span><br><span class="line">        User.hasOne(app.model.Userinfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> User;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// app/model/userinfo.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; STRING, INTEGER, DATE &#125; = app.Sequelize;</span><br><span class="line">    <span class="keyword">const</span> userinfo = app.model.define(<span class="string">&#x27;userinfo&#x27;</span>, &#123;</span><br><span class="line">        nickname: STRING,</span><br><span class="line">        user_id: INTEGER</span><br><span class="line">    &#125;, &#123;&#125;);</span><br><span class="line">    <span class="comment">// 关联用户表</span></span><br><span class="line">    userinfo.associate = <span class="function"><span class="keyword">function</span>(<span class="params">models</span>) </span>&#123;</span><br><span class="line">        app.model.Userinfo.belongsTo(app.model.User);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> userinfo;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>控制器调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/users.js</span></span><br><span class="line"><span class="comment">// 显示单条</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">show</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据主键查询 查询一条用findOne</span></span><br><span class="line">    <span class="built_in">this</span>.ctx.body = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.findOne(&#123;</span><br><span class="line">        <span class="comment">// 主表查询字段限制</span></span><br><span class="line">        attributes:[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">        <span class="comment">// 关联查询</span></span><br><span class="line">        include: [&#123;</span><br><span class="line">            <span class="comment">// 需要查询的模型</span></span><br><span class="line">            model: <span class="built_in">this</span>.app.model.Userinfo,</span><br><span class="line">            <span class="comment">// 副表查询的字段</span></span><br><span class="line">            attributes: [<span class="string">&#x27;nickname&#x27;</span>]</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="comment">// 主表条件</span></span><br><span class="line">        where: &#123;</span><br><span class="line">            id: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">City</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">City.init(&#123; <span class="attr">countryCode</span>: Sequelize.STRING &#125;, &#123; sequelize, <span class="attr">modelName</span>: <span class="string">&#x27;city&#x27;</span> &#125;);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Country.init(&#123; <span class="attr">isoCode</span>: Sequelize.STRING &#125;, &#123; sequelize, <span class="attr">modelName</span>: <span class="string">&#x27;country&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这里,我们可以根据国家代码连接国家和城市</span></span><br><span class="line">Country.hasMany(City, &#123;<span class="attr">foreignKey</span>: <span class="string">&#x27;countryCode&#x27;</span>, <span class="attr">sourceKey</span>: <span class="string">&#x27;isoCode&#x27;</span>&#125;);</span><br><span class="line">City.belongsTo(Country, &#123;<span class="attr">foreignKey</span>: <span class="string">&#x27;countryCode&#x27;</span>, <span class="attr">targetKey</span>: <span class="string">&#x27;isoCode&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.belongsToMany(Project, &#123; <span class="attr">as</span>: <span class="string">&#x27;Tasks&#x27;</span>, <span class="attr">through</span>: <span class="string">&#x27;worker_tasks&#x27;</span>, <span class="attr">foreignKey</span>: <span class="string">&#x27;userId&#x27;</span> &#125;)</span><br><span class="line">Project.belongsToMany(User, &#123; <span class="attr">as</span>: <span class="string">&#x27;Workers&#x27;</span>, <span class="attr">through</span>: <span class="string">&#x27;worker_tasks&#x27;</span>, <span class="attr">foreignKey</span>: <span class="string">&#x27;projectId&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>



<h3 id="关联常用操作"><a href="#关联常用操作" class="headerlink" title="关联常用操作"></a>关联常用操作</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取关联模型对象，n对一不需要加s</span></span><br><span class="line"><span class="keyword">let</span> userinfo = <span class="keyword">await</span> user.getUserinfo();</span><br><span class="line"><span class="comment">// n对多需要加s</span></span><br><span class="line"><span class="keyword">await</span> user.getPosts(&#123;</span><br><span class="line">    attributes: [<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">    where: &#123;</span><br><span class="line">        id: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关联操作</span></span><br><span class="line"><span class="comment">// 1：用户创建文章（一对多）</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.Post.create(&#123;</span><br><span class="line">    title: <span class="string">&quot;第一篇文章&quot;</span>,</span><br><span class="line">    user_id: user.id</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.获取当前用户所有文章</span></span><br><span class="line"><span class="keyword">await</span> user.getPosts();</span><br><span class="line"><span class="keyword">await</span> user.getPosts(&#123;</span><br><span class="line">    attributes: [<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">    where:&#123;</span><br><span class="line">        title:<span class="string">&quot;测试&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3：用户删除文章（一对多）</span></span><br><span class="line"><span class="comment">// (1) 获取当前用户的所有文章</span></span><br><span class="line"><span class="keyword">let</span> posts = <span class="keyword">await</span> user.getPosts(&#123;</span><br><span class="line">    attributes: [<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line">posts = posts.map(<span class="function"><span class="params">v</span> =&gt;</span> v.id);</span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.Post.destroy(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">        id: posts</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景三：用户关注话题（多对多）</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.TopicUser.bulkCreate([&#123;</span><br><span class="line">    user_id: user.id,</span><br><span class="line">    topic_id: <span class="number">1</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    user_id: user.id,</span><br><span class="line">    topic_id: <span class="number">2</span></span><br><span class="line">&#125;]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户关注话题（多对多）</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.TopicUser.destroy(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">        user_id: user.id,</span><br><span class="line">        topic_id: [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="获取器和修改器"><a href="#获取器和修改器" class="headerlink" title="获取器和修改器"></a>获取器和修改器</h2><p>模型层</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/model/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; STRING, INTEGER, DATE &#125; = app.Sequelize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> User = app.model.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">        id: &#123; <span class="attr">type</span>: INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        name: &#123;</span><br><span class="line">            type: STRING(<span class="number">30</span>),</span><br><span class="line">            <span class="comment">// 单独字段的getter，查询时都会调用</span></span><br><span class="line">            <span class="comment">// this.getDataValue(&#x27;name&#x27;) 获取原始值</span></span><br><span class="line">            <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> age = <span class="built_in">this</span>.getDataValue(<span class="string">&#x27;age&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.getDataValue(<span class="string">&#x27;name&#x27;</span>) + <span class="string">&#x27;年龄：&#x27;</span> + age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        age: &#123;</span><br><span class="line">            type: INTEGER,</span><br><span class="line">            <span class="comment">// 单独字段的setter，新增和更新时调用</span></span><br><span class="line">            <span class="comment">// this.setDataValue(&#x27;name&#x27;) 设置原始值</span></span><br><span class="line">            <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.setDataValue(<span class="string">&#x27;age&#x27;</span>, val * <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        created_at: DATE,</span><br><span class="line">        updated_at: DATE,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关联用户资料</span></span><br><span class="line">    User.associate = <span class="function"><span class="keyword">function</span>(<span class="params">models</span>) </span>&#123;</span><br><span class="line">        app.model.User.hasOne(app.model.Userinfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> User;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>控制器层</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">show</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据主键查询</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.findOne(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            id: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 获取原始值 user.getDataValue(&#x27;name&#x27;)</span></span><br><span class="line">    <span class="built_in">this</span>.ctx.body = user.getDataValue(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="模型钩子"><a href="#模型钩子" class="headerlink" title="模型钩子"></a>模型钩子</h2><p>模型层</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">   </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 钩子</span></span><br><span class="line">    <span class="comment">// 查询前</span></span><br><span class="line">    User.beforeFind(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;查询前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 查询后</span></span><br><span class="line">    User.afterFind(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;查询后&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 新增前</span></span><br><span class="line">    User.beforeCreate(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;新增前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 新增后</span></span><br><span class="line">    User.afterCreate(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;新增后&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 修改前</span></span><br><span class="line">    User.beforeUpdate(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;修改前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 修改后</span></span><br><span class="line">    User.afterUpdate(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;修改后&#x27;</span>); <span class="comment">// 真正修改才会触发，数据相同不会触发</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 删除前</span></span><br><span class="line">    User.beforeDestroy(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;删除前&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 删除后</span></span><br><span class="line">    User.afterDestroy(<span class="function">(<span class="params">user, option</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;删除后&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> User;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="主键查询"><a href="#主键查询" class="headerlink" title="主键查询"></a>主键查询</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.findByPk(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查找不存在则创建"><a href="#查找不存在则创建" class="headerlink" title="查找不存在则创建"></a>查找不存在则创建</h3><p>方法 <code>findOrCreate</code> 可用于检查数据库中是否已存在某个元素. 如果是这种情况,则该方法将生成相应的实例. 如果元素不存在,将会被创建.</p>
<p>如果是这种情况,则该方法将导致相应的实例. 如果元素不存在,将会被创建.</p>
<p>假设我们有一个空的数据库,一个 <code>User</code> 模型有一个 <code>username</code> 和 <code>job</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">User</span><br><span class="line">  .findOrCreate(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            username: <span class="string">&#x27;sdepold&#x27;</span></span><br><span class="line">        &#125;, </span><br><span class="line">        defaults: &#123;</span><br><span class="line">            job: <span class="string">&#x27;Technical Lead JavaScript&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  . then(<span class="function">(<span class="params">[user, created]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(user.get(&#123;</span><br><span class="line">      plain: <span class="literal">true</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="built_in">console</span>.log(created)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    findOrCreate 返回一个包含已找到或创建的对象的数组,找到或创建的对象和一个布尔值,如果创建一个新对象将为true,否则为false,像这样:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    [ &#123;</span></span><br><span class="line"><span class="comment">        username: &#x27;sdepold&#x27;,</span></span><br><span class="line"><span class="comment">        job: &#x27;Technical Lead JavaScript&#x27;,</span></span><br><span class="line"><span class="comment">        id: 1,</span></span><br><span class="line"><span class="comment">        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),</span></span><br><span class="line"><span class="comment">        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)</span></span><br><span class="line"><span class="comment">      &#125;,</span></span><br><span class="line"><span class="comment">      true ]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在上面的例子中,第三行的数组将分成2部分,并将它们作为参数传递给回调函数,在这种情况下将它们视为 &quot;user&quot; 和 &quot;created&quot; .(所以“user”将是返回数组的索引0的对象,并且 &quot;created&quot; 将等于 &quot;true&quot;.)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>代码创建了一个新的实例. 所以当我们已经有一个实例了 …</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">User.create(&#123; <span class="attr">username</span>: <span class="string">&#x27;fnord&#x27;</span>, <span class="attr">job</span>: <span class="string">&#x27;omnomnom&#x27;</span> &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> User.findOrCreate(&#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            username: <span class="string">&#x27;fnord&#x27;</span></span><br><span class="line">        &#125;, </span><br><span class="line">        defaults: &#123;</span><br><span class="line">            job: <span class="string">&#x27;something else&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;))</span><br><span class="line">  .then(<span class="function">(<span class="params">[user, created]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(user.get(&#123;</span><br><span class="line">      plain: <span class="literal">true</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="built_in">console</span>.log(created)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    在这个例子中,findOrCreate 返回一个如下的数组:</span></span><br><span class="line"><span class="comment">    [ &#123;</span></span><br><span class="line"><span class="comment">        username: &#x27;fnord&#x27;,</span></span><br><span class="line"><span class="comment">        job: &#x27;omnomnom&#x27;,</span></span><br><span class="line"><span class="comment">        id: 2,</span></span><br><span class="line"><span class="comment">        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),</span></span><br><span class="line"><span class="comment">        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)</span></span><br><span class="line"><span class="comment">      &#125;,</span></span><br><span class="line"><span class="comment">      false</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">    由findOrCreate返回的数组通过第三行的数组扩展为两部分,并且这些部分将作为2个参数传递给回调函数,在这种情况下将其视为 &quot;user&quot; 和 &quot;created&quot; .(所以“user”将是返回数组的索引0的对象,并且 &quot;created&quot; 将等于 &quot;false&quot;.)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>…现有条目将不会更改. 看到第二个用户的 “job”,并且实际上创建操作是假的.</p>
<h3 id="查找并计数"><a href="#查找并计数" class="headerlink" title="查找并计数"></a>查找并计数</h3><p><code>findAndCountAll</code> - 在数据库中搜索多个元素,返回数据和总计数</p>
<p>这是一个方便的方法,它结合了 <code>findAll</code> 和 <code>count</code>(见下文),当处理与分页相关的查询时,这是有用的,你想用 <code>limit</code> 和 <code>offset</code> 检索数据,但也需要知道总数与查询匹配的记录数:</p>
<p>处理程序成功将始终接收具有两个属性的对象:</p>
<ul>
<li><code>count</code> - 一个整数,总数记录匹配where语句和关联的其它过滤器</li>
<li><code>rows</code> - 一个数组对象,记录在limit和offset范围内匹配where语句和关联的其它过滤器,</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Project</span><br><span class="line">  .findAndCountAll(&#123;</span><br><span class="line">     where: &#123;</span><br><span class="line">        title: &#123;</span><br><span class="line">          [Op.like]: <span class="string">&#x27;foo%&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     offset: <span class="number">10</span>,</span><br><span class="line">     limit: <span class="number">2</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result.count);</span><br><span class="line">    <span class="built_in">console</span>.log(result.rows);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>它支持 include. 只有标记为 <code>required</code> 的 include 将被添加到计数部分:</p>
<p>假设你想查找附有个人资料的所有用户:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User.findAndCountAll(&#123;</span><br><span class="line">  include: [</span><br><span class="line">     &#123; <span class="attr">model</span>: Profile, <span class="attr">required</span>: <span class="literal">true</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  limit: <span class="number">3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>因为 <code>Profile</code> 的 include 有 <code>required</code> 设置,这将导致内部连接,并且只有具有 profile 的用户将被计数. 如果我们从 include 中删除<code>required</code>,那么有和没有 profile 的用户都将被计数. 在include中添加一个 <code>where</code> 语句会自动使它成为 required:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User.findAndCountAll(&#123;</span><br><span class="line">  include: [</span><br><span class="line">     &#123; <span class="attr">model</span>: Profile, <span class="attr">where</span>: &#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;&#125;</span><br><span class="line">  ],</span><br><span class="line">  limit: <span class="number">3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上面的查询只会对具有 active profile 的用户进行计数,因为在将 where 语句添加到 include 时,<code>required</code> 被隐式设置为 true.</p>
<p>传递给 <code>findAndCountAll</code> 的 options 对象与 <code>findAll</code> 相同(如下所述).</p>
<h3 id="查询多个（常用）"><a href="#查询多个（常用）" class="headerlink" title="查询多个（常用）"></a>查询多个（常用）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找到多个条目</span></span><br><span class="line">Project.findAll().then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects 将是所有 Project 实例的数组</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索特定属性 - 使用哈希</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">where</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;A Project&#x27;</span> &#125; &#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects将是一个具有指定 name 的 Project 实例数组</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在特定范围内进行搜索</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">where</span>: &#123; <span class="attr">id</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125; &#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects将是一系列具有 id 1,2 或 3 的项目</span></span><br><span class="line">  <span class="comment">// 这实际上是在做一个 IN 查询</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">      [Op.and]: &#123;<span class="attr">a</span>: <span class="number">5</span>&#125;,           <span class="comment">// 且 (a = 5)</span></span><br><span class="line">      [Op.or]: [&#123;<span class="attr">a</span>: <span class="number">5</span>&#125;, &#123;<span class="attr">a</span>: <span class="number">6</span>&#125;],  <span class="comment">// (a = 5 或 a = 6)</span></span><br><span class="line">      [Op.gt]: <span class="number">6</span>,                <span class="comment">// id &gt; 6</span></span><br><span class="line">      [Op.gte]: <span class="number">6</span>,               <span class="comment">// id &gt;= 6</span></span><br><span class="line">      [Op.lt]: <span class="number">10</span>,               <span class="comment">// id &lt; 10</span></span><br><span class="line">      [Op.lte]: <span class="number">10</span>,              <span class="comment">// id &lt;= 10</span></span><br><span class="line">      [Op.ne]: <span class="number">20</span>,               <span class="comment">// id != 20</span></span><br><span class="line">      [Op.between]: [<span class="number">6</span>, <span class="number">10</span>],     <span class="comment">// 在 6 和 10 之间</span></span><br><span class="line">      [Op.notBetween]: [<span class="number">11</span>, <span class="number">15</span>], <span class="comment">// 不在 11 和 15 之间</span></span><br><span class="line">      [Op.in]: [<span class="number">1</span>, <span class="number">2</span>],           <span class="comment">// 在 [1, 2] 之中</span></span><br><span class="line">      [Op.notIn]: [<span class="number">1</span>, <span class="number">2</span>],        <span class="comment">// 不在 [1, 2] 之中</span></span><br><span class="line">      [Op.like]: <span class="string">&#x27;%hat&#x27;</span>,         <span class="comment">// 包含 &#x27;%hat&#x27;</span></span><br><span class="line">      [Op.notLike]: <span class="string">&#x27;%hat&#x27;</span>,       <span class="comment">// 不包含 &#x27;%hat&#x27;</span></span><br><span class="line">      [Op.iLike]: <span class="string">&#x27;%hat&#x27;</span>,         <span class="comment">// 包含 &#x27;%hat&#x27; (不区分大小写)  (仅限 PG)</span></span><br><span class="line">      [Op.notILike]: <span class="string">&#x27;%hat&#x27;</span>,      <span class="comment">// 不包含 &#x27;%hat&#x27;  (仅限 PG)</span></span><br><span class="line">      [Op.overlap]: [<span class="number">1</span>, <span class="number">2</span>],       <span class="comment">// &amp;&amp; [1, 2] (PG数组重叠运算符)</span></span><br><span class="line">      [Op.contains]: [<span class="number">1</span>, <span class="number">2</span>],      <span class="comment">// @&gt; [1, 2] (PG数组包含运算符)</span></span><br><span class="line">      [Op.contained]: [<span class="number">1</span>, <span class="number">2</span>],     <span class="comment">// &lt;@ [1, 2] (PG数组包含于运算符)</span></span><br><span class="line">      [Op.any]: [<span class="number">2</span>,<span class="number">3</span>],            <span class="comment">// 任何数组[2, 3]::INTEGER (仅限 PG)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    status: &#123;</span><br><span class="line">      [Op.not]: <span class="literal">false</span>,           <span class="comment">// status 不为 FALSE</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="复合过滤-OR-NOT-查询"><a href="#复合过滤-OR-NOT-查询" class="headerlink" title="复合过滤 / OR / NOT 查询"></a>复合过滤 / OR / NOT 查询</h3><p>你可以使用多层嵌套的 AND,OR 和 NOT 条件进行一个复合的 where 查询. 为了做到这一点,你可以使用 <code>or</code> , <code>and</code> 或 <code>not</code> <code>运算符</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Project.findOne(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;a project&#x27;</span>,</span><br><span class="line">    [Op.or]: [</span><br><span class="line">      &#123; <span class="attr">id</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: &#123; [Op.gt]: <span class="number">10</span> &#125; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findOne(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;a project&#x27;</span>,</span><br><span class="line">    id: &#123;</span><br><span class="line">      [Op.or]: [</span><br><span class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">        &#123; [Op.gt]: <span class="number">10</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这两段代码将生成以下内容:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM <span class="string">`Projects`</span></span><br><span class="line">WHERE (</span><br><span class="line">  <span class="string">`Projects`</span>.<span class="string">`name`</span> = <span class="string">&#x27;a project&#x27;</span></span><br><span class="line">   AND (<span class="string">`Projects`</span>.<span class="string">`id`</span> IN (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) OR <span class="string">`Projects`</span>.<span class="string">`id`</span> &gt; <span class="number">10</span>)</span><br><span class="line">)</span><br><span class="line">LIMIT <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><code>not</code> 示例:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Project.findOne(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;a project&#x27;</span>,</span><br><span class="line">    [Op.not]: [</span><br><span class="line">      &#123; <span class="attr">id</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125;,</span><br><span class="line">      &#123; <span class="attr">array</span>: &#123; [Op.contains]: [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>] &#125; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>将生成:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM <span class="string">`Projects`</span></span><br><span class="line">WHERE (</span><br><span class="line">  <span class="string">`Projects`</span>.<span class="string">`name`</span> = <span class="string">&#x27;a project&#x27;</span></span><br><span class="line">   AND NOT (<span class="string">`Projects`</span>.<span class="string">`id`</span> IN (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) OR <span class="string">`Projects`</span>.<span class="string">`array`</span> @&gt; ARRAY[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]::INTEGER[])</span><br><span class="line">)</span><br><span class="line">LIMIT <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<h3 id="用限制-偏移-顺序和分组操作数据集"><a href="#用限制-偏移-顺序和分组操作数据集" class="headerlink" title="用限制,偏移,顺序和分组操作数据集"></a>用限制,偏移,顺序和分组操作数据集</h3><p>要获取更多相关数据,可以使用限制,偏移,顺序和分组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限制查询的结果</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">limit</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳过前10个元素</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳过前10个元素,并获取2个</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span>, <span class="attr">limit</span>: <span class="number">2</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>分组和排序的语法是相同的,所以下面只用一个单独的例子来解释分组,而其余的则是排序. 你下面看到的所有内容也可以对分组进行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Project.findAll(&#123;<span class="attr">order</span>: [[<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>]]&#125;)</span><br><span class="line"><span class="comment">// 生成 ORDER BY title DESC</span></span><br><span class="line"></span><br><span class="line">Project.findAll(&#123;<span class="attr">group</span>: <span class="string">&#x27;name&#x27;</span>&#125;)</span><br><span class="line"><span class="comment">// 生成 GROUP BY name</span></span><br></pre></td></tr></table></figure>

<p>请注意,在上述两个示例中,提供的字符串逐字插入到查询中,所以不会转义列名称. 当你向 order / group 提供字符串时,将始终如此. 如果要转义列名,你应该提供一个参数数组,即使你只想通过单个列进行 order / group</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">something.findOne(&#123;</span><br><span class="line">  order: [</span><br><span class="line">    <span class="comment">// 将返回 `name`</span></span><br><span class="line">    [<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">    <span class="comment">// 将返回 `username` DESC</span></span><br><span class="line">    [<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line">    <span class="comment">// 将返回 max(`age`)</span></span><br><span class="line">    sequelize.fn(<span class="string">&#x27;max&#x27;</span>, sequelize.col(<span class="string">&#x27;age&#x27;</span>)),</span><br><span class="line">    <span class="comment">// 将返回 max(`age`) DESC</span></span><br><span class="line">    [sequelize.fn(<span class="string">&#x27;max&#x27;</span>, sequelize.col(<span class="string">&#x27;age&#x27;</span>)), <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line">    <span class="comment">// 将返回 otherfunction(`col1`, 12, &#x27;lalala&#x27;) DESC</span></span><br><span class="line">    [sequelize.fn(<span class="string">&#x27;otherfunction&#x27;</span>, sequelize.col(<span class="string">&#x27;col1&#x27;</span>), <span class="number">12</span>, <span class="string">&#x27;lalala&#x27;</span>), <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line">    <span class="comment">// 将返回 otherfunction(awesomefunction(`col`)) DESC,这个嵌套是可以无限的！</span></span><br><span class="line">    [sequelize.fn(<span class="string">&#x27;otherfunction&#x27;</span>, sequelize.fn(<span class="string">&#x27;awesomefunction&#x27;</span>, sequelize.col(<span class="string">&#x27;col&#x27;</span>))), <span class="string">&#x27;DESC&#x27;</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>回顾一下,order / group数组的元素可以是以下内容:</p>
<ul>
<li>String - 将被引用</li>
<li>Array - 第一个元素将被引用,第二个将被逐字地追加</li>
<li>Object -<ul>
<li>raw 将被添加逐字引用</li>
<li>如果未设置 raw,一切都被忽略,查询将失败</li>
</ul>
</li>
<li>Sequelize.fn 和 Sequelize.col 返回函数和引用的列名</li>
</ul>
<h3 id="字段过滤"><a href="#字段过滤" class="headerlink" title="字段过滤"></a>字段过滤</h3><p>想要只选择某些属性,可以使用 <code>attributes</code> 选项. 通常是传递一个数组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SELECT foo, bar …</p>
</blockquote>
<p>属性可以使用嵌套数组来重命名:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [<span class="string">&#x27;foo&#x27;</span>, [<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SELECT foo, bar AS baz …</p>
</blockquote>
<p>也可以使用 <code>sequelize.fn</code> 来进行聚合:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [[sequelize.fn(<span class="string">&#x27;COUNT&#x27;</span>, sequelize.col(<span class="string">&#x27;hats&#x27;</span>)), <span class="string">&#x27;no_hats&#x27;</span>]]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SELECT COUNT(hats) AS no_hats …</p>
</blockquote>
<p>使用聚合功能时,必须给它一个别名,以便能够从模型中访问它. 在上面的例子中,你可以使用 <code>instance.get(&#39;no_hats&#39;)</code> 获得帽子数量.</p>
<p>有时,如果你只想添加聚合,则列出模型的所有属性可能令人厌烦:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is a tiresome way of getting the number of hats...</span></span><br><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;quz&#x27;</span>, [sequelize.fn(<span class="string">&#x27;COUNT&#x27;</span>, sequelize.col(<span class="string">&#x27;hats&#x27;</span>)), <span class="string">&#x27;no_hats&#x27;</span>]]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is shorter, and less error prone because it still works if you add / remove attributes</span></span><br><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: &#123; <span class="attr">include</span>: [[sequelize.fn(<span class="string">&#x27;COUNT&#x27;</span>, sequelize.col(<span class="string">&#x27;hats&#x27;</span>)), <span class="string">&#x27;no_hats&#x27;</span>]] &#125;</span><br><span class="line">&#125;);</span><br><span class="line">SELECT id, foo, bar, baz, quz, COUNT(hats) AS no_hats ...</span><br></pre></td></tr></table></figure>

<p>同样,它也可以排除一些指定的表字段:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: &#123; <span class="attr">exclude</span>: [<span class="string">&#x27;baz&#x27;</span>] &#125;</span><br><span class="line">&#125;);</span><br><span class="line">SELECT id, foo, bar, quz ...</span><br></pre></td></tr></table></figure>

<h3 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h3><p>无论你是通过 findAll/find 或批量 updates/destroys 进行查询,都可以传递一个 <code>where</code> 对象来过滤查询.</p>
<p><code>where</code> 通常用 attribute:value 键值对获取一个对象,其中 value 可以是匹配等式的数据或其他运算符的键值对象.</p>
<p>也可以通过嵌套 <code>or</code> 和 <code>and</code> <code>运算符</code> 的集合来生成复杂的 AND/OR 条件.</p>
<h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Op = Sequelize.Op;</span><br><span class="line"></span><br><span class="line">Post.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    authorId: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SELECT * FROM post WHERE authorId = 2</span></span><br><span class="line"></span><br><span class="line">Post.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    authorId: <span class="number">12</span>,</span><br><span class="line">    status: <span class="string">&#x27;active&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SELECT * FROM post WHERE authorId = 12 AND status = &#x27;active&#x27;;</span></span><br><span class="line"></span><br><span class="line">Post.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    [Op.or]: [&#123;<span class="attr">authorId</span>: <span class="number">12</span>&#125;, &#123;<span class="attr">authorId</span>: <span class="number">13</span>&#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SELECT * FROM post WHERE authorId = 12 OR authorId = 13;</span></span><br><span class="line"></span><br><span class="line">Post.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    authorId: &#123;</span><br><span class="line">      [Op.or]: [<span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SELECT * FROM post WHERE authorId = 12 OR authorId = 13;</span></span><br><span class="line"></span><br><span class="line">Post.destroy(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    status: <span class="string">&#x27;inactive&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// DELETE FROM post WHERE status = &#x27;inactive&#x27;;</span></span><br><span class="line"></span><br><span class="line">Post.update(&#123;</span><br><span class="line">  updatedAt: <span class="literal">null</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    deletedAt: &#123;</span><br><span class="line">      [Op.ne]: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// UPDATE post SET updatedAt = null WHERE deletedAt NOT NULL;</span></span><br><span class="line"></span><br><span class="line">Post.findAll(&#123;</span><br><span class="line">  where: sequelize.where(sequelize.fn(<span class="string">&#x27;char_length&#x27;</span>, sequelize.col(<span class="string">&#x27;status&#x27;</span>)), <span class="number">6</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// SELECT * FROM post WHERE char_length(status) = 6;</span></span><br></pre></td></tr></table></figure>



<h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><p>Sequelize 可用于创建更复杂比较的符号运算符 -</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Op = Sequelize.Op</span><br><span class="line"></span><br><span class="line">[Op.and]: &#123;<span class="attr">a</span>: <span class="number">5</span>&#125;           <span class="comment">// 且 (a = 5)</span></span><br><span class="line">[Op.or]: [&#123;<span class="attr">a</span>: <span class="number">5</span>&#125;, &#123;<span class="attr">a</span>: <span class="number">6</span>&#125;]  <span class="comment">// (a = 5 或 a = 6)</span></span><br><span class="line">[Op.gt]: <span class="number">6</span>,                <span class="comment">// id &gt; 6</span></span><br><span class="line">[Op.gte]: <span class="number">6</span>,               <span class="comment">// id &gt;= 6</span></span><br><span class="line">[Op.lt]: <span class="number">10</span>,               <span class="comment">// id &lt; 10</span></span><br><span class="line">[Op.lte]: <span class="number">10</span>,              <span class="comment">// id &lt;= 10</span></span><br><span class="line">[Op.ne]: <span class="number">20</span>,               <span class="comment">// id != 20</span></span><br><span class="line">[Op.eq]: <span class="number">3</span>,                <span class="comment">// = 3</span></span><br><span class="line">[Op.not]: <span class="literal">true</span>,            <span class="comment">// 不是 TRUE</span></span><br><span class="line">[Op.between]: [<span class="number">6</span>, <span class="number">10</span>],     <span class="comment">// 在 6 和 10 之间</span></span><br><span class="line">[Op.notBetween]: [<span class="number">11</span>, <span class="number">15</span>], <span class="comment">// 不在 11 和 15 之间</span></span><br><span class="line">[Op.in]: [<span class="number">1</span>, <span class="number">2</span>],           <span class="comment">// 在 [1, 2] 之中</span></span><br><span class="line">[Op.notIn]: [<span class="number">1</span>, <span class="number">2</span>],        <span class="comment">// 不在 [1, 2] 之中</span></span><br><span class="line">[Op.like]: <span class="string">&#x27;%hat&#x27;</span>,         <span class="comment">// 包含 &#x27;%hat&#x27;</span></span><br><span class="line">[Op.notLike]: <span class="string">&#x27;%hat&#x27;</span>       <span class="comment">// 不包含 &#x27;%hat&#x27;</span></span><br><span class="line">[Op.iLike]: <span class="string">&#x27;%hat&#x27;</span>         <span class="comment">// 包含 &#x27;%hat&#x27; (不区分大小写)  (仅限 PG)</span></span><br><span class="line">[Op.notILike]: <span class="string">&#x27;%hat&#x27;</span>      <span class="comment">// 不包含 &#x27;%hat&#x27;  (仅限 PG)</span></span><br><span class="line">[Op.startsWith]: <span class="string">&#x27;hat&#x27;</span>     <span class="comment">// 类似 &#x27;hat%&#x27;</span></span><br><span class="line">[Op.endsWith]: <span class="string">&#x27;hat&#x27;</span>       <span class="comment">// 类似 &#x27;%hat&#x27;</span></span><br><span class="line">[Op.substring]: <span class="string">&#x27;hat&#x27;</span>      <span class="comment">// 类似 &#x27;%hat%&#x27;</span></span><br><span class="line">[Op.regexp]: <span class="string">&#x27;^[h|a|t]&#x27;</span>    <span class="comment">// 匹配正则表达式/~ &#x27;^[h|a|t]&#x27; (仅限 MySQL/PG)</span></span><br><span class="line">[Op.notRegexp]: <span class="string">&#x27;^[h|a|t]&#x27;</span> <span class="comment">// 不匹配正则表达式/!~ &#x27;^[h|a|t]&#x27; (仅限 MySQL/PG)</span></span><br><span class="line">[Op.iRegexp]: <span class="string">&#x27;^[h|a|t]&#x27;</span>    <span class="comment">// ~* &#x27;^[h|a|t]&#x27; (仅限 PG)</span></span><br><span class="line">[Op.notIRegexp]: <span class="string">&#x27;^[h|a|t]&#x27;</span> <span class="comment">// !~* &#x27;^[h|a|t]&#x27; (仅限 PG)</span></span><br><span class="line">[Op.like]: &#123; [Op.any]: [<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;hat&#x27;</span>]&#125; <span class="comment">// 包含任何数组[&#x27;cat&#x27;, &#x27;hat&#x27;] - 同样适用于 iLike 和 notLike</span></span><br><span class="line">[Op.overlap]: [<span class="number">1</span>, <span class="number">2</span>]       <span class="comment">// &amp;&amp; [1, 2] (PG数组重叠运算符)</span></span><br><span class="line">[Op.contains]: [<span class="number">1</span>, <span class="number">2</span>]      <span class="comment">// @&gt; [1, 2] (PG数组包含运算符)</span></span><br><span class="line">[Op.contained]: [<span class="number">1</span>, <span class="number">2</span>]     <span class="comment">// &lt;@ [1, 2] (PG数组包含于运算符)</span></span><br><span class="line">[Op.any]: [<span class="number">2</span>,<span class="number">3</span>]            <span class="comment">// 任何数组[2, 3]::INTEGER (仅限PG)</span></span><br><span class="line"></span><br><span class="line">[Op.col]: <span class="string">&#x27;user.organization_id&#x27;</span> <span class="comment">// = &#x27;user&#x27;.&#x27;organization_id&#x27;, 使用数据库语言特定的列标识符, 本例使用 PG</span></span><br></pre></td></tr></table></figure>

<h4 id="范围选项"><a href="#范围选项" class="headerlink" title="范围选项"></a>范围选项</h4><p>所有操作符都支持支持的范围类型查询.</p>
<p>请记住,提供的范围值也可以<a target="_blank" rel="noopener" href="https://itfun.tv/documents/266#range-types">定义绑定的 inclusion/exclusion</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有上述相等和不相等的操作符加上以下内容:</span></span><br><span class="line"></span><br><span class="line">[Op.contains]: <span class="number">2</span>           <span class="comment">// @&gt; &#x27;2&#x27;::integer (PG range contains element operator)</span></span><br><span class="line">[Op.contains]: [<span class="number">1</span>, <span class="number">2</span>]      <span class="comment">// @&gt; [1, 2) (PG range contains range operator)</span></span><br><span class="line">[Op.contained]: [<span class="number">1</span>, <span class="number">2</span>]     <span class="comment">// &lt;@ [1, 2) (PG range is contained by operator)</span></span><br><span class="line">[Op.overlap]: [<span class="number">1</span>, <span class="number">2</span>]       <span class="comment">// &amp;&amp; [1, 2) (PG range overlap (have points in common) operator)</span></span><br><span class="line">[Op.adjacent]: [<span class="number">1</span>, <span class="number">2</span>]      <span class="comment">// -|- [1, 2) (PG range is adjacent to operator)</span></span><br><span class="line">[Op.strictLeft]: [<span class="number">1</span>, <span class="number">2</span>]    <span class="comment">// &lt;&lt; [1, 2) (PG range strictly left of operator)</span></span><br><span class="line">[Op.strictRight]: [<span class="number">1</span>, <span class="number">2</span>]   <span class="comment">// &gt;&gt; [1, 2) (PG range strictly right of operator)</span></span><br><span class="line">[Op.noExtendRight]: [<span class="number">1</span>, <span class="number">2</span>] <span class="comment">// &amp;&lt; [1, 2) (PG range does not extend to the right of operator)</span></span><br><span class="line">[Op.noExtendLeft]: [<span class="number">1</span>, <span class="number">2</span>]  <span class="comment">// &amp;&gt; [1, 2) (PG range does not extend to the left of operator)</span></span><br></pre></td></tr></table></figure>

<h4 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  rank: &#123;</span><br><span class="line">    [Op.or]: &#123;</span><br><span class="line">      [Op.lt]: <span class="number">1000</span>,</span><br><span class="line">      [Op.eq]: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// rank &lt; 1000 OR rank IS NULL</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  createdAt: &#123;</span><br><span class="line">    [Op.lt]: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    [Op.gt]: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">new</span> <span class="built_in">Date</span>() - <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// createdAt &lt; [timestamp] AND createdAt &gt; [timestamp]</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  [Op.or]: [</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#123;</span><br><span class="line">        [Op.like]: <span class="string">&#x27;Boat%&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      description: &#123;</span><br><span class="line">        [Op.like]: <span class="string">&#x27;%boat%&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// title LIKE &#x27;Boat%&#x27; OR description LIKE &#x27;%boat%&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="关系-关联"><a href="#关系-关联" class="headerlink" title="关系 / 关联"></a>关系 / 关联</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找到所有具有至少一个 task 的  project,其中 task.state === project.state</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">        model: Task,</span><br><span class="line">        where: &#123; <span class="attr">state</span>: Sequelize.col(<span class="string">&#x27;project.state&#x27;</span>) &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="分页-限制"><a href="#分页-限制" class="headerlink" title="分页 / 限制"></a>分页 / 限制</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取10个实例/行</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">limit</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳过8个实例/行</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">8</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳过5个实例,然后取5个</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">5</span>, <span class="attr">limit</span>: <span class="number">5</span> &#125;)</span><br></pre></td></tr></table></figure>



<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p><code>order</code> 需要一个条目的数组来排序查询或者一个 sequelize 方法.一般来说,你将要使用任一属性的 tuple/array,并确定排序的正反方向.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Subtask.findAll(&#123;</span><br><span class="line">  order: [</span><br><span class="line">    <span class="comment">// 将转义标题,并根据有效的方向参数列表验证DESC</span></span><br><span class="line">    [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将按最大值排序(age)</span></span><br><span class="line">    sequelize.fn(<span class="string">&#x27;max&#x27;</span>, sequelize.col(<span class="string">&#x27;age&#x27;</span>)),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将按最大顺序(age) DESC</span></span><br><span class="line">    [sequelize.fn(<span class="string">&#x27;max&#x27;</span>, sequelize.col(<span class="string">&#x27;age&#x27;</span>)), <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将按 otherfunction 排序(`col1`, 12, &#x27;lalala&#x27;) DESC</span></span><br><span class="line">    [sequelize.fn(<span class="string">&#x27;otherfunction&#x27;</span>, sequelize.col(<span class="string">&#x27;col1&#x27;</span>), <span class="number">12</span>, <span class="string">&#x27;lalala&#x27;</span>), <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将使用模型名称作为关联的名称排序关联模型的 created_at.</span></span><br><span class="line">    [Task, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Will order through an associated model&#x27;s created_at using the model names as the associations&#x27; names.</span></span><br><span class="line">    [Task, Project, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将使用关联的名称由关联模型的created_at排序.</span></span><br><span class="line">    [<span class="string">&#x27;Task&#x27;</span>, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Will order by a nested associated model&#x27;s created_at using the names of the associations.</span></span><br><span class="line">    [<span class="string">&#x27;Task&#x27;</span>, <span class="string">&#x27;Project&#x27;</span>, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Will order by an associated model&#x27;s created_at using an association object. (优选方法)</span></span><br><span class="line">    [Subtask.associations.Task, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Will order by a nested associated model&#x27;s created_at using association objects. (优选方法)</span></span><br><span class="line">    [Subtask.associations.Task, Task.associations.Project, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Will order by an associated model&#x27;s created_at using a simple association object.</span></span><br><span class="line">    [&#123;<span class="attr">model</span>: Task, <span class="attr">as</span>: <span class="string">&#x27;Task&#x27;</span>&#125;, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 嵌套关联模型的 created_at 简单关联对象排序</span></span><br><span class="line">    [&#123;<span class="attr">model</span>: Task, <span class="attr">as</span>: <span class="string">&#x27;Task&#x27;</span>&#125;, &#123;<span class="attr">model</span>: Project, <span class="attr">as</span>: <span class="string">&#x27;Project&#x27;</span>&#125;, <span class="string">&#x27;createdAt&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>]</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将按年龄最大值降序排列</span></span><br><span class="line">  order: sequelize.literal(<span class="string">&#x27;max(age) DESC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 按最年龄大值升序排列,当省略排序条件时默认是升序排列</span></span><br><span class="line">  order: sequelize.fn(<span class="string">&#x27;max&#x27;</span>, sequelize.col(<span class="string">&#x27;age&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 按升序排列是省略排序条件的默认顺序</span></span><br><span class="line">  order: sequelize.col(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将根据方言随机排序 (而不是 fn(&#x27;RAND&#x27;) 或 fn(&#x27;RANDOM&#x27;))</span></span><br><span class="line">  order: sequelize.random()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="count-计算数据库中元素的出现次数"><a href="#count-计算数据库中元素的出现次数" class="headerlink" title="count - 计算数据库中元素的出现次数"></a><code>count</code> - 计算数据库中元素的出现次数</h3><p>还有一种数据库对象计数的方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Project.count().then(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;There are &quot;</span> + c + <span class="string">&quot; projects!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.count(&#123; <span class="attr">where</span>: &#123;<span class="string">&#x27;id&#x27;</span>: &#123;[Op.gt]: <span class="number">25</span>&#125;&#125; &#125;).then(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;There are &quot;</span> + c + <span class="string">&quot; projects with an id greater than 25.&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="max-获取特定表中特定属性的最大值"><a href="#max-获取特定表中特定属性的最大值" class="headerlink" title="max - 获取特定表中特定属性的最大值"></a><code>max</code> - 获取特定表中特定属性的最大值</h3><p>这里是获取属性的最大值的方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   我们假设3个具有属性年龄的对象.</span></span><br><span class="line"><span class="comment">   第一个是10岁,</span></span><br><span class="line"><span class="comment">   第二个是5岁,</span></span><br><span class="line"><span class="comment">   第三个是40岁.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Project.max(<span class="string">&#x27;age&#x27;</span>).then(<span class="function"><span class="params">max</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将返回 40</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.max(<span class="string">&#x27;age&#x27;</span>, &#123; <span class="attr">where</span>: &#123; <span class="attr">age</span>: &#123; [Op.lt]: <span class="number">20</span> &#125; &#125; &#125;).then(<span class="function"><span class="params">max</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将会是 10</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="min-获取特定表中特定属性的最小值"><a href="#min-获取特定表中特定属性的最小值" class="headerlink" title="min - 获取特定表中特定属性的最小值"></a><code>min</code> - 获取特定表中特定属性的最小值</h3><p>这里是获取属性的最小值的方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   我们假设3个具有属性年龄的对象.</span></span><br><span class="line"><span class="comment">   第一个是10岁,</span></span><br><span class="line"><span class="comment">   第二个是5岁,</span></span><br><span class="line"><span class="comment">   第三个是40岁.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Project.min(<span class="string">&#x27;age&#x27;</span>).then(<span class="function"><span class="params">min</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将返回 5</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.min(<span class="string">&#x27;age&#x27;</span>, &#123; <span class="attr">where</span>: &#123; <span class="attr">age</span>: &#123; [Op.gt]: <span class="number">5</span> &#125; &#125; &#125;).then(<span class="function"><span class="params">min</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将会是 10</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="sum-特定属性的值求和"><a href="#sum-特定属性的值求和" class="headerlink" title="sum - 特定属性的值求和"></a><code>sum</code> - 特定属性的值求和</h3><p>为了计算表的特定列的总和,可以使用“sum”方法.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   我们假设3个具有属性年龄的对象.</span></span><br><span class="line"><span class="comment">   第一个是10岁,</span></span><br><span class="line"><span class="comment">   第二个是5岁,</span></span><br><span class="line"><span class="comment">   第三个是40岁.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Project.sum(<span class="string">&#x27;age&#x27;</span>).then(<span class="function"><span class="params">sum</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将返回 55</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.sum(<span class="string">&#x27;age&#x27;</span>, &#123; <span class="attr">where</span>: &#123; <span class="attr">age</span>: &#123; [Op.gt]: <span class="number">5</span> &#125; &#125; &#125;).then(<span class="function"><span class="params">sum</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 将会是 50</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="预加载"><a href="#预加载" class="headerlink" title="预加载"></a>预加载</h2><p>当你从数据库检索数据时,也想同时获得与之相关联的查询,这被称为预加载.这个基本思路就是当你调用 <code>find</code> 或 <code>findAll</code> 时使用 <code>include</code> 属性.让我们假设以下设置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">User.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize, <span class="attr">modelName</span>: <span class="string">&#x27;user&#x27;</span> &#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Task.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize, <span class="attr">modelName</span>: <span class="string">&#x27;task&#x27;</span> &#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tool</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Tool.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize, <span class="attr">modelName</span>: <span class="string">&#x27;tool&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">Task.belongsTo(User)</span><br><span class="line">User.hasMany(Task)</span><br><span class="line">User.hasMany(Tool, &#123; <span class="attr">as</span>: <span class="string">&#x27;Instruments&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">sequelize.sync().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这是我们继续的地方 ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>首先,让我们用它们的关联 user 加载所有的 task.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Task.findAll(&#123; <span class="attr">include</span>: [ User ] &#125;).then(<span class="function"><span class="params">tasks</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(tasks))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;A Task&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;userId&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;user&quot;: &#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>请注意,访问者(结果实例中的 <code>User</code> 属性)是单数形式,因为关联是一对一的.</p>
<p>接下来的事情:用多对一的关联加载数据！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123; <span class="attr">include</span>: [ Task ] &#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;tasks&quot;: [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;A Task&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">      &#125;]</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>请注意,访问者(结果实例中的 <code>Tasks</code> 属性)是复数形式,因为关联是多对一的.</p>
<p>如果关联是别名的(使用 <code>as</code> 参数),则在包含模型时必须指定此别名. 注意用户的 <code>Tool</code> 如何被别名为 <code>Instruments</code>. 为了获得正确的权限,你必须指定要加载的模型以及别名:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123; <span class="attr">include</span>: [&#123; <span class="attr">model</span>: Tool, <span class="attr">as</span>: <span class="string">&#x27;Instruments&#x27;</span> &#125;] &#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">      &#125;]</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>你还可以通过指定与关联别名匹配的字符串来包含别名:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123; <span class="attr">include</span>: [<span class="string">&#x27;Instruments&#x27;</span>] &#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">      &#125;]</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">User.findAll(&#123; <span class="attr">include</span>: [&#123; <span class="attr">association</span>: <span class="string">&#x27;Instruments&#x27;</span> &#125;] &#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">      &#125;]</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>当预加载时,我们也可以使用 <code>where</code> 过滤关联的模型. 这将返回 <code>Tool</code> 模型中所有与 <code>where</code> 语句匹配的行的<code>User</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">        model: Tool,</span><br><span class="line">        <span class="keyword">as</span>: <span class="string">&#x27;Instruments&#x27;</span>,</span><br><span class="line">        where: &#123; <span class="attr">name</span>: &#123; [Op.like]: <span class="string">&#x27;%ooth%&#x27;</span> &#125; &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">          &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">          &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">          &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">        &#125;]</span></span><br><span class="line"><span class="comment">      &#125;],</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;John Smith&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 2,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">          &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">          &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">          &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">        &#125;]</span></span><br><span class="line"><span class="comment">      &#125;],</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>当使用 <code>include.where</code> 过滤一个预加载的模型时,<code>include.required</code> 被隐式设置为 <code>true</code>. 这意味着内部联接完成返回具有任何匹配子项的父模型.</p>
<h3 id="使用预加载模型的顶层-WHERE"><a href="#使用预加载模型的顶层-WHERE" class="headerlink" title="使用预加载模型的顶层 WHERE"></a>使用预加载模型的顶层 WHERE</h3><p>将模型的 <code>WHERE</code> 条件从 <code>ON</code> 条件的 include 模式移动到顶层,你可以使用 <code>&#39;$nested.column$&#39;</code> 语法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">        <span class="string">&#x27;$Instruments.name$&#x27;</span>: &#123; [Op.iLike]: <span class="string">&#x27;%ooth%&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    include: [&#123;</span><br><span class="line">        model: Tool,</span><br><span class="line">        <span class="keyword">as</span>: <span class="string">&#x27;Instruments&#x27;</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">          &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">          &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">          &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">        &#125;]</span></span><br><span class="line"><span class="comment">      &#125;],</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      [&#123;</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;John Smith&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 2,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">        &quot;Instruments&quot;: [&#123;</span></span><br><span class="line"><span class="comment">          &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">          &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">          &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">          &quot;userId&quot;: 1</span></span><br><span class="line"><span class="comment">        &#125;]</span></span><br><span class="line"><span class="comment">      &#125;],</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>



<h3 id="包括所有"><a href="#包括所有" class="headerlink" title="包括所有"></a>包括所有</h3><p>要包含所有属性,你可以使用 <code>all:true</code> 传递单个对象:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123; <span class="attr">include</span>: [&#123; <span class="attr">all</span>: <span class="literal">true</span> &#125;]&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="包括软删除的记录"><a href="#包括软删除的记录" class="headerlink" title="包括软删除的记录"></a>包括软删除的记录</h3><p>如果想要加载软删除的记录,可以通过将 <code>include.paranoid</code> 设置为 <code>false</code> 来实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">        model: Tool,</span><br><span class="line">        where: &#123; <span class="attr">name</span>: &#123; [Op.like]: <span class="string">&#x27;%ooth%&#x27;</span> &#125; &#125;,</span><br><span class="line">        paranoid: <span class="literal">false</span> <span class="comment">// query and loads the soft deleted records</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="排序预加载关联"><a href="#排序预加载关联" class="headerlink" title="排序预加载关联"></a>排序预加载关联</h3><p>在一对多关系的情况下.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Company.findAll(&#123; <span class="attr">include</span>: [ Division ], <span class="attr">order</span>: [ [ Division, <span class="string">&#x27;name&#x27;</span> ] ] &#125;);</span><br><span class="line">Company.findAll(&#123; <span class="attr">include</span>: [ Division ], <span class="attr">order</span>: [ [ Division, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span> ] ] &#125;);</span><br><span class="line">Company.findAll(&#123;</span><br><span class="line">  include: [ &#123; <span class="attr">model</span>: Division, <span class="attr">as</span>: <span class="string">&#x27;Div&#x27;</span> &#125; ],</span><br><span class="line">  order: [ [ &#123; <span class="attr">model</span>: Division, <span class="attr">as</span>: <span class="string">&#x27;Div&#x27;</span> &#125;, <span class="string">&#x27;name&#x27;</span> ] ]</span><br><span class="line">&#125;);</span><br><span class="line">Company.findAll(&#123;</span><br><span class="line">  include: [ &#123; <span class="attr">model</span>: Division, <span class="attr">as</span>: <span class="string">&#x27;Div&#x27;</span> &#125; ],</span><br><span class="line">  order: [ [ &#123; <span class="attr">model</span>: Division, <span class="attr">as</span>: <span class="string">&#x27;Div&#x27;</span> &#125;, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span> ] ]</span><br><span class="line">&#125;);</span><br><span class="line">Company.findAll(&#123;</span><br><span class="line">  include: [ &#123; <span class="attr">model</span>: Division, <span class="attr">include</span>: [ Department ] &#125; ],</span><br><span class="line">  order: [ [ Division, Department, <span class="string">&#x27;name&#x27;</span> ] ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在多对多关系的情况下,你还可以通过表中的属性进行排序.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Company.findAll(&#123;</span><br><span class="line">  include: [ &#123; <span class="attr">model</span>: Division, <span class="attr">include</span>: [ Department ] &#125; ],</span><br><span class="line">  order: [ [ Division, DepartmentDivision, <span class="string">&#x27;name&#x27;</span> ] ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="嵌套预加载"><a href="#嵌套预加载" class="headerlink" title="嵌套预加载"></a>嵌套预加载</h3><p>你可以使用嵌套的预加载来加载相关模型的所有相关模型:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123;</span><br><span class="line">  include: [</span><br><span class="line">    &#123;<span class="attr">model</span>: Tool, <span class="attr">as</span>: <span class="string">&#x27;Instruments&#x27;</span>, <span class="attr">include</span>: [</span><br><span class="line">      &#123;<span class="attr">model</span>: Teacher, <span class="attr">include</span>: [ <span class="comment">/* etc */</span>]&#125;</span><br><span class="line">    ]&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(users))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [&#123;</span></span><br><span class="line"><span class="comment">      &quot;name&quot;: &quot;John Doe&quot;,</span></span><br><span class="line"><span class="comment">      &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,</span></span><br><span class="line"><span class="comment">      &quot;Instruments&quot;: [&#123; // 1:M and N:M association</span></span><br><span class="line"><span class="comment">        &quot;name&quot;: &quot;Toothpick&quot;,</span></span><br><span class="line"><span class="comment">        &quot;id&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;createdAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;updatedAt&quot;: null,</span></span><br><span class="line"><span class="comment">        &quot;userId&quot;: 1,</span></span><br><span class="line"><span class="comment">        &quot;Teacher&quot;: &#123; // 1:1 association</span></span><br><span class="line"><span class="comment">          &quot;name&quot;: &quot;Jimi Hendrix&quot;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      &#125;]</span></span><br><span class="line"><span class="comment">    &#125;]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这将产生一个外连接. 但是,相关模型上的 <code>where</code> 语句将创建一个内部连接,并仅返回具有匹配子模型的实例. 要返回所有父实例,你应该添加 <code>required: false</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123;</span><br><span class="line">  include: [&#123;</span><br><span class="line">    model: Tool,</span><br><span class="line">    <span class="keyword">as</span>: <span class="string">&#x27;Instruments&#x27;</span>,</span><br><span class="line">    include: [&#123;</span><br><span class="line">      model: Teacher,</span><br><span class="line">      where: &#123;</span><br><span class="line">        school: <span class="string">&quot;Woodstock Music School&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      required: <span class="literal">false</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>以上查询将返回所有用户及其所有乐器,但只会返回与 <code>Woodstock Music School</code> 相关的老师.</p>
<p>包括所有也支持嵌套加载:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.findAll(&#123; <span class="attr">include</span>: [&#123; <span class="attr">all</span>: <span class="literal">true</span>, <span class="attr">nested</span>: <span class="literal">true</span> &#125;]&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><h3 id="字段限制"><a href="#字段限制" class="headerlink" title="字段限制"></a>字段限制</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> User.create(&#123; <span class="attr">username</span>: <span class="string">&#x27;barfooz&#x27;</span>, <span class="attr">isAdmin</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">fields</span>: [ <span class="string">&#x27;username&#x27;</span> ] &#125;);</span><br><span class="line"><span class="comment">// 只有username有效</span></span><br><span class="line"></span><br><span class="line">User.bulkCreate([</span><br><span class="line">  &#123; <span class="attr">username</span>: <span class="string">&#x27;foo&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">username</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">admin</span>: <span class="literal">true</span>&#125;</span><br><span class="line">], &#123; <span class="attr">fields</span>: [<span class="string">&#x27;username&#x27;</span>] &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// admin 将不会被构建</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="新增单个"><a href="#新增单个" class="headerlink" title="新增单个"></a>新增单个</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create</span></span><br><span class="line"><span class="built_in">this</span>.ctx.body = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.create(&#123;</span><br><span class="line">    name: <span class="string">&quot;哈哈哈&quot;</span>,</span><br><span class="line">    age: <span class="number">12</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="批量新增"><a href="#批量新增" class="headerlink" title="批量新增"></a>批量新增</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量新增 bulkCreate</span></span><br><span class="line"><span class="built_in">this</span>.ctx.body = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.bulkCreate([</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;第一个&quot;</span>,</span><br><span class="line">        age: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;第二个&quot;</span>,</span><br><span class="line">        age: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;第三个&quot;</span>,</span><br><span class="line">        age: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>



<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><h3 id="字段限制-1"><a href="#字段限制-1" class="headerlink" title="字段限制"></a>字段限制</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">task.title = <span class="string">&#x27;foooo&#x27;</span></span><br><span class="line">task.description = <span class="string">&#x27;baaaaaar&#x27;</span></span><br><span class="line"><span class="keyword">await</span> task.save(&#123;<span class="attr">fields</span>: [<span class="string">&#x27;title&#x27;</span>]&#125;);</span><br><span class="line"><span class="comment">// title 现在将是 “foooo”,而 description 与以前一样</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用等效的 update 调用如下所示:</span></span><br><span class="line"><span class="keyword">await</span> task.update(&#123; <span class="attr">title</span>: <span class="string">&#x27;foooo&#x27;</span>, <span class="attr">description</span>: <span class="string">&#x27;baaaaaar&#x27;</span>&#125;, &#123;<span class="attr">fields</span>: [<span class="string">&#x27;title&#x27;</span>]&#125;);</span><br><span class="line"><span class="comment">//  title 现在将是 “foooo”,而 description 与以前一样</span></span><br></pre></td></tr></table></figure>

<h3 id="单个修改"><a href="#单个修改" class="headerlink" title="单个修改"></a>单个修改</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找出当前记录</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.findByPk(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">await</span> user.update(&#123;</span><br><span class="line">    name: <span class="string">&quot;我被修改了&quot;</span>,</span><br><span class="line">    age: <span class="number">30</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="批量修改"><a href="#批量修改" class="headerlink" title="批量修改"></a>批量修改</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量修改</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.update(&#123;</span><br><span class="line">    name: <span class="string">&quot;批量修改&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="comment">// 条件</span></span><br><span class="line">    where: &#123;</span><br><span class="line">        name: <span class="string">&quot;第一个&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="递增"><a href="#递增" class="headerlink" title="递增"></a>递增</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 找出当前记录 increment</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.findByPk(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">this</span>.ctx.body = <span class="keyword">await</span> user.increment(&#123;</span><br><span class="line">    age: <span class="number">3</span>, <span class="comment">// age每次递增3</span></span><br><span class="line">    other:<span class="number">2</span> <span class="comment">// other每次递增2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="递减"><a href="#递减" class="headerlink" title="递减"></a>递减</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 找出当前记录 decrement</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.findByPk(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">this</span>.ctx.body = <span class="keyword">await</span> user.decrement(&#123;</span><br><span class="line">    age: <span class="number">3</span>, <span class="comment">// age每次递减3</span></span><br><span class="line">    other:<span class="number">2</span> <span class="comment">// other每次递减2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><h3 id="软删除"><a href="#软删除" class="headerlink" title="软删除"></a>软删除</h3><p>模型中配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置（重要）</span></span><br><span class="line">  <span class="keyword">const</span> User = app.model.define(<span class="string">&#x27;user&#x27;</span>, &#123; <span class="comment">/* bla */</span>&#125;,&#123;</span><br><span class="line">      <span class="comment">// 同时需要设置paranoid为true（此种模式下，删除数据时不会进行物理删除，而是设置deletedAt为当前时间</span></span><br><span class="line">      <span class="string">&#x27;paranoid&#x27;</span>: <span class="literal">true</span></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>



<h3 id="查询包括软删除内容"><a href="#查询包括软删除内容" class="headerlink" title="查询包括软删除内容"></a>查询包括软删除内容</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">await</span> ctx.model.User.findOne(&#123;</span><br><span class="line">    include:&#123;</span><br><span class="line">      model:ctx.model.Video,</span><br><span class="line">      <span class="comment">// 包括软删除</span></span><br><span class="line">      paranoid: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    where: &#123;</span><br><span class="line">        id: <span class="number">33</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 包括软删除</span></span><br><span class="line">    paranoid: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h3 id="彻底删除"><a href="#彻底删除" class="headerlink" title="彻底删除"></a>彻底删除</h3><p>如果 <code>paranoid</code> 选项为 true,则不会删除该对象,而将 <code>deletedAt</code> 列设置为当前时间戳. 要强制删除,可以将 <code>force: true</code> 传递给 destroy 调用:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">task.destroy(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>在 <code>paranoid</code> 模式下对象被软删除后,在强制删除旧实例之前,你将无法使用相同的主键创建新实例.</p>
<h3 id="恢复软删除的实例"><a href="#恢复软删除的实例" class="headerlink" title="恢复软删除的实例"></a>恢复软删除的实例</h3><p>如果你使用 <code>paranoid:true</code> 软删除了模型的实例,之后想要撤消删除,请使用 <code>restore</code> 方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进行软删除...</span></span><br><span class="line">task.destroy();</span><br><span class="line"><span class="comment">// 恢复软删除...</span></span><br><span class="line">task.restore();</span><br></pre></td></tr></table></figure>

<h3 id="条件删除"><a href="#条件删除" class="headerlink" title="条件删除"></a>条件删除</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.User.destroy(&#123;</span><br><span class="line">   where: &#123;</span><br><span class="line">       name: <span class="string">&quot;批量修改&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.Post.destroy(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">        id: posts</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="重载实例"><a href="#重载实例" class="headerlink" title="重载实例"></a>重载实例</h2><p>如果你需要让你的实例同步,你可以使用 <code>reload</code> 方法. 它将从数据库中获取当前数据,并覆盖调用该方法的模型的属性.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Person.findOne(&#123; <span class="attr">where</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;john&#x27;</span> &#125; &#125;).then(<span class="function"><span class="params">person</span> =&gt;</span> &#123;</span><br><span class="line">  person.name = <span class="string">&#x27;jane&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(person.name) <span class="comment">// &#x27;jane&#x27;</span></span><br><span class="line"></span><br><span class="line">  person.reload().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(person.name) <span class="comment">// &#x27;john&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="模型自定义方法"><a href="#模型自定义方法" class="headerlink" title="模型自定义方法"></a>模型自定义方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型</span></span><br><span class="line"><span class="comment">// 模型自定义方法</span></span><br><span class="line">topic_user.ceshi = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;模型自定义方法&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(param);</span><br><span class="line">    <span class="keyword">return</span> param;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制器</span></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.model.TopicUser.ceshi(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>



<h2 id="Scopes-作用域（重点）"><a href="#Scopes-作用域（重点）" class="headerlink" title="Scopes - 作用域（重点）"></a>Scopes - 作用域（重点）</h2><p>作用域允许你定义常用查询,以便以后轻松使用. 作用域可以包括与常规查找器 <code>where</code>, <code>include</code>, <code>limit</code> 等所有相同的属性.</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>作用域在模型定义中定义,可以是finder对象或返回finder对象的函数,除了默认作用域,该作用域只能是一个对象:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Project.init(&#123;</span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  defaultScope: &#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      active: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  scopes: &#123;</span><br><span class="line">    deleted: &#123;</span><br><span class="line">      where: &#123;</span><br><span class="line">        deleted: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    activeUsers: &#123;</span><br><span class="line">      include: [</span><br><span class="line">        &#123; <span class="attr">model</span>: User, <span class="attr">where</span>: &#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    random () &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">          someNumber: <span class="built_in">Math</span>.random()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    accessLevel (value) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">          accessLevel: &#123;</span><br><span class="line">            [Op.gte]: value</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sequelize,</span><br><span class="line">    modelName: <span class="string">&#x27;project&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过调用 <code>addScope</code> 定义模型后,还可以添加作用域. 这对于具有包含的作用域特别有用,其中在定义其他模型时可能不会定义 include 中的模型.</p>
<p>始终应用默认作用域. 这意味着,通过上面的模型定义,<code>Project.findAll()</code> 将创建以下查询:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM projects WHERE active = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>可以通过调用 <code>.unscoped()</code>, <code>.scope(null)</code> 或通过调用另一个作用域来删除默认作用域:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Project.scope(<span class="string">&#x27;deleted&#x27;</span>).findAll(); <span class="comment">// 删除默认作用域</span></span><br><span class="line">SELECT * FROM projects WHERE deleted = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>还可以在作用域定义中包含作用域模型. 这让你避免重复 <code>include</code>,<code>attributes</code> 或 <code>where</code> 定义.</p>
<p>使用上面的例子,并在包含的用户模型中调用 <code>active</code> 作用域(而不是直接在该 include 对象中指定条件):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">activeUsers: &#123;</span><br><span class="line">  include: [</span><br><span class="line">    &#123; <span class="attr">model</span>: User.scope(<span class="string">&#x27;active&#x27;</span>)&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>通过在模型定义上调用 <code>.scope</code> 来应用作用域,传递一个或多个作用域的名称. <code>.scope</code> 返回一个全功能的模型实例,它具有所有常规的方法:<code>.findAll</code>,<code>.update</code>,<code>.count</code>,<code>.destroy</code>等等.你可以保存这个模型实例并稍后再次使用:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DeletedProjects = Project.scope(<span class="string">&#x27;deleted&#x27;</span>);</span><br><span class="line"></span><br><span class="line">DeletedProjects.findAll();</span><br><span class="line"><span class="comment">// 过一段时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 让我们再次寻找被删除的项目！</span></span><br><span class="line">DeletedProjects.findAll();</span><br></pre></td></tr></table></figure>

<p>作用域适用于 <code>.find</code>, <code>.findAll</code>, <code>.count</code>, <code>.update</code>, <code>.increment</code> 和 <code>.destroy</code>.</p>
<p>可以通过两种方式调用作为函数的作用域. 如果作用域没有任何参数,它可以正常调用. 如果作用域采用参数,则传递一个对象:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Project.scope(<span class="string">&#x27;random&#x27;</span>, &#123; <span class="attr">method</span>: [<span class="string">&#x27;accessLevel&#x27;</span>, <span class="number">19</span>]&#125;).findAll();</span><br><span class="line">SELECT * FROM projects WHERE someNumber = <span class="number">42</span> AND accessLevel &gt;= <span class="number">19</span></span><br></pre></td></tr></table></figure>



<h3 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h3><p>通过将作用域数组传递到 <code>.scope</code> 或通过将作用域作为连续参数传递,可以同时应用多个作用域.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这两个是等价的</span></span><br><span class="line">Project.scope(<span class="string">&#x27;deleted&#x27;</span>, <span class="string">&#x27;activeUsers&#x27;</span>).findAll();</span><br><span class="line">Project.scope([<span class="string">&#x27;deleted&#x27;</span>, <span class="string">&#x27;activeUsers&#x27;</span>]).findAll();</span><br><span class="line">SELECT * FROM projects</span><br><span class="line">INNER JOIN users ON projects.userId = users.id</span><br><span class="line">WHERE projects.deleted = <span class="literal">true</span></span><br><span class="line">AND users.active = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>如果要将其他作用域与默认作用域一起应用,请将键 <code>defaultScope</code> 传递给 <code>.scope</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Project.scope(<span class="string">&#x27;defaultScope&#x27;</span>, <span class="string">&#x27;deleted&#x27;</span>).findAll();</span><br><span class="line">SELECT * FROM projects WHERE active = <span class="literal">true</span> AND deleted = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>当调用多个作用域时,后续作用域的键将覆盖以前的作用域(类似于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>),除了<code>where</code>和<code>include</code>,它们将被合并. 考虑两个作用域:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  scope1: &#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      firstName: <span class="string">&#x27;bob&#x27;</span>,</span><br><span class="line">      age: &#123;</span><br><span class="line">        [Op.gt]: <span class="number">20</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    limit: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  scope2: &#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      age: &#123;</span><br><span class="line">        [Op.gt]: <span class="number">30</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    limit: <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 <code>.scope(&#39;scope1&#39;, &#39;scope2&#39;)</code> 将产生以下查询</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE firstName = <span class="string">&#x27;bob&#x27;</span> AND age &gt; <span class="number">30</span> LIMIT <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>注意 <code>scope2</code> 将覆盖 <code>limit</code> 和 <code>age</code>,而 <code>firstName</code> 被保留. <code>limit</code>,<code>offset</code>,<code>order</code>,<code>paranoid</code>,<code>lock</code>和<code>raw</code>字段被覆盖,而<code>where</code>被浅层合并(意味着相同的键将被覆盖). <code>include</code> 的合并策略将在后面讨论.</p>
<p>请注意,多个应用作用域的 <code>attributes</code> 键以这样的方式合并,即始终保留 <code>attributes.exclude</code>. 这允许合并多个作用域,并且永远不会泄漏最终作用域内的敏感字段.</p>
<p>将查找对象直接传递给作用域模型上的<code>findAll</code>(和类似的查找程序)时,适用相同的合并逻辑:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Project.scope(<span class="string">&#x27;deleted&#x27;</span>).findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    firstName: <span class="string">&#x27;john&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">WHERE deleted = <span class="literal">true</span> AND firstName = <span class="string">&#x27;john&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这里的 <code>deleted</code> 作用域与 finder 合并. 如果我们要将 <code>where: &#123; firstName: &#39;john&#39;, deleted: false &#125;</code> 传递给 finder,那么 <code>deleted</code> 作用域将被覆盖.</p>
<h4 id="合并-include"><a href="#合并-include" class="headerlink" title="合并 include"></a>合并 include</h4><p>Include 是根据包含的模型递归合并的. 这是一个非常强大的合并,在 v5 上添加,并通过示例更好地理解.</p>
<p>考虑四种模型:Foo,Bar,Baz和Qux,具有如下多种关联:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Qux</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Foo.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize &#125;);</span><br><span class="line">Bar.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize &#125;);</span><br><span class="line">Baz.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize &#125;);</span><br><span class="line">Qux.init(&#123; <span class="attr">name</span>: Sequelize.STRING &#125;, &#123; sequelize &#125;);</span><br><span class="line">Foo.hasMany(Bar, &#123; <span class="attr">foreignKey</span>: <span class="string">&#x27;fooId&#x27;</span> &#125;);</span><br><span class="line">Bar.hasMany(Baz, &#123; <span class="attr">foreignKey</span>: <span class="string">&#x27;barId&#x27;</span> &#125;);</span><br><span class="line">Baz.hasMany(Qux, &#123; <span class="attr">foreignKey</span>: <span class="string">&#x27;bazId&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>现在,考虑Foo上定义的以下四个作用域:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  includeEverything: &#123;</span><br><span class="line">    include: &#123;</span><br><span class="line">      model: <span class="built_in">this</span>.Bar,</span><br><span class="line">      include: [&#123;</span><br><span class="line">        model: <span class="built_in">this</span>.Baz,</span><br><span class="line">        include: <span class="built_in">this</span>.Qux</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  limitedBars: &#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">      model: <span class="built_in">this</span>.Bar,</span><br><span class="line">      limit: <span class="number">2</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  limitedBazs: &#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">      model: <span class="built_in">this</span>.Bar,</span><br><span class="line">      include: [&#123;</span><br><span class="line">        model: <span class="built_in">this</span>.Baz,</span><br><span class="line">        limit: <span class="number">2</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  excludeBazName: &#123;</span><br><span class="line">    include: [&#123;</span><br><span class="line">      model: <span class="built_in">this</span>.Bar,</span><br><span class="line">      include: [&#123;</span><br><span class="line">        model: <span class="built_in">this</span>.Baz,</span><br><span class="line">        attributes: &#123;</span><br><span class="line">          exclude: [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这四个作用域可以很容易地深度合并,例如通过调用 <code>Foo.scope(&#39;includeEverything&#39;, &#39;limitedBars&#39;, &#39;limitedBazs&#39;, &#39;excludeBazName&#39;).findAll()</code>,这完全等同于调用以下内容:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Foo.findAll(&#123;</span><br><span class="line">  include: &#123;</span><br><span class="line">    model: <span class="built_in">this</span>.Bar,</span><br><span class="line">    limit: <span class="number">2</span>,</span><br><span class="line">    include: [&#123;</span><br><span class="line">      model: <span class="built_in">this</span>.Baz,</span><br><span class="line">      limit: <span class="number">2</span>,</span><br><span class="line">      attributes: &#123;</span><br><span class="line">        exclude: [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      include: <span class="built_in">this</span>.Qux</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>观察四个作用域如何合并为一个. 根据所包含的模型合并作用域的include. 如果一个作用域包括模型A而另一个作用域包括模型B,则合并结果将包括模型A和B.另一方面,如果两个作用域包括相同的模型A,但具有不同的参数(例如嵌套include或其他属性) ,这些将以递归方式合并,如上所示.</p>
<p>无论应用于作用域的顺序如何,上面说明的合并都以完全相同的方式工作. 如果某个参数由两个不同的作用域设置,那么只会该顺序产生差异 - 这不是上述示例的情况,因为每个作用域都做了不同的事情.</p>
<p>这种合并策略的工作方式与传递给<code>.findAll</code>,<code>.findOne</code>等的参数完全相同.</p>
<h3 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h3><p>Sequelize 与关联有两个不同但相关的作用域概念. 差异是微妙但重要的:</p>
<ul>
<li><strong>关联作用域</strong> 允许你在获取和设置关联时指定默认属性 - 在实现多态关联时很有用. 当使用<code>get</code>,<code>set</code>,<code>add</code>和<code>create</code>相关联的模型函数时,这个作用域仅在两个模型之间的关联上被调用</li>
<li><strong>关联模型上的作用域</strong> 允许你在获取关联时应用默认和其他作用域,并允许你在创建关联时传递作用域模型. 这些作用域都适用于模型上的常规查找和通过关联查找.</li>
</ul>
<p>举个例子,思考模型Post和Comment. Comment与其他几个模型(图像,视频等)相关联,Comment和其他模型之间的关联是多态的,这意味着除了外键 <code>commentable_id</code> 之外,注释还存储一个<code>commentable</code>列.</p>
<p>可以使用 association scope 来实现多态关联:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.Post.hasMany(<span class="built_in">this</span>.Comment, &#123;</span><br><span class="line">  foreignKey: <span class="string">&#x27;commentable_id&#x27;</span>,</span><br><span class="line">  scope: &#123;</span><br><span class="line">    commentable: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当调用 <code>post.getComments()</code> 时,这将自动添加 <code>WHERE commentable = &#39;post&#39;</code>. 类似地,当向帖子添加新的注释时,<code>commentable</code> 会自动设置为 <code>&#39;post&#39;</code>. 关联作用域是为了存活于后台,没有程序员不必担心 - 它不能被禁用. 有关更完整的多态性示例,请参阅 <a target="_blank" rel="noopener" href="https://itfun.tv/documents/272#scopes">关联作用域</a></p>
<p>那么考虑那个Post的默认作用域只显示活动的帖子:<code>where: &#123; active: true &#125;</code>. 该作用域存在于相关联的模型(Post)上,而不是像<code>commentable</code> 作用域那样在关联上. 就像在调用<code>Post.findAll()</code> 时一样应用默认作用域,当调用 <code>User.getPosts()</code> 时,它也会被应用 - 这只会返回该用户的活动帖子.</p>
<p>要禁用默认作用域,将 <code>scope: null</code> 传递给 getter: <code>User.getPosts(&#123; scope: null &#125;)</code>. 同样,如果要应用其他作用域,请像这样:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.getPosts(&#123; <span class="attr">scope</span>: [<span class="string">&#x27;scope1&#x27;</span>, <span class="string">&#x27;scope2&#x27;</span>]&#125;);</span><br></pre></td></tr></table></figure>

<p>如果要为关联模型上的作用域创建快捷方式,可以将作用域模型传递给关联. 考虑一个快捷方式来获取用户所有已删除的帖子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br><span class="line">Post.init(attributes, &#123;</span><br><span class="line">  defaultScope: &#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      active: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  scopes: &#123;</span><br><span class="line">    deleted: &#123;</span><br><span class="line">      where: &#123;</span><br><span class="line">        deleted: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  sequelize,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">User.hasMany(Post); <span class="comment">// 常规 getPosts 关联</span></span><br><span class="line">User.hasMany(Post.scope(<span class="string">&#x27;deleted&#x27;</span>), &#123; <span class="attr">as</span>: <span class="string">&#x27;deletedPosts&#x27;</span> &#125;);</span><br><span class="line">User.getPosts(); <span class="comment">// WHERE active = true</span></span><br><span class="line">User.getDeletedPosts(); <span class="comment">// WHERE deleted = true</span></span><br></pre></td></tr></table></figure>



<h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><p>extend/helper.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/extend/helper.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 扩展一个格式日期的方法</span></span><br><span class="line">    <span class="function"><span class="title">formatTime</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(val * <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> d.getFullYear();</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>模板中调用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=helper.formatTime(dateline)%&gt;</span><br></pre></td></tr></table></figure>

<p>其他地方调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.ctx.helper.formatTime(dateline)</span><br></pre></td></tr></table></figure>





<h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><h2 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h2><p>app/middleware/getIp.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">options: 中间件的配置项，框架会将 app.config[$&#123;middlewareName&#125;] 传递进来。</span></span><br><span class="line"><span class="comment">app: 当前应用 Application 的实例。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 返回一个异步的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 通过option传入额外参数</span></span><br><span class="line">        <span class="built_in">console</span>.log(option);</span><br><span class="line">        <span class="built_in">console</span>.log(ctx.request.ip);</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><p>config/config.default.js（配置全局中间件，所有路由都会调用）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">appInfo</span> =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 配置全局中间件</span></span><br><span class="line">    config.middleware = [<span class="string">&#x27;getIp&#x27;</span>]; <span class="comment">// 注意驼峰式写法，如果中间件是a_bc.js，则要写成aBc</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置中间件参数</span></span><br><span class="line">    config.getIp = &#123;</span><br><span class="line">        ceshi: <span class="number">123</span>,</span><br><span class="line">        <span class="comment">// 通用配置（以下是重点）</span></span><br><span class="line">        enable:<span class="literal">true</span>, <span class="comment">// 控制中间件是否开启。</span></span><br><span class="line">        match:<span class="string">&#x27;/news&#x27;</span>, <span class="comment">// 设置只有符合某些规则的请求才会经过这个中间件（匹配路由）</span></span><br><span class="line">        ignore:<span class="string">&#x27;/shop&#x27;</span> <span class="comment">// 设置符合某些规则的请求不经过这个中间件。</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        注意：</span></span><br><span class="line"><span class="comment">        1. match 和 ignore 不允许同时配置</span></span><br><span class="line"><span class="comment">        2. 例如：match:&#x27;/news&#x27;，只要包含/news的任何页面都生效</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// match 和 ignore 支持多种类型的配置方式：字符串、正则、函数（推荐）</span></span><br><span class="line">        <span class="function"><span class="title">match</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">          <span class="comment">// 只有 ios 设备才开启</span></span><br><span class="line">          <span class="keyword">const</span> reg = <span class="regexp">/iphone|ipad|ipod/i</span>;</span><br><span class="line">          <span class="keyword">return</span> reg.test(ctx.get(<span class="string">&#x27;user-agent&#x27;</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h2><h3 id="路由中使用"><a href="#路由中使用" class="headerlink" title="路由中使用"></a>路由中使用</h3><p>app/router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 局部中间件（如果只需要局部调用，则不需要在config.default.js中配置）</span></span><br><span class="line">    router.get(<span class="string">&#x27;/admin/:id&#x27;</span>, app.middleware.getIp(&#123; </span><br><span class="line">        ceshi: <span class="string">&quot;我是admin&quot;</span> </span><br><span class="line">    &#125;), controller.admin.index);</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="使用-Koa-的中间件（gzip压缩）"><a href="#使用-Koa-的中间件（gzip压缩）" class="headerlink" title="使用 Koa 的中间件（gzip压缩）"></a>使用 Koa 的中间件（gzip压缩）</h3><p>大大提高网站的访问速度（非常有效）</p>
<p>以 <a target="_blank" rel="noopener" href="https://github.com/koajs/compress">koa-compress</a> 为例，在 Koa 中使用时：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> compress = <span class="built_in">require</span>(<span class="string">&#x27;koa-compress&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = koa();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">threshold</span>: <span class="number">2048</span> &#125;;</span><br><span class="line">app.use(compress(options));</span><br></pre></td></tr></table></figure>

<p>我们按照框架的规范来在应用中加载这个 Koa 的中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/middleware/compress.js</span></span><br><span class="line"><span class="comment">// koa-compress 暴露的接口(`(options) =&gt; middleware`)和框架对中间件要求一致</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">&#x27;koa-compress&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  middleware: [ <span class="string">&#x27;compress&#x27;</span> ],</span><br><span class="line">  compress: &#123;</span><br><span class="line">    threshold: <span class="number">2048</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h1 id="表单提交"><a href="#表单提交" class="headerlink" title="表单提交"></a>表单提交</h1><h2 id="post"><a href="#post" class="headerlink" title="post"></a>post</h2><p>app/controller/home.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">addInput</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">&#x27;post&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 通过ctx.request.body获取post提交数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(ctx.request.body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>app/view/post.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">需要定义：?_csrf=&lt;%=ctx.csrf%&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/add?_csrf=&lt;%=ctx.csrf%&gt;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>app/router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/post&#x27;</span>, controller.home.addInput);</span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, controller.home.add);</span><br></pre></td></tr></table></figure>









<h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.设置</span></span><br><span class="line">ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ceshi&#x27;</span>);</span><br><span class="line"><span class="comment">// 2.获取</span></span><br><span class="line">ctx.cookies.get(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.设置中文(加密操作 encrypt: true)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.设置（其他参数配置）</span></span><br><span class="line">ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ceshi&#x27;</span>, &#123;</span><br><span class="line">    maxAge: <span class="number">1000</span> * <span class="number">3600</span> * <span class="number">24</span>, <span class="comment">// 存储24小时，单位毫秒，关闭浏览器cookie还存在</span></span><br><span class="line">    httpOnly: <span class="literal">true</span>, <span class="comment">// 设置键值对是否可以被 js 访问，默认为 true，不允许被 js 访问。</span></span><br><span class="line">    signed: <span class="literal">true</span>, <span class="comment">// 签名，防止用户前台修改</span></span><br><span class="line">    encrypt: <span class="literal">true</span> <span class="comment">// 加密，注意：get获取时需要解密</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 5.获取时解密</span></span><br><span class="line">ctx.cookies.get(<span class="string">&#x27;username&#x27;</span>,&#123;</span><br><span class="line">    encrypt: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.清除cookie</span></span><br><span class="line">ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>



<h1 id="session"><a href="#session" class="headerlink" title="session"></a>session</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.设置</span></span><br><span class="line">ctx.session.username = <span class="string">&#x27;测试&#x27;</span>;</span><br><span class="line"><span class="comment">// 2.获取</span></span><br><span class="line">ctx.session.username</span><br><span class="line"><span class="comment">// 3.默认配置（全局配置，config/config.default.js）</span></span><br><span class="line"><span class="built_in">exports</span>.session = &#123;</span><br><span class="line">  key: <span class="string">&#x27;EGG_SESS&#x27;</span>, <span class="comment">// 设置cookies的key值</span></span><br><span class="line">  maxAge: <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>, <span class="comment">// 1 天，过期时间</span></span><br><span class="line">  httpOnly: <span class="literal">true</span>, <span class="comment">// 设置键值对是否可以被 js 访问，默认为 true，不允许被 js 访问。</span></span><br><span class="line">  encrypt: <span class="literal">true</span>,<span class="comment">// 加密</span></span><br><span class="line">  renew:<span class="literal">true</span>    <span class="comment">// 每次刷新页面都会被延期</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 4.动态配置</span></span><br><span class="line">ctx.session.maxAge = <span class="number">5000</span>; <span class="comment">// 5秒的过期时间</span></span><br><span class="line">ctx.session.username = <span class="string">&#x27;测试&#x27;</span>;</span><br><span class="line"><span class="comment">// 5.清空session</span></span><br><span class="line">ctx.session.username = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>



<h1 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/schedule/ceshi.js</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 设置定时任务的执行间隔等配置</span></span><br><span class="line">    schedule: &#123;</span><br><span class="line">        interval: <span class="string">&#x27;5s&#x27;</span>, <span class="comment">// 每5秒执行一次</span></span><br><span class="line">        type: <span class="string">&#x27;all&#x27;</span> <span class="comment">// 指定所有的 worker 都需要执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 任务</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">task</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">        ++i;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><h2 id="1-context"><a href="#1-context" class="headerlink" title="1. context"></a>1. context</h2><h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">ceshi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 通过ctx中的curl方法获取数据</span></span><br><span class="line">    <span class="keyword">let</span> r = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.curl(<span class="string">&#x27;http://www.phonegap100.com/appapi.php?a=getPortalList&amp;catid=20&amp;page=1&#x27;</span>);</span><br><span class="line">    <span class="comment">// 将buffer类型数据转为json类型</span></span><br><span class="line">    <span class="keyword">let</span> &#123; result &#125; = <span class="built_in">JSON</span>.parse(r.data)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h1><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/egg-cache">https://www.npmjs.com/package/egg-cache</a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/egg-redis">https://www.npmjs.com/package/egg-redis</a></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p><a target="_blank" rel="noopener" href="https://github.com/temool/egg-validate-plus">https://github.com/temool/egg-validate-plus</a></p>
<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/egg-jwt">https://www.npmjs.com/package/egg-jwt</a></p>
<p>前端访问：header头添加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authorization:&quot;Bearer token值&quot;</span></span><br><span class="line">Authorization:<span class="string">&quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6MTIzLCJpYXQiOjE1NzkxOTQxNTN9.Ml5B02ZPfYo78QwJic-Jdp2LUi2_AU0RGNgPhhJH--o&quot;</span></span><br></pre></td></tr></table></figure>














                      

                        
                          <div class="page-reward">
                            <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
                              <div class="tooltip tooltip-east">
                                <span class="tooltip-item">
                                  赏
                                </span>
                                <span class="tooltip-content">
                                  <span class="tooltip-text">
                                    <span class="tooltip-inner">
                                      <p class="reward-p"><i class="icon icon-quo-left"></i>
                                        谢谢你请我吃糖果<i class="icon icon-quo-right"></i>
                                      </p>
                                      <div class="reward-box">
                                        
                                          <div class="reward-box-item">
                                            <img class="reward-img" src="/img/alipay.jpg">
                                            <span class="reward-type">支付宝</span>
                                          </div>
                                          
                                            
                                              <div class="reward-box-item">
                                                <img class="reward-img" src="/img/weixinpay.png">
                                                <span class="reward-type">微信</span>
                                              </div>
                                              
                                      </div>
                                    </span>
                                  </span>
                                </span>
                              </div>
                            </a>
                          </div>
                          

                            
                              <div class="declare">
                                <ul class="post-copyright">
                                  <li>
                                    <strong>本文作者：</strong>
                                    yixiang xiao
                                  </li>
                                  <li>
                                    <strong>本文链接：</strong>
                                    <a href="http://yixiangxiao.github.io/2024/12/28/egg学习笔记/" title="egg学习笔记"
                                      target="_blank">
                                      http://yixiangxiao.github.io/2024/12/28/egg学习笔记/
                                    </a>
                                  </li>
                                  
                                    <li>
                                      <strong>版权声明： </strong>
                                      
                                        本博客所有文章除特别声明外，均采用 <a href="https://github.com/JoeyBling/hexo-theme-yilia-plus/blob/master/LICENSE" rel="external nofollow" target="_blank">MIT</a> 许可协议。转载请注明出处！
                                    </li>
                                    
                                </ul>
                              </div>
                              

        </div>
        <div class="article-info article-info-index">
          
              
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">egg</a>
        		</li>
      		
		</ul>
	</div>

                
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/node//" class="article-tag-list-link color5">node</a>
        		</li>
      		
		</ul>
	</div>


                  

                      
                        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=http://yixiangxiao.github.io/2024/12/28/egg%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

                          
                            <div class="clearfix"></div>
        </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2025/02/05/%E4%BB%BF%E5%BE%AE%E4%BF%A1%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          仿微信后端开发文档
        
      </div>
    </a>
  
  
    <a href="/2024/10/28/egg%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">egg基础教程</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>

    
      <aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
                
    </div>
</aside>


        

          

                

                    

                          
                            
  <div id="gitment-ctn"></div>
  
    <!-- 中文 -->
    <link rel="stylesheet" href="/lib/gitment.css">
    <script src="/lib/gitment.js"></script>
  
  <script>
    <!-- id: "egg学习笔记" -->
    var gitment = new Gitment({
      id: "20241228215652",
      owner: 'yixiangxiao',
      repo: 'yixiangxiao.github.io',
      oauth: {
        client_id: '33599c64285c4edbc8e6',
        client_secret: '3e5f2f5ee6a1ccae9a732694d477b2f1089c8bf9',
      },
    })
    gitment.render('gitment-ctn')
  </script>


                              

                                
          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018-2025 <a href="http://yixiangxiao.github.io/" target="_blank">yixiang xiao</a>
    	</div>
      	<div class="footer-right">
			
			
      		GitHub:<a href="https://github.com/yixiangxiao/yixiangxiao.github.io" target="_blank">yixiangxiao</a> by Litten
      	</div>
    </div>
  </div>

<!-- 《网站备案号 -->

    <div class="BeiAn-info">
        <a href="http://www.beian.miit.gov.cn/" style="color:#f72b07" target="_blank" title="备案号">
            粤ICP备19079073号
        </a>
    </div>

<!-- 网站备案号》 -->
  
  
	<script src="/lib/busuanzi.pure.js"></script>
	
  
  
	
	<span id="busuanzi_container_site_pv" style="display:none">
		本站总访问量<span id="busuanzi_value_site_pv"></span>次	
	        <span class="post-meta-divider" >|</span>
	</span>
  	<span id="busuanzi_container_site_uv" style='display:none'>
  		本站访客数<span id="busuanzi_value_site_uv"></span>人
  	</span>
</br>
<!--《添加网站运行时间 -->
<!--<br/>-->
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();

    function createtime() {
        var grt = new Date("10/25/2020 12:00:00"); //此处修改你的建站时间或者网站上线时间 
        now.setTime(now.getTime() + 250);
        days = (now - grt) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if (String(hnum).length == 1) {
            hnum = "0" + hnum;
        }
        minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if (String(mnum).length == 1) {
            mnum = "0" + mnum;
        }
        seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if (String(snum).length == 1) {
            snum = "0" + snum;
        }
        document.getElementById("timeDate").innerHTML = " | 本站已安全运行 " + dnum + " 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval("createtime()", 250);
</script>

  
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
			isArchive: false,
				isTag: false,
					isCategory: false,
						open_in_new: true,
							toc_hide_index: true,
								root: "/",
									innerArchive: true,
										showTags: true
	}
</script>

<script>!function (r) { function e(t) { if (i[t]) return i[t].exports; var n = i[t] = { exports: {}, id: t, loaded: !1 }; return r[t].call(n.exports, n, n.exports, e), n.loaded = !0, n.exports } var i = {}; e.m = r, e.c = i, e.p = "./", e(0) }([function (t, n, r) { r(208), t.exports = r(205) }, function (t, n, r) { var d = r(3), y = r(46), g = r(26), b = r(27), x = r(47), m = "prototype", S = function (t, n, r) { var e, i, o, u, c = t & S.F, f = t & S.G, a = t & S.S, s = t & S.P, l = t & S.B, h = f ? d : a ? d[n] || (d[n] = {}) : (d[n] || {})[m], v = f ? y : y[n] || (y[n] = {}), p = v[m] || (v[m] = {}); for (e in f && (r = n), r) o = ((i = !c && h && void 0 !== h[e]) ? h : r)[e], u = l && i ? x(o, d) : s && "function" == typeof o ? x(Function.call, o) : o, h && b(h, e, o, t & S.U), v[e] != o && g(v, e, u), s && p[e] != o && (p[e] = o) }; d.core = y, S.F = 1, S.G = 2, S.S = 4, S.P = 8, S.B = 16, S.W = 32, S.U = 64, S.R = 128, t.exports = S }, function (t, n, r) { var e = r(5); t.exports = function (t) { if (!e(t)) throw TypeError(t + " is not an object!"); return t } }, function (t, n) { var r = t.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = r) }, function (t, n) { t.exports = function (t) { try { return !!t() } catch (t) { return !0 } } }, function (t, n) { t.exports = function (t) { return "object" == typeof t ? null !== t : "function" == typeof t } }, function (t, n) { var r = t.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")(); "number" == typeof __g && (__g = r) }, function (t, n, r) { var e = r(118)("wks"), i = r(79), o = r(3).Symbol, u = "function" == typeof o; (t.exports = function (t) { return e[t] || (e[t] = u && o[t] || (u ? o : i)("Symbol." + t)) }).store = e }, function (t, n, r) { var e = r(49), i = Math.min; t.exports = function (t) { return 0 < t ? i(e(t), 9007199254740991) : 0 } }, function (t, n) { var r = {}.hasOwnProperty; t.exports = function (t, n) { return r.call(t, n) } }, function (t, n, r) { t.exports = !r(4)(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }) }, function (t, n, r) { var e = r(2), i = r(174), o = r(53), u = Object.defineProperty; n.f = r(10) ? Object.defineProperty : function (t, n, r) { if (e(t), n = o(n, !0), e(r), i) try { return u(t, n, r) } catch (t) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (t[n] = r.value), t } }, function (t, n, r) { t.exports = !r(20)(function () { return 7 != Object.defineProperty({}, "a", { get: function () { return 7 } }).a }) }, function (t, n, r) { var e = r(14), i = r(24); t.exports = r(12) ? function (t, n, r) { return e.f(t, n, i(1, r)) } : function (t, n, r) { return t[n] = r, t } }, function (t, n, r) { var e = r(22), i = r(60), o = r(42), u = Object.defineProperty; n.f = r(12) ? Object.defineProperty : function (t, n, r) { if (e(t), n = o(n, !0), e(r), i) try { return u(t, n, r) } catch (t) { } if ("get" in r || "set" in r) throw TypeError("Accessors not supported!"); return "value" in r && (t[n] = r.value), t } }, function (t, n, r) { var e = r(96), i = r(34); t.exports = function (t) { return e(i(t)) } }, function (t, n, r) { var e = r(40)("wks"), i = r(25), o = r(6).Symbol, u = "function" == typeof o; (t.exports = function (t) { return e[t] || (e[t] = u && o[t] || (u ? o : i)("Symbol." + t)) }).store = e }, function (t, n, r) { var e = r(51); t.exports = function (t) { return Object(e(t)) } }, function (t, n) { t.exports = function (t) { return "object" == typeof t ? null !== t : "function" == typeof t } }, function (t, n) { var r = t.exports = { version: "2.6.9" }; "number" == typeof __e && (__e = r) }, function (t, n) { t.exports = function (t) { try { return !!t() } catch (t) { return !0 } } }, function (t, n) { t.exports = function (t) { if ("function" != typeof t) throw TypeError(t + " is not a function!"); return t } }, function (t, n, r) { var e = r(18); t.exports = function (t) { if (!e(t)) throw TypeError(t + " is not an object!"); return t } }, function (t, n) { t.exports = !0 }, function (t, n) { t.exports = function (t, n) { return { enumerable: !(1 & t), configurable: !(2 & t), writable: !(4 & t), value: n } } }, function (t, n) { var r = 0, e = Math.random(); t.exports = function (t) { return "Symbol(".concat(void 0 === t ? "" : t, ")_", (++r + e).toString(36)) } }, function (t, n, r) { var e = r(11), i = r(75); t.exports = r(10) ? function (t, n, r) { return e.f(t, n, i(1, r)) } : function (t, n, r) { return t[n] = r, t } }, function (t, n, r) { var o = r(3), u = r(26), c = r(30), f = r(79)("src"), e = r(219), i = "toString", a = ("" + e).split(i); r(46).inspectSource = function (t) { return e.call(t) }, (t.exports = function (t, n, r, e) { var i = "function" == typeof r; i && (c(r, "name") || u(r, "name", n)), t[n] !== r && (i && (c(r, f) || u(r, f, t[n] ? "" + t[n] : a.join(String(n)))), t === o ? t[n] = r : e ? t[n] ? t[n] = r : u(t, n, r) : (delete t[n], u(t, n, r))) })(Function.prototype, i, function () { return "function" == typeof this && this[f] || e.call(this) }) }, function (t, n, r) { var e = r(1), i = r(4), u = r(51), c = /"/g, o = function (t, n, r, e) { var i = String(u(t)), o = "<" + n; return "" !== r && (o += " " + r + '="' + String(e).replace(c, "&quot;") + '"'), o + ">" + i + "</" + n + ">" }; t.exports = function (n, t) { var r = {}; r[n] = t(o), e(e.P + e.F * i(function () { var t = ""[n]('"'); return t !== t.toLowerCase() || 3 < t.split('"').length }), "String", r) } }, function (t, n, r) { var e = r(65), i = r(35); t.exports = Object.keys || function (t) { return e(t, i) } }, function (t, n) { var r = {}.hasOwnProperty; t.exports = function (t, n) { return r.call(t, n) } }, function (t, n, r) { var e = r(117), i = r(75), o = r(33), u = r(53), c = r(30), f = r(174), a = Object.getOwnPropertyDescriptor; n.f = r(10) ? a : function (t, n) { if (t = o(t), n = u(n, !0), f) try { return a(t, n) } catch (t) { } if (c(t, n)) return i(!e.f.call(t, n), t[n]) } }, function (t, n, r) { var e = r(30), i = r(17), o = r(154)("IE_PROTO"), u = Object.prototype; t.exports = Object.getPrototypeOf || function (t) { return t = i(t), e(t, o) ? t[o] : "function" == typeof t.constructor && t instanceof t.constructor ? t.constructor.prototype : t instanceof Object ? u : null } }, function (t, n, r) { var e = r(116), i = r(51); t.exports = function (t) { return e(i(t)) } }, function (t, n) { t.exports = function (t) { if (null == t) throw TypeError("Can't call method on  " + t); return t } }, function (t, n) { t.exports = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",") }, function (t, n) { t.exports = {} }, function (t, n) { n.f = {}.propertyIsEnumerable }, function (t, n, r) { var e = r(14).f, i = r(9), o = r(16)("toStringTag"); t.exports = function (t, n, r) { t && !i(t = r ? t : t.prototype, o) && e(t, o, { configurable: !0, value: n }) } }, function (t, n, r) { var e = r(40)("keys"), i = r(25); t.exports = function (t) { return e[t] || (e[t] = i(t)) } }, function (t, n, r) { var e = r(19), i = r(6), o = "__core-js_shared__", u = i[o] || (i[o] = {}); (t.exports = function (t, n) { return u[t] || (u[t] = void 0 !== n ? n : {}) })("versions", []).push({ version: e.version, mode: r(23) ? "pure" : "global", copyright: "© 2019 Denis Pushkarev (zloirock.ru)" }) }, function (t, n) { var r = Math.ceil, e = Math.floor; t.exports = function (t) { return isNaN(t = +t) ? 0 : (0 < t ? e : r)(t) } }, function (t, n, r) { var i = r(18); t.exports = function (t, n) { if (!i(t)) return t; var r, e; if (n && "function" == typeof (r = t.toString) && !i(e = r.call(t))) return e; if ("function" == typeof (r = t.valueOf) && !i(e = r.call(t))) return e; if (!n && "function" == typeof (r = t.toString) && !i(e = r.call(t))) return e; throw TypeError("Can't convert object to primitive value") } }, function (t, n, r) { var e = r(6), i = r(19), o = r(23), u = r(44), c = r(14).f; t.exports = function (t) { var n = i.Symbol || (i.Symbol = o ? {} : e.Symbol || {}); "_" == t.charAt(0) || t in n || c(n, t, { value: u.f(t) }) } }, function (t, n, r) { n.f = r(16) }, function (t, n) { var r = {}.toString; t.exports = function (t) { return r.call(t).slice(8, -1) } }, function (t, n) { var r = t.exports = { version: "2.6.9" }; "number" == typeof __e && (__e = r) }, function (t, n, r) { var o = r(21); t.exports = function (e, i, t) { if (o(e), void 0 === i) return e; switch (t) { case 1: return function (t) { return e.call(i, t) }; case 2: return function (t, n) { return e.call(i, t, n) }; case 3: return function (t, n, r) { return e.call(i, t, n, r) } }return function () { return e.apply(i, arguments) } } }, function (t, n, r) { "use strict"; var e = r(4); t.exports = function (t, n) { return !!t && e(function () { n ? t.call(null, function () { }, 1) : t.call(null) }) } }, function (t, n) { var r = Math.ceil, e = Math.floor; t.exports = function (t) { return isNaN(t = +t) ? 0 : (0 < t ? e : r)(t) } }, function (t, n, r) { var x = r(47), m = r(116), S = r(17), w = r(8), e = r(138); t.exports = function (l, t) { var h = 1 == l, v = 2 == l, p = 3 == l, d = 4 == l, y = 6 == l, g = 5 == l || y, b = t || e; return function (t, n, r) { for (var e, i, o = S(t), u = m(o), c = x(n, r, 3), f = w(u.length), a = 0, s = h ? b(t, f) : v ? b(t, 0) : void 0; a < f; a++)if ((g || a in u) && (i = c(e = u[a], a, o), l)) if (h) s[a] = i; else if (i) switch (l) { case 3: return !0; case 5: return e; case 6: return a; case 2: s.push(e) } else if (d) return !1; return y ? -1 : p || d ? d : s } } }, function (t, n) { t.exports = function (t) { if (null == t) throw TypeError("Can't call method on  " + t); return t } }, function (t, n, r) { var i = r(1), o = r(46), u = r(4); t.exports = function (t, n) { var r = (o.Object || {})[t] || Object[t], e = {}; e[t] = n(r), i(i.S + i.F * u(function () { r(1) }), "Object", e) } }, function (t, n, r) { var i = r(5); t.exports = function (t, n) { if (!i(t)) return t; var r, e; if (n && "function" == typeof (r = t.toString) && !i(e = r.call(t))) return e; if ("function" == typeof (r = t.valueOf) && !i(e = r.call(t))) return e; if (!n && "function" == typeof (r = t.toString) && !i(e = r.call(t))) return e; throw TypeError("Can't convert object to primitive value") } }, function (t, n, r) { var d = r(6), y = r(19), g = r(93), b = r(13), x = r(9), m = "prototype", S = function (t, n, r) { var e, i, o, u = t & S.F, c = t & S.G, f = t & S.S, a = t & S.P, s = t & S.B, l = t & S.W, h = c ? y : y[n] || (y[n] = {}), v = h[m], p = c ? d : f ? d[n] : (d[n] || {})[m]; for (e in c && (r = n), r) (i = !u && p && void 0 !== p[e]) && x(h, e) || (o = i ? p[e] : r[e], h[e] = c && "function" != typeof p[e] ? r[e] : s && i ? g(o, d) : l && p[e] == o ? function (e) { var t = function (t, n, r) { if (this instanceof e) { switch (arguments.length) { case 0: return new e; case 1: return new e(t); case 2: return new e(t, n) }return new e(t, n, r) } return e.apply(this, arguments) }; return t[m] = e[m], t }(o) : a && "function" == typeof o ? g(Function.call, o) : o, a && ((h.virtual || (h.virtual = {}))[e] = o, t & S.R && v && !v[e] && b(v, e, o))) }; S.F = 1, S.G = 2, S.S = 4, S.P = 8, S.B = 16, S.W = 32, S.U = 64, S.R = 128, t.exports = S }, function (t, n, r) { var e = r(34); t.exports = function (t) { return Object(e(t)) } }, function (t, n, r) { var o = r(196), e = r(1), i = r(118)("metadata"), u = i.store || (i.store = new (r(200))), c = function (t, n, r) { var e = u.get(t); if (!e) { if (!r) return; u.set(t, e = new o) } var i = e.get(n); if (!i) { if (!r) return; e.set(n, i = new o) } return i }; t.exports = { store: u, map: c, has: function (t, n, r) { var e = c(n, r, !1); return void 0 !== e && e.has(t) }, get: function (t, n, r) { var e = c(n, r, !1); return void 0 === e ? void 0 : e.get(t) }, set: function (t, n, r, e) { c(r, e, !0).set(t, n) }, keys: function (t, n) { var r = c(t, n, !1), e = []; return r && r.forEach(function (t, n) { e.push(n) }), e }, key: function (t) { return void 0 === t || "symbol" == typeof t ? t : String(t) }, exp: function (t) { e(e.S, "Reflect", t) } } }, function (t, n, r) { "use strict"; if (r(10)) { var g = r(68), b = r(3), x = r(4), m = r(1), S = r(132), e = r(159), h = r(47), w = r(70), i = r(75), _ = r(26), o = r(76), u = r(49), O = r(8), E = r(194), c = r(78), f = r(53), a = r(30), M = r(81), P = r(5), v = r(17), p = r(145), j = r(72), F = r(32), A = r(73).f, d = r(161), s = r(79), l = r(7), y = r(50), I = r(120), L = r(119), N = r(162), T = r(82), k = r(125), R = r(77), C = r(137), D = r(166), G = r(11), W = r(31), U = G.f, V = W.f, B = b.RangeError, q = b.TypeError, z = b.Uint8Array, K = "ArrayBuffer", H = "Shared" + K, J = "BYTES_PER_ELEMENT", $ = "prototype", Y = Array[$], X = e.ArrayBuffer, Q = e.DataView, Z = y(0), tt = y(2), nt = y(3), rt = y(4), et = y(5), it = y(6), ot = I(!0), ut = I(!1), ct = N.values, ft = N.keys, at = N.entries, st = Y.lastIndexOf, lt = Y.reduce, ht = Y.reduceRight, vt = Y.join, pt = Y.sort, dt = Y.slice, yt = Y.toString, gt = Y.toLocaleString, bt = l("iterator"), xt = l("toStringTag"), mt = s("typed_constructor"), St = s("def_constructor"), wt = S.CONSTR, _t = S.TYPED, Ot = S.VIEW, Et = "Wrong length!", Mt = y(1, function (t, n) { return It(L(t, t[St]), n) }), Pt = x(function () { return 1 === new z(new Uint16Array([1]).buffer)[0] }), jt = !!z && !!z[$].set && x(function () { new z(1).set({}) }), Ft = function (t, n) { var r = u(t); if (r < 0 || r % n) throw B("Wrong offset!"); return r }, At = function (t) { if (P(t) && _t in t) return t; throw q(t + " is not a typed array!") }, It = function (t, n) { if (!(P(t) && mt in t)) throw q("It is not a typed array constructor!"); return new t(n) }, Lt = function (t, n) { return Nt(L(t, t[St]), n) }, Nt = function (t, n) { for (var r = 0, e = n.length, i = It(t, e); r < e;)i[r] = n[r++]; return i }, Tt = function (t, n, r) { U(t, n, { get: function () { return this._d[r] } }) }, kt = function (t) { var n, r, e, i, o, u, c = v(t), f = arguments.length, a = 1 < f ? arguments[1] : void 0, s = void 0 !== a, l = d(c); if (null != l && !p(l)) { for (u = l.call(c), e = [], n = 0; !(o = u.next()).done; n++)e.push(o.value); c = e } for (s && 2 < f && (a = h(a, arguments[2], 2)), n = 0, r = O(c.length), i = It(this, r); n < r; n++)i[n] = s ? a(c[n], n) : c[n]; return i }, Rt = function () { for (var t = 0, n = arguments.length, r = It(this, n); t < n;)r[t] = arguments[t++]; return r }, Ct = !!z && x(function () { gt.call(new z(1)) }), Dt = function () { return gt.apply(Ct ? dt.call(At(this)) : At(this), arguments) }, Gt = { copyWithin: function (t, n) { return D.call(At(this), t, n, 2 < arguments.length ? arguments[2] : void 0) }, every: function (t) { return rt(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, fill: function (t) { return C.apply(At(this), arguments) }, filter: function (t) { return Lt(this, tt(At(this), t, 1 < arguments.length ? arguments[1] : void 0)) }, find: function (t) { return et(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, findIndex: function (t) { return it(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, forEach: function (t) { Z(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, indexOf: function (t) { return ut(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, includes: function (t) { return ot(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, join: function (t) { return vt.apply(At(this), arguments) }, lastIndexOf: function (t) { return st.apply(At(this), arguments) }, map: function (t) { return Mt(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, reduce: function (t) { return lt.apply(At(this), arguments) }, reduceRight: function (t) { return ht.apply(At(this), arguments) }, reverse: function () { for (var t, n = this, r = At(n).length, e = Math.floor(r / 2), i = 0; i < e;)t = n[i], n[i++] = n[--r], n[r] = t; return n }, some: function (t) { return nt(At(this), t, 1 < arguments.length ? arguments[1] : void 0) }, sort: function (t) { return pt.call(At(this), t) }, subarray: function (t, n) { var r = At(this), e = r.length, i = c(t, e); return new (L(r, r[St]))(r.buffer, r.byteOffset + i * r.BYTES_PER_ELEMENT, O((void 0 === n ? e : c(n, e)) - i)) } }, Wt = function (t, n) { return Lt(this, dt.call(At(this), t, n)) }, Ut = function (t) { At(this); var n = Ft(arguments[1], 1), r = this.length, e = v(t), i = O(e.length), o = 0; if (r < i + n) throw B(Et); for (; o < i;)this[n + o] = e[o++] }, Vt = { entries: function () { return at.call(At(this)) }, keys: function () { return ft.call(At(this)) }, values: function () { return ct.call(At(this)) } }, Bt = function (t, n) { return P(t) && t[_t] && "symbol" != typeof n && n in t && String(+n) == String(n) }, qt = function (t, n) { return Bt(t, n = f(n, !0)) ? i(2, t[n]) : V(t, n) }, zt = function (t, n, r) { return !(Bt(t, n = f(n, !0)) && P(r) && a(r, "value")) || a(r, "get") || a(r, "set") || r.configurable || a(r, "writable") && !r.writable || a(r, "enumerable") && !r.enumerable ? U(t, n, r) : (t[n] = r.value, t) }; wt || (W.f = qt, G.f = zt), m(m.S + m.F * !wt, "Object", { getOwnPropertyDescriptor: qt, defineProperty: zt }), x(function () { yt.call({}) }) && (yt = gt = function () { return vt.call(this) }); var Kt = o({}, Gt); o(Kt, Vt), _(Kt, bt, Vt.values), o(Kt, { slice: Wt, set: Ut, constructor: function () { }, toString: yt, toLocaleString: Dt }), Tt(Kt, "buffer", "b"), Tt(Kt, "byteOffset", "o"), Tt(Kt, "byteLength", "l"), Tt(Kt, "length", "e"), U(Kt, xt, { get: function () { return this[_t] } }), t.exports = function (t, l, n, o) { var h = t + ((o = !!o) ? "Clamped" : "") + "Array", r = "get" + t, u = "set" + t, v = b[h], c = v || {}, e = v && F(v), i = !v || !S.ABV, f = {}, a = v && v[$], p = function (t, i) { U(t, i, { get: function () { return t = i, (n = this._d).v[r](t * l + n.o, Pt); var t, n }, set: function (t) { return n = i, r = t, e = this._d, o && (r = (r = Math.round(r)) < 0 ? 0 : 255 < r ? 255 : 255 & r), void e.v[u](n * l + e.o, r, Pt); var n, r, e }, enumerable: !0 }) }; i ? (v = n(function (t, n, r, e) { w(t, v, h, "_d"); var i, o, u, c, f = 0, a = 0; if (P(n)) { if (!(n instanceof X || (c = M(n)) == K || c == H)) return _t in n ? Nt(v, n) : kt.call(v, n); i = n, a = Ft(r, l); var s = n.byteLength; if (void 0 === e) { if (s % l) throw B(Et); if ((o = s - a) < 0) throw B(Et) } else if (s < (o = O(e) * l) + a) throw B(Et); u = o / l } else u = E(n), i = new X(o = u * l); for (_(t, "_d", { b: i, o: a, l: o, e: u, v: new Q(i) }); f < u;)p(t, f++) }), a = v[$] = j(Kt), _(a, "constructor", v)) : x(function () { v(1) }) && x(function () { new v(-1) }) && k(function (t) { new v, new v(null), new v(1.5), new v(t) }, !0) || (v = n(function (t, n, r, e) { var i; return w(t, v, h), P(n) ? n instanceof X || (i = M(n)) == K || i == H ? void 0 !== e ? new c(n, Ft(r, l), e) : void 0 !== r ? new c(n, Ft(r, l)) : new c(n) : _t in n ? Nt(v, n) : kt.call(v, n) : new c(E(n)) }), Z(e !== Function.prototype ? A(c).concat(A(e)) : A(c), function (t) { t in v || _(v, t, c[t]) }), v[$] = a, g || (a.constructor = v)); var s = a[bt], d = !!s && ("values" == s.name || null == s.name), y = Vt.values; _(v, mt, !0), _(a, _t, h), _(a, Ot, !0), _(a, St, v), (o ? new v(1)[xt] == h : xt in a) || U(a, xt, { get: function () { return h } }), f[h] = v, m(m.G + m.W + m.F * (v != c), f), m(m.S, h, { BYTES_PER_ELEMENT: l }), m(m.S + m.F * x(function () { c.of.call(v, 1) }), h, { from: kt, of: Rt }), J in a || _(a, J, l), m(m.P, h, Gt), R(h), m(m.P + m.F * jt, h, { set: Ut }), m(m.P + m.F * !d, h, Vt), g || a.toString == yt || (a.toString = yt), m(m.P + m.F * x(function () { new v(1).slice() }), h, { slice: Wt }), m(m.P + m.F * (x(function () { return [1, 2].toLocaleString() != new v([1, 2]).toLocaleString() }) || !x(function () { a.toLocaleString.call([1, 2]) })), h, { toLocaleString: Dt }), T[h] = d ? s : y, g || d || _(a, bt, y) } } else t.exports = function () { } }, function (t, n) { var r = {}.toString; t.exports = function (t) { return r.call(t).slice(8, -1) } }, function (t, n, r) { var e = r(18), i = r(6).document, o = e(i) && e(i.createElement); t.exports = function (t) { return o ? i.createElement(t) : {} } }, function (t, n, r) { t.exports = !r(12) && !r(20)(function () { return 7 != Object.defineProperty(r(59)("div"), "a", { get: function () { return 7 } }).a }) }, function (t, n, r) { "use strict"; var x = r(23), m = r(54), S = r(66), w = r(13), _ = r(36), O = r(98), E = r(38), M = r(104), P = r(16)("iterator"), j = !([].keys && "next" in [].keys()), F = "values", A = function () { return this }; t.exports = function (t, n, r, e, i, o, u) { O(r, n, e); var c, f, a, s = function (t) { if (!j && t in p) return p[t]; switch (t) { case "keys": case F: return function () { return new r(this, t) } }return function () { return new r(this, t) } }, l = n + " Iterator", h = i == F, v = !1, p = t.prototype, d = p[P] || p["@@iterator"] || i && p[i], y = d || s(i), g = i ? h ? s("entries") : y : void 0, b = "Array" == n && p.entries || d; if (b && ((a = M(b.call(new t))) !== Object.prototype && a.next && (E(a, l, !0), x || "function" == typeof a[P] || w(a, P, A))), h && d && d.name !== F && (v = !0, y = function () { return d.call(this) }), x && !u || !j && !v && p[P] || w(p, P, y), _[n] = y, _[l] = A, i) if (c = { values: h ? y : s(F), keys: o ? y : s("keys"), entries: g }, u) for (f in c) f in p || S(p, f, c[f]); else m(m.P + m.F * (j || v), n, c); return c } }, function (t, n, e) { var i = e(22), o = e(101), u = e(35), c = e(39)("IE_PROTO"), f = function () { }, a = "prototype", s = function () { var t, n = e(59)("iframe"), r = u.length; for (n.style.display = "none", e(95).appendChild(n), n.src = "javascript:", (t = n.contentWindow.document).open(), t.write("<script>document.F=Object<\/script>"), t.close(), s = t.F; r--;)delete s[a][u[r]]; return s() }; t.exports = Object.create || function (t, n) { var r; return null !== t ? (f[a] = i(t), r = new f, f[a] = null, r[c] = t) : r = s(), void 0 === n ? r : o(r, n) } }, function (t, n, r) { var e = r(65), i = r(35).concat("length", "prototype"); n.f = Object.getOwnPropertyNames || function (t) { return e(t, i) } }, function (t, n) { n.f = Object.getOwnPropertySymbols }, function (t, n, r) { var u = r(9), c = r(15), f = r(92)(!1), a = r(39)("IE_PROTO"); t.exports = function (t, n) { var r, e = c(t), i = 0, o = []; for (r in e) r != a && u(e, r) && o.push(r); for (; n.length > i;)u(e, r = n[i++]) && (~f(o, r) || o.push(r)); return o } }, function (t, n, r) { t.exports = r(13) }, function (t, n, r) { var e = r(7)("unscopables"), i = Array.prototype; null == i[e] && r(26)(i, e, {}), t.exports = function (t) { i[e][t] = !0 } }, function (t, n) { t.exports = !1 }, function (t, n, r) { var e = r(79)("meta"), i = r(5), o = r(30), u = r(11).f, c = 0, f = Object.isExtensible || function () { return !0 }, a = !r(4)(function () { return f(Object.preventExtensions({})) }), s = function (t) { u(t, e, { value: { i: "O" + ++c, w: {} } }) }, l = t.exports = { KEY: e, NEED: !1, fastKey: function (t, n) { if (!i(t)) return "symbol" == typeof t ? t : ("string" == typeof t ? "S" : "P") + t; if (!o(t, e)) { if (!f(t)) return "F"; if (!n) return "E"; s(t) } return t[e].i }, getWeak: function (t, n) { if (!o(t, e)) { if (!f(t)) return !0; if (!n) return !1; s(t) } return t[e].w }, onFreeze: function (t) { return a && l.NEED && f(t) && !o(t, e) && s(t), t } } }, function (t, n) { t.exports = function (t, n, r, e) { if (!(t instanceof n) || void 0 !== e && e in t) throw TypeError(r + ": incorrect invocation!"); return t } }, function (t, n, r) { var h = r(47), v = r(177), p = r(145), d = r(2), y = r(8), g = r(161), b = {}, x = {}; (n = t.exports = function (t, n, r, e, i) { var o, u, c, f, a = i ? function () { return t } : g(t), s = h(r, e, n ? 2 : 1), l = 0; if ("function" != typeof a) throw TypeError(t + " is not iterable!"); if (p(a)) { for (o = y(t.length); l < o; l++)if ((f = n ? s(d(u = t[l])[0], u[1]) : s(t[l])) === b || f === x) return f } else for (c = a.call(t); !(u = c.next()).done;)if ((f = v(c, s, u.value, n)) === b || f === x) return f }).BREAK = b, n.RETURN = x }, function (t, n, e) { var i = e(2), o = e(183), u = e(141), c = e(154)("IE_PROTO"), f = function () { }, a = "prototype", s = function () { var t, n = e(140)("iframe"), r = u.length; for (n.style.display = "none", e(143).appendChild(n), n.src = "javascript:", (t = n.contentWindow.document).open(), t.write("<script>document.F=Object<\/script>"), t.close(), s = t.F; r--;)delete s[a][u[r]]; return s() }; t.exports = Object.create || function (t, n) { var r; return null !== t ? (f[a] = i(t), r = new f, f[a] = null, r[c] = t) : r = s(), void 0 === n ? r : o(r, n) } }, function (t, n, r) { var e = r(185), i = r(141).concat("length", "prototype"); n.f = Object.getOwnPropertyNames || function (t) { return e(t, i) } }, function (t, n, r) { var e = r(185), i = r(141); t.exports = Object.keys || function (t) { return e(t, i) } }, function (t, n) { t.exports = function (t, n) { return { enumerable: !(1 & t), configurable: !(2 & t), writable: !(4 & t), value: n } } }, function (t, n, r) { var i = r(27); t.exports = function (t, n, r) { for (var e in n) i(t, e, n[e], r); return t } }, function (t, n, r) { "use strict"; var e = r(3), i = r(11), o = r(10), u = r(7)("species"); t.exports = function (t) { var n = e[t]; o && n && !n[u] && i.f(n, u, { configurable: !0, get: function () { return this } }) } }, function (t, n, r) { var e = r(49), i = Math.max, o = Math.min; t.exports = function (t, n) { return (t = e(t)) < 0 ? i(t + n, 0) : o(t, n) } }, function (t, n) { var r = 0, e = Math.random(); t.exports = function (t) { return "Symbol(".concat(void 0 === t ? "" : t, ")_", (++r + e).toString(36)) } }, function (t, n, r) { var e = r(5); t.exports = function (t, n) { if (!e(t) || t._t !== n) throw TypeError("Incompatible receiver, " + n + " required!"); return t } }, function (t, n, r) { var i = r(45), o = r(7)("toStringTag"), u = "Arguments" == i(function () { return arguments }()); t.exports = function (t) { var n, r, e; return void 0 === t ? "Undefined" : null === t ? "Null" : "string" == typeof (r = function (t, n) { try { return t[n] } catch (t) { } }(n = Object(t), o)) ? r : u ? i(n) : "Object" == (e = i(n)) && "function" == typeof n.callee ? "Arguments" : e } }, function (t, n) { t.exports = {} }, function (t, n, r) { var e = r(11).f, i = r(30), o = r(7)("toStringTag"); t.exports = function (t, n, r) { t && !i(t = r ? t : t.prototype, o) && e(t, o, { configurable: !0, value: n }) } }, function (t, n, r) { var u = r(1), e = r(51), c = r(4), f = r(157), i = "[" + f + "]", o = RegExp("^" + i + i + "*"), a = RegExp(i + i + "*$"), s = function (t, n, r) { var e = {}, i = c(function () { return !!f[t]() || "​" != "​"[t]() }), o = e[t] = i ? n(l) : f[t]; r && (e[r] = o), u(u.P + u.F * i, "String", e) }, l = s.trim = function (t, n) { return t = String(e(t)), 1 & n && (t = t.replace(o, "")), 2 & n && (t = t.replace(a, "")), t }; t.exports = s }, function (t, n, r) { t.exports = { default: r(88), __esModule: !0 } }, function (t, n, r) { t.exports = { default: r(89), __esModule: !0 } }, function (t, n, r) { "use strict"; function e(t) { return t && t.__esModule ? t : { default: t } } n.__esModule = !0; var i = e(r(86)), o = e(r(85)), u = "function" == typeof o.default && "symbol" == typeof i.default ? function (t) { return typeof t } : function (t) { return t && "function" == typeof o.default && t.constructor === o.default && t !== o.default.prototype ? "symbol" : typeof t }; n.default = "function" == typeof o.default && "symbol" === u(i.default) ? function (t) { return void 0 === t ? "undefined" : u(t) } : function (t) { return t && "function" == typeof o.default && t.constructor === o.default && t !== o.default.prototype ? "symbol" : void 0 === t ? "undefined" : u(t) } }, function (t, n, r) { r(111), r(109), r(112), r(113), t.exports = r(19).Symbol }, function (t, n, r) { r(110), r(114), t.exports = r(44).f("iterator") }, function (t, n) { t.exports = function (t) { if ("function" != typeof t) throw TypeError(t + " is not a function!"); return t } }, function (t, n) { t.exports = function () { } }, function (t, n, r) { var f = r(15), a = r(107), s = r(106); t.exports = function (c) { return function (t, n, r) { var e, i = f(t), o = a(i.length), u = s(r, o); if (c && n != n) { for (; u < o;)if ((e = i[u++]) != e) return !0 } else for (; u < o; u++)if ((c || u in i) && i[u] === n) return c || u || 0; return !c && -1 } } }, function (t, n, r) { var o = r(90); t.exports = function (e, i, t) { if (o(e), void 0 === i) return e; switch (t) { case 1: return function (t) { return e.call(i, t) }; case 2: return function (t, n) { return e.call(i, t, n) }; case 3: return function (t, n, r) { return e.call(i, t, n, r) } }return function () { return e.apply(i, arguments) } } }, function (t, n, r) { var c = r(29), f = r(64), a = r(37); t.exports = function (t) { var n = c(t), r = f.f; if (r) for (var e, i = r(t), o = a.f, u = 0; i.length > u;)o.call(t, e = i[u++]) && n.push(e); return n } }, function (t, n, r) { var e = r(6).document; t.exports = e && e.documentElement }, function (t, n, r) { var e = r(58); t.exports = Object("z").propertyIsEnumerable(0) ? Object : function (t) { return "String" == e(t) ? t.split("") : Object(t) } }, function (t, n, r) { var e = r(58); t.exports = Array.isArray || function (t) { return "Array" == e(t) } }, function (t, n, r) { "use strict"; var e = r(62), i = r(24), o = r(38), u = {}; r(13)(u, r(16)("iterator"), function () { return this }), t.exports = function (t, n, r) { t.prototype = e(u, { next: i(1, r) }), o(t, n + " Iterator") } }, function (t, n) { t.exports = function (t, n) { return { value: n, done: !!t } } }, function (t, n, r) { var e = r(25)("meta"), i = r(18), o = r(9), u = r(14).f, c = 0, f = Object.isExtensible || function () { return !0 }, a = !r(20)(function () { return f(Object.preventExtensions({})) }), s = function (t) { u(t, e, { value: { i: "O" + ++c, w: {} } }) }, l = t.exports = { KEY: e, NEED: !1, fastKey: function (t, n) { if (!i(t)) return "symbol" == typeof t ? t : ("string" == typeof t ? "S" : "P") + t; if (!o(t, e)) { if (!f(t)) return "F"; if (!n) return "E"; s(t) } return t[e].i }, getWeak: function (t, n) { if (!o(t, e)) { if (!f(t)) return !0; if (!n) return !1; s(t) } return t[e].w }, onFreeze: function (t) { return a && l.NEED && f(t) && !o(t, e) && s(t), t } } }, function (t, n, r) { var u = r(14), c = r(22), f = r(29); t.exports = r(12) ? Object.defineProperties : function (t, n) { c(t); for (var r, e = f(n), i = e.length, o = 0; o < i;)u.f(t, r = e[o++], n[r]); return t } }, function (t, n, r) { var e = r(37), i = r(24), o = r(15), u = r(42), c = r(9), f = r(60), a = Object.getOwnPropertyDescriptor; n.f = r(12) ? a : function (t, n) { if (t = o(t), n = u(n, !0), f) try { return a(t, n) } catch (t) { } if (c(t, n)) return i(!e.f.call(t, n), t[n]) } }, function (t, n, r) { var e = r(15), i = r(63).f, o = {}.toString, u = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : []; t.exports.f = function (t) { return u && "[object Window]" == o.call(t) ? function (t) { try { return i(t) } catch (t) { return u.slice() } }(t) : i(e(t)) } }, function (t, n, r) { var e = r(9), i = r(55), o = r(39)("IE_PROTO"), u = Object.prototype; t.exports = Object.getPrototypeOf || function (t) { return t = i(t), e(t, o) ? t[o] : "function" == typeof t.constructor && t instanceof t.constructor ? t.constructor.prototype : t instanceof Object ? u : null } }, function (t, n, r) { var f = r(41), a = r(34); t.exports = function (c) { return function (t, n) { var r, e, i = String(a(t)), o = f(n), u = i.length; return o < 0 || u <= o ? c ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || 56319 < r || o + 1 === u || (e = i.charCodeAt(o + 1)) < 56320 || 57343 < e ? c ? i.charAt(o) : r : c ? i.slice(o, o + 2) : e - 56320 + (r - 55296 << 10) + 65536 } } }, function (t, n, r) { var e = r(41), i = Math.max, o = Math.min; t.exports = function (t, n) { return (t = e(t)) < 0 ? i(t + n, 0) : o(t, n) } }, function (t, n, r) { var e = r(41), i = Math.min; t.exports = function (t) { return 0 < t ? i(e(t), 9007199254740991) : 0 } }, function (t, n, r) { "use strict"; var e = r(91), i = r(99), o = r(36), u = r(15); t.exports = r(61)(Array, "Array", function (t, n) { this._t = u(t), this._i = 0, this._k = n }, function () { var t = this._t, n = this._k, r = this._i++; return !t || r >= t.length ? (this._t = void 0, i(1)) : i(0, "keys" == n ? r : "values" == n ? t[r] : [r, t[r]]) }, "values"), o.Arguments = o.Array, e("keys"), e("values"), e("entries") }, function (t, n) { }, function (t, n, r) { "use strict"; var e = r(105)(!0); r(61)(String, "String", function (t) { this._t = String(t), this._i = 0 }, function () { var t, n = this._t, r = this._i; return r >= n.length ? { value: void 0, done: !0 } : (t = e(n, r), this._i += t.length, { value: t, done: !1 }) }) }, function (t, n, r) { "use strict"; var e = r(6), u = r(9), i = r(12), o = r(54), c = r(66), f = r(100).KEY, a = r(20), s = r(40), l = r(38), h = r(25), v = r(16), p = r(44), d = r(43), y = r(94), g = r(97), b = r(22), x = r(18), m = r(55), S = r(15), w = r(42), _ = r(24), O = r(62), E = r(103), M = r(102), P = r(64), j = r(14), F = r(29), A = M.f, I = j.f, L = E.f, N = e.Symbol, T = e.JSON, k = T && T.stringify, R = "prototype", C = v("_hidden"), D = v("toPrimitive"), G = {}.propertyIsEnumerable, W = s("symbol-registry"), U = s("symbols"), V = s("op-symbols"), B = Object[R], q = "function" == typeof N && !!P.f, z = e.QObject, K = !z || !z[R] || !z[R].findChild, H = i && a(function () { return 7 != O(I({}, "a", { get: function () { return I(this, "a", { value: 7 }).a } })).a }) ? function (t, n, r) { var e = A(B, n); e && delete B[n], I(t, n, r), e && t !== B && I(B, n, e) } : I, J = function (t) { var n = U[t] = O(N[R]); return n._k = t, n }, $ = q && "symbol" == typeof N.iterator ? function (t) { return "symbol" == typeof t } : function (t) { return t instanceof N }, Y = function (t, n, r) { return t === B && Y(V, n, r), b(t), n = w(n, !0), b(r), u(U, n) ? (r.enumerable ? (u(t, C) && t[C][n] && (t[C][n] = !1), r = O(r, { enumerable: _(0, !1) })) : (u(t, C) || I(t, C, _(1, {})), t[C][n] = !0), H(t, n, r)) : I(t, n, r) }, X = function (t, n) { b(t); for (var r, e = y(n = S(n)), i = 0, o = e.length; i < o;)Y(t, r = e[i++], n[r]); return t }, Q = function (t) { var n = G.call(this, t = w(t, !0)); return !(this === B && u(U, t) && !u(V, t)) && (!(n || !u(this, t) || !u(U, t) || u(this, C) && this[C][t]) || n) }, Z = function (t, n) { if (t = S(t), n = w(n, !0), t !== B || !u(U, n) || u(V, n)) { var r = A(t, n); return !r || !u(U, n) || u(t, C) && t[C][n] || (r.enumerable = !0), r } }, tt = function (t) { for (var n, r = L(S(t)), e = [], i = 0; r.length > i;)u(U, n = r[i++]) || n == C || n == f || e.push(n); return e }, nt = function (t) { for (var n, r = t === B, e = L(r ? V : S(t)), i = [], o = 0; e.length > o;)!u(U, n = e[o++]) || r && !u(B, n) || i.push(U[n]); return i }; q || (c((N = function () { if (this instanceof N) throw TypeError("Symbol is not a constructor!"); var n = h(0 < arguments.length ? arguments[0] : void 0), r = function (t) { this === B && r.call(V, t), u(this, C) && u(this[C], n) && (this[C][n] = !1), H(this, n, _(1, t)) }; return i && K && H(B, n, { configurable: !0, set: r }), J(n) })[R], "toString", function () { return this._k }), M.f = Z, j.f = Y, r(63).f = E.f = tt, r(37).f = Q, P.f = nt, i && !r(23) && c(B, "propertyIsEnumerable", Q, !0), p.f = function (t) { return J(v(t)) }), o(o.G + o.W + o.F * !q, { Symbol: N }); for (var rt = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), et = 0; rt.length > et;)v(rt[et++]); for (var it = F(v.store), ot = 0; it.length > ot;)d(it[ot++]); o(o.S + o.F * !q, "Symbol", { for: function (t) { return u(W, t += "") ? W[t] : W[t] = N(t) }, keyFor: function (t) { if (!$(t)) throw TypeError(t + " is not a symbol!"); for (var n in W) if (W[n] === t) return n }, useSetter: function () { K = !0 }, useSimple: function () { K = !1 } }), o(o.S + o.F * !q, "Object", { create: function (t, n) { return void 0 === n ? O(t) : X(O(t), n) }, defineProperty: Y, defineProperties: X, getOwnPropertyDescriptor: Z, getOwnPropertyNames: tt, getOwnPropertySymbols: nt }); var ut = a(function () { P.f(1) }); o(o.S + o.F * ut, "Object", { getOwnPropertySymbols: function (t) { return P.f(m(t)) } }), T && o(o.S + o.F * (!q || a(function () { var t = N(); return "[null]" != k([t]) || "{}" != k({ a: t }) || "{}" != k(Object(t)) })), "JSON", { stringify: function (t) { for (var n, r, e = [t], i = 1; arguments.length > i;)e.push(arguments[i++]); if (r = n = e[1], (x(n) || void 0 !== t) && !$(t)) return g(n) || (n = function (t, n) { if ("function" == typeof r && (n = r.call(this, t, n)), !$(n)) return n }), e[1] = n, k.apply(T, e) } }), N[R][D] || r(13)(N[R], D, N[R].valueOf), l(N, "Symbol"), l(Math, "Math", !0), l(e.JSON, "JSON", !0) }, function (t, n, r) { r(43)("asyncIterator") }, function (t, n, r) { r(43)("observable") }, function (t, n, r) { r(108); for (var e = r(6), i = r(13), o = r(36), u = r(16)("toStringTag"), c = "CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","), f = 0; f < c.length; f++) { var a = c[f], s = e[a], l = s && s.prototype; l && !l[u] && i(l, u, a), o[a] = o.Array } }, function (t, n, r) { "use strict"; var e = r(2); t.exports = function () { var t = e(this), n = ""; return t.global && (n += "g"), t.ignoreCase && (n += "i"), t.multiline && (n += "m"), t.unicode && (n += "u"), t.sticky && (n += "y"), n } }, function (t, n, r) { var e = r(45); t.exports = Object("z").propertyIsEnumerable(0) ? Object : function (t) { return "String" == e(t) ? t.split("") : Object(t) } }, function (t, n) { n.f = {}.propertyIsEnumerable }, function (t, n, r) { var e = r(46), i = r(3), o = "__core-js_shared__", u = i[o] || (i[o] = {}); (t.exports = function (t, n) { return u[t] || (u[t] = void 0 !== n ? n : {}) })("versions", []).push({ version: e.version, mode: r(68) ? "pure" : "global", copyright: "© 2019 Denis Pushkarev (zloirock.ru)" }) }, function (t, n, r) { var i = r(2), o = r(21), u = r(7)("species"); t.exports = function (t, n) { var r, e = i(t).constructor; return void 0 === e || null == (r = i(e)[u]) ? n : o(r) } }, function (t, n, r) { var f = r(33), a = r(8), s = r(78); t.exports = function (c) { return function (t, n, r) { var e, i = f(t), o = a(i.length), u = s(r, o); if (c && n != n) { for (; u < o;)if ((e = i[u++]) != e) return !0 } else for (; u < o; u++)if ((c || u in i) && i[u] === n) return c || u || 0; return !c && -1 } } }, function (t, n, r) { "use strict"; var g = r(3), b = r(1), x = r(27), m = r(76), S = r(69), w = r(71), _ = r(70), O = r(5), E = r(4), M = r(125), P = r(83), j = r(144); t.exports = function (e, t, n, r, i, o) { var u = g[e], c = u, f = i ? "set" : "add", a = c && c.prototype, s = {}, l = function (t) { var r = a[t]; x(a, t, "delete" == t ? function (t) { return !(o && !O(t)) && r.call(this, 0 === t ? 0 : t) } : "has" == t ? function (t) { return !(o && !O(t)) && r.call(this, 0 === t ? 0 : t) } : "get" == t ? function (t) { return o && !O(t) ? void 0 : r.call(this, 0 === t ? 0 : t) } : "add" == t ? function (t) { return r.call(this, 0 === t ? 0 : t), this } : function (t, n) { return r.call(this, 0 === t ? 0 : t, n), this }) }; if ("function" == typeof c && (o || a.forEach && !E(function () { (new c).entries().next() }))) { var h = new c, v = h[f](o ? {} : -0, 1) != h, p = E(function () { h.has(1) }), d = M(function (t) { new c(t) }), y = !o && E(function () { for (var t = new c, n = 5; n--;)t[f](n, n); return !t.has(-0) }); d || (((c = t(function (t, n) { _(t, c, e); var r = j(new u, t, c); return null != n && w(n, i, r[f], r), r })).prototype = a).constructor = c), (p || y) && (l("delete"), l("has"), i && l("get")), (y || v) && l(f), o && a.clear && delete a.clear } else c = r.getConstructor(t, e, i, f), m(c.prototype, n), S.NEED = !0; return P(c, e), s[e] = c, b(b.G + b.W + b.F * (c != u), s), o || r.setStrong(c, e, i), c } }, function (t, n, r) { "use strict"; r(197); var s = r(27), l = r(26), h = r(4), v = r(51), p = r(7), d = r(152), y = p("species"), g = !h(function () { var t = /./; return t.exec = function () { var t = []; return t.groups = { a: "7" }, t }, "7" !== "".replace(t, "$<a>") }), b = function () { var t = /(?:)/, n = t.exec; t.exec = function () { return n.apply(this, arguments) }; var r = "ab".split(t); return 2 === r.length && "a" === r[0] && "b" === r[1] }(); t.exports = function (r, t, n) { var e = p(r), o = !h(function () { var t = {}; return t[e] = function () { return 7 }, 7 != ""[r](t) }), i = o ? !h(function () { var t = !1, n = /a/; return n.exec = function () { return t = !0, null }, "split" === r && (n.constructor = {}, n.constructor[y] = function () { return n }), n[e](""), !t }) : void 0; if (!o || !i || "replace" === r && !g || "split" === r && !b) { var u = /./[e], c = n(v, e, ""[r], function (t, n, r, e, i) { return n.exec === d ? o && !i ? { done: !0, value: u.call(n, r, e) } : { done: !0, value: t.call(r, n, e) } : { done: !1 } }), f = c[0], a = c[1]; s(String.prototype, r, f), l(RegExp.prototype, e, 2 == t ? function (t, n) { return a.call(t, this, n) } : function (t) { return a.call(t, this) }) } } }, function (t, n, r) { var e = r(45); t.exports = Array.isArray || function (t) { return "Array" == e(t) } }, function (t, n, r) { var e = r(5), i = r(45), o = r(7)("match"); t.exports = function (t) { var n; return e(t) && (void 0 !== (n = t[o]) ? !!n : "RegExp" == i(t)) } }, function (t, n, r) { var o = r(7)("iterator"), u = !1; try { var e = [7][o](); e.return = function () { u = !0 }, Array.from(e, function () { throw 2 }) } catch (t) { } t.exports = function (t, n) { if (!n && !u) return !1; var r = !1; try { var e = [7], i = e[o](); i.next = function () { return { done: r = !0 } }, e[o] = function () { return i }, t(e) } catch (t) { } return r } }, function (t, n, r) { "use strict"; t.exports = r(68) || !r(4)(function () { var t = Math.random(); __defineSetter__.call(null, t, function () { }), delete r(3)[t] }) }, function (t, n) { n.f = Object.getOwnPropertySymbols }, function (t, n, r) { "use strict"; var i = r(81), o = RegExp.prototype.exec; t.exports = function (t, n) { var r = t.exec; if ("function" == typeof r) { var e = r.call(t, n); if ("object" != typeof e) throw new TypeError("RegExp exec method returned something other than an Object or null"); return e } if ("RegExp" !== i(t)) throw new TypeError("RegExp#exec called on incompatible receiver"); return o.call(t, n) } }, function (t, n, r) { "use strict"; var e = r(1), u = r(21), c = r(47), f = r(71); t.exports = function (t) { e(e.S, t, { from: function (t) { var n, r, e, i, o = arguments[1]; return u(this), (n = void 0 !== o) && u(o), null == t ? new this : (r = [], n ? (e = 0, i = c(o, arguments[2], 2), f(t, !1, function (t) { r.push(i(t, e++)) })) : f(t, !1, r.push, r), new this(r)) } }) } }, function (t, n, r) { "use strict"; var e = r(1); t.exports = function (t) { e(e.S, t, { of: function () { for (var t = arguments.length, n = new Array(t); t--;)n[t] = arguments[t]; return new this(n) } }) } }, function (t, n, r) { var f = r(49), a = r(51); t.exports = function (c) { return function (t, n) { var r, e, i = String(a(t)), o = f(n), u = i.length; return o < 0 || u <= o ? c ? "" : void 0 : (r = i.charCodeAt(o)) < 55296 || 56319 < r || o + 1 === u || (e = i.charCodeAt(o + 1)) < 56320 || 57343 < e ? c ? i.charAt(o) : r : c ? i.slice(o, o + 2) : e - 56320 + (r - 55296 << 10) + 65536 } } }, function (t, n, r) { for (var e, i = r(3), o = r(26), u = r(79), c = u("typed_array"), f = u("view"), a = !(!i.ArrayBuffer || !i.DataView), s = a, l = 0, h = "Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(","); l < 9;)(e = i[h[l++]]) ? (o(e.prototype, c, !0), o(e.prototype, f, !0)) : s = !1; t.exports = { ABV: a, CONSTR: s, TYPED: c, VIEW: f } }, function (t, n, r) { var e = r(3).navigator; t.exports = e && e.userAgent || "" }, function (t, n) { "use strict"; var r, e = { versions: (r = window.navigator.userAgent, { trident: -1 < r.indexOf("Trident"), presto: -1 < r.indexOf("Presto"), webKit: -1 < r.indexOf("AppleWebKit"), gecko: -1 < r.indexOf("Gecko") && -1 == r.indexOf("KHTML"), mobile: !!r.match(/AppleWebKit.*Mobile.*/), ios: !!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), android: -1 < r.indexOf("Android") || -1 < r.indexOf("Linux"), iPhone: -1 < r.indexOf("iPhone") || -1 < r.indexOf("Mac"), iPad: -1 < r.indexOf("iPad"), webApp: -1 == r.indexOf("Safari"), weixin: -1 == r.indexOf("MicroMessenger") }) }; t.exports = e }, function (t, n, r) { "use strict"; var e, i = r(87), l = (e = i) && e.__esModule ? e : { default: e }, h = function () { function n(t, n, r) { return n || r ? String.fromCharCode(n || r) : o[t] || t } function r(t) { return s[t] } var e = /&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g, i = /['<> "&]/g, o = { "&quot;": '"', "&lt;": "<", "&gt;": ">", "&amp;": "&", "&nbsp;": " " }, u = /\u00a0/g, c = /<br\s*\/?>/gi, f = /\r?\n/g, a = /\s/g, s = {}; for (var t in o) s[o[t]] = t; return o["&apos;"] = "'", s["'"] = "&#39;", { encode: function (t) { return t ? ("" + t).replace(i, r).replace(f, "<br/>").replace(a, "&nbsp;") : "" }, decode: function (t) { return t ? ("" + t).replace(c, "\n").replace(e, n).replace(u, " ") : "" }, encodeBase16: function (t) { if (!t) return t; for (var n = [], r = 0, e = (t += "").length; r < e; r++)n.push(t.charCodeAt(r).toString(16).toUpperCase()); return n.join("") }, encodeBase16forJSON: function (t) { if (!t) return t; for (var n = [], r = 0, e = (t = t.replace(/[\u4E00-\u9FBF]/gi, function (t) { return escape(t).replace("%u", "\\u") })).length; r < e; r++)n.push(t.charCodeAt(r).toString(16).toUpperCase()); return n.join("") }, decodeBase16: function (t) { if (!t) return t; for (var n = [], r = 0, e = (t += "").length; r < e; r += 2)n.push(String.fromCharCode("0x" + t.slice(r, r + 2))); return n.join("") }, encodeObject: function (t) { if (t instanceof Array) for (var n = 0, r = t.length; n < r; n++)t[n] = h.encodeObject(t[n]); else if ("object" == (void 0 === t ? "undefined" : (0, l.default)(t))) for (var e in t) t[e] = h.encodeObject(t[e]); else if ("string" == typeof t) return h.encode(t); return t }, loadScript: function (t) { var n = document.createElement("script"); document.getElementsByTagName("body")[0].appendChild(n), n.setAttribute("src", t) }, addLoadEvent: function (t) { var n = window.onload; "function" != typeof window.onload ? window.onload = t : window.onload = function () { n(), t() } } } }(); t.exports = h }, function (t, n, r) { "use strict"; var e = r(131)(!0); t.exports = function (t, n, r) { return n + (r ? e(t, n).length : 1) } }, function (t, n, r) { "use strict"; var c = r(17), f = r(78), a = r(8); t.exports = function (t) { for (var n = c(this), r = a(n.length), e = arguments.length, i = f(1 < e ? arguments[1] : void 0, r), o = 2 < e ? arguments[2] : void 0, u = void 0 === o ? r : f(o, r); i < u;)n[i++] = t; return n } }, function (t, n, r) { var e = r(215); t.exports = function (t, n) { return new (e(t))(n) } }, function (t, n, r) { "use strict"; var e = r(11), i = r(75); t.exports = function (t, n, r) { n in t ? e.f(t, n, i(0, r)) : t[n] = r } }, function (t, n, r) { var e = r(5), i = r(3).document, o = e(i) && e(i.createElement); t.exports = function (t) { return o ? i.createElement(t) : {} } }, function (t, n) { t.exports = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",") }, function (t, n, r) { var e = r(7)("match"); t.exports = function (n) { var r = /./; try { "/./"[n](r) } catch (t) { try { return r[e] = !1, !"/./"[n](r) } catch (n) { } } return !0 } }, function (t, n, r) { var e = r(3).document; t.exports = e && e.documentElement }, function (t, n, r) { var o = r(5), u = r(153).set; t.exports = function (t, n, r) { var e, i = n.constructor; return i !== r && "function" == typeof i && (e = i.prototype) !== r.prototype && o(e) && u && u(t, e), t } }, function (t, n, r) { var e = r(82), i = r(7)("iterator"), o = Array.prototype; t.exports = function (t) { return void 0 !== t && (e.Array === t || o[i] === t) } }, function (t, n, r) { "use strict"; var e = r(72), i = r(75), o = r(83), u = {}; r(26)(u, r(7)("iterator"), function () { return this }), t.exports = function (t, n, r) { t.prototype = e(u, { next: i(1, r) }), o(t, n + " Iterator") } }, function (t, n, r) { "use strict"; var x = r(68), m = r(1), S = r(27), w = r(26), _ = r(82), O = r(146), E = r(83), M = r(32), P = r(7)("iterator"), j = !([].keys && "next" in [].keys()), F = "values", A = function () { return this }; t.exports = function (t, n, r, e, i, o, u) { O(r, n, e); var c, f, a, s = function (t) { if (!j && t in p) return p[t]; switch (t) { case "keys": case F: return function () { return new r(this, t) } }return function () { return new r(this, t) } }, l = n + " Iterator", h = i == F, v = !1, p = t.prototype, d = p[P] || p["@@iterator"] || i && p[i], y = d || s(i), g = i ? h ? s("entries") : y : void 0, b = "Array" == n && p.entries || d; if (b && ((a = M(b.call(new t))) !== Object.prototype && a.next && (E(a, l, !0), x || "function" == typeof a[P] || w(a, P, A))), h && d && d.name !== F && (v = !0, y = function () { return d.call(this) }), x && !u || !j && !v && p[P] || w(p, P, y), _[n] = y, _[l] = A, i) if (c = { values: h ? y : s(F), keys: o ? y : s("keys"), entries: g }, u) for (f in c) f in p || S(p, f, c[f]); else m(m.P + m.F * (j || v), n, c); return c } }, function (t, n) { var r = Math.expm1; t.exports = !r || 22025.465794806718 < r(10) || r(10) < 22025.465794806718 || -2e-17 != r(-2e-17) ? function (t) { return 0 == (t = +t) ? t : -1e-6 < t && t < 1e-6 ? t + t * t / 2 : Math.exp(t) - 1 } : r }, function (t, n) { t.exports = Math.sign || function (t) { return 0 == (t = +t) || t != t ? t : t < 0 ? -1 : 1 } }, function (t, n, r) { var c = r(3), f = r(158).set, a = c.MutationObserver || c.WebKitMutationObserver, s = c.process, l = c.Promise, h = "process" == r(45)(s); t.exports = function () { var r, e, i, t = function () { var t, n; for (h && (t = s.domain) && t.exit(); r;) { n = r.fn, r = r.next; try { n() } catch (t) { throw r ? i() : e = void 0, t } } e = void 0, t && t.enter() }; if (h) i = function () { s.nextTick(t) }; else if (!a || c.navigator && c.navigator.standalone) if (l && l.resolve) { var n = l.resolve(void 0); i = function () { n.then(t) } } else i = function () { f.call(c, t) }; else { var o = !0, u = document.createTextNode(""); new a(t).observe(u, { characterData: !0 }), i = function () { u.data = o = !o } } return function (t) { var n = { fn: t, next: void 0 }; e && (e.next = n), r || (r = n, i()), e = n } } }, function (t, n, r) { "use strict"; function e(t) { var r, e; this.promise = new t(function (t, n) { if (void 0 !== r || void 0 !== e) throw TypeError("Bad Promise constructor"); r = t, e = n }), this.resolve = i(r), this.reject = i(e) } var i = r(21); t.exports.f = function (t) { return new e(t) } }, function (t, n, r) { "use strict"; var e, i, u = r(115), c = RegExp.prototype.exec, f = String.prototype.replace, o = c, a = "lastIndex", s = (e = /a/, i = /b*/g, c.call(e, "a"), c.call(i, "a"), 0 !== e[a] || 0 !== i[a]), l = void 0 !== /()??/.exec("")[1]; (s || l) && (o = function (t) { var n, r, e, i, o = this; return l && (r = new RegExp("^" + o.source + "$(?!\\s)", u.call(o))), s && (n = o[a]), e = c.call(o, t), s && e && (o[a] = o.global ? e.index + e[0].length : n), l && e && 1 < e.length && f.call(e[0], r, function () { for (i = 1; i < arguments.length - 2; i++)void 0 === arguments[i] && (e[i] = void 0) }), e }), t.exports = o }, function (t, n, i) { var r = i(5), e = i(2), o = function (t, n) { if (e(t), !r(n) && null !== n) throw TypeError(n + ": can't set as prototype!") }; t.exports = { set: Object.setPrototypeOf || ("__proto__" in {} ? function (t, r, e) { try { (e = i(47)(Function.call, i(31).f(Object.prototype, "__proto__").set, 2))(t, []), r = !(t instanceof Array) } catch (t) { r = !0 } return function (t, n) { return o(t, n), r ? t.__proto__ = n : e(t, n), t } }({}, !1) : void 0), check: o } }, function (t, n, r) { var e = r(118)("keys"), i = r(79); t.exports = function (t) { return e[t] || (e[t] = i(t)) } }, function (t, n, r) { var e = r(124), i = r(51); t.exports = function (t, n, r) { if (e(n)) throw TypeError("String#" + r + " doesn't accept regex!"); return String(i(t)) } }, function (t, n, r) { "use strict"; var i = r(49), o = r(51); t.exports = function (t) { var n = String(o(this)), r = "", e = i(t); if (e < 0 || e == 1 / 0) throw RangeError("Count can't be negative"); for (; 0 < e; (e >>>= 1) && (n += n))1 & e && (r += n); return r } }, function (t, n) { t.exports = "\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff" }, function (t, n, r) { var e, i, o, u = r(47), c = r(175), f = r(143), a = r(140), s = r(3), l = s.process, h = s.setImmediate, v = s.clearImmediate, p = s.MessageChannel, d = s.Dispatch, y = 0, g = {}, b = "onreadystatechange", x = function () { var t = +this; if (g.hasOwnProperty(t)) { var n = g[t]; delete g[t], n() } }, m = function (t) { x.call(t.data) }; h && v || (h = function (t) { for (var n = [], r = 1; arguments.length > r;)n.push(arguments[r++]); return g[++y] = function () { c("function" == typeof t ? t : Function(t), n) }, e(y), y }, v = function (t) { delete g[t] }, "process" == r(45)(l) ? e = function (t) { l.nextTick(u(x, t, 1)) } : d && d.now ? e = function (t) { d.now(u(x, t, 1)) } : p ? (o = (i = new p).port2, i.port1.onmessage = m, e = u(o.postMessage, o, 1)) : s.addEventListener && "function" == typeof postMessage && !s.importScripts ? (e = function (t) { s.postMessage(t + "", "*") }, s.addEventListener("message", m, !1)) : e = b in a("script") ? function (t) { f.appendChild(a("script"))[b] = function () { f.removeChild(this), x.call(t) } } : function (t) { setTimeout(u(x, t, 1), 0) }), t.exports = { set: h, clear: v } }, function (t, n, r) { "use strict"; function e(t, n, r) { var e, i, o, u = new Array(r), c = 8 * r - n - 1, f = (1 << c) - 1, a = f >> 1, s = 23 === n ? W(2, -24) - W(2, -77) : 0, l = 0, h = t < 0 || 0 === t && 1 / t < 0 ? 1 : 0; for ((t = G(t)) != t || t === C ? (i = t != t ? 1 : 0, e = f) : (e = U(V(t) / B), t * (o = W(2, -e)) < 1 && (e--, o *= 2), 2 <= (t += 1 <= e + a ? s / o : s * W(2, 1 - a)) * o && (e++, o /= 2), f <= e + a ? (i = 0, e = f) : 1 <= e + a ? (i = (t * o - 1) * W(2, n), e += a) : (i = t * W(2, a - 1) * W(2, n), e = 0)); 8 <= n; u[l++] = 255 & i, i /= 256, n -= 8); for (e = e << n | i, c += n; 0 < c; u[l++] = 255 & e, e /= 256, c -= 8); return u[--l] |= 128 * h, u } function i(t, n, r) { var e, i = 8 * r - n - 1, o = (1 << i) - 1, u = o >> 1, c = i - 7, f = r - 1, a = t[f--], s = 127 & a; for (a >>= 7; 0 < c; s = 256 * s + t[f], f--, c -= 8); for (e = s & (1 << -c) - 1, s >>= -c, c += n; 0 < c; e = 256 * e + t[f], f--, c -= 8); if (0 === s) s = 1 - u; else { if (s === o) return e ? NaN : a ? -C : C; e += W(2, n), s -= u } return (a ? -1 : 1) * e * W(2, s - n) } function o(t) { return t[3] << 24 | t[2] << 16 | t[1] << 8 | t[0] } function u(t) { return [255 & t] } function c(t) { return [255 & t, t >> 8 & 255] } function f(t) { return [255 & t, t >> 8 & 255, t >> 16 & 255, t >> 24 & 255] } function a(t) { return e(t, 52, 8) } function s(t) { return e(t, 23, 4) } function l(t, n, r) { M(t[I], n, { get: function () { return this[r] } }) } function h(t, n, r, e) { var i = O(+r); if (i + n > t[H]) throw R(L); var o = t[K]._b, u = i + t[J], c = o.slice(u, u + n); return e ? c : c.reverse() } function v(t, n, r, e, i, o) { var u = O(+r); if (u + n > t[H]) throw R(L); for (var c = t[K]._b, f = u + t[J], a = e(+i), s = 0; s < n; s++)c[f + s] = a[o ? s : n - s - 1] } var p = r(3), d = r(10), y = r(68), g = r(132), b = r(26), x = r(76), m = r(4), S = r(70), w = r(49), _ = r(8), O = r(194), E = r(73).f, M = r(11).f, P = r(137), j = r(83), F = "ArrayBuffer", A = "DataView", I = "prototype", L = "Wrong index!", N = p[F], T = p[A], k = p.Math, R = p.RangeError, C = p.Infinity, D = N, G = k.abs, W = k.pow, U = k.floor, V = k.log, B = k.LN2, q = "byteLength", z = "byteOffset", K = d ? "_b" : "buffer", H = d ? "_l" : q, J = d ? "_o" : z; if (g.ABV) { if (!m(function () { N(1) }) || !m(function () { new N(-1) }) || m(function () { return new N, new N(1.5), new N(NaN), N.name != F })) { for (var $, Y = (N = function (t) { return S(this, N), new D(O(t)) })[I] = D[I], X = E(D), Q = 0; X.length > Q;)($ = X[Q++]) in N || b(N, $, D[$]); y || (Y.constructor = N) } var Z = new T(new N(2)), tt = T[I].setInt8; Z.setInt8(0, 2147483648), Z.setInt8(1, 2147483649), !Z.getInt8(0) && Z.getInt8(1) || x(T[I], { setInt8: function (t, n) { tt.call(this, t, n << 24 >> 24) }, setUint8: function (t, n) { tt.call(this, t, n << 24 >> 24) } }, !0) } else N = function (t) { S(this, N, F); var n = O(t); this._b = P.call(new Array(n), 0), this[H] = n }, T = function (t, n, r) { S(this, T, A), S(t, N, A); var e = t[H], i = w(n); if (i < 0 || e < i) throw R("Wrong offset!"); if (e < i + (r = void 0 === r ? e - i : _(r))) throw R("Wrong length!"); this[K] = t, this[J] = i, this[H] = r }, d && (l(N, q, "_l"), l(T, "buffer", "_b"), l(T, q, "_l"), l(T, z, "_o")), x(T[I], { getInt8: function (t) { return h(this, 1, t)[0] << 24 >> 24 }, getUint8: function (t) { return h(this, 1, t)[0] }, getInt16: function (t) { var n = h(this, 2, t, arguments[1]); return (n[1] << 8 | n[0]) << 16 >> 16 }, getUint16: function (t) { var n = h(this, 2, t, arguments[1]); return n[1] << 8 | n[0] }, getInt32: function (t) { return o(h(this, 4, t, arguments[1])) }, getUint32: function (t) { return o(h(this, 4, t, arguments[1])) >>> 0 }, getFloat32: function (t) { return i(h(this, 4, t, arguments[1]), 23, 4) }, getFloat64: function (t) { return i(h(this, 8, t, arguments[1]), 52, 8) }, setInt8: function (t, n) { v(this, 1, t, u, n) }, setUint8: function (t, n) { v(this, 1, t, u, n) }, setInt16: function (t, n) { v(this, 2, t, c, n, arguments[2]) }, setUint16: function (t, n) { v(this, 2, t, c, n, arguments[2]) }, setInt32: function (t, n) { v(this, 4, t, f, n, arguments[2]) }, setUint32: function (t, n) { v(this, 4, t, f, n, arguments[2]) }, setFloat32: function (t, n) { v(this, 4, t, s, n, arguments[2]) }, setFloat64: function (t, n) { v(this, 8, t, a, n, arguments[2]) } }); j(N, F), j(T, A), b(T[I], g.VIEW, !0), n[F] = N, n[A] = T }, function (t, n, r) { var e = r(3), i = r(46), o = r(68), u = r(195), c = r(11).f; t.exports = function (t) { var n = i.Symbol || (i.Symbol = o ? {} : e.Symbol || {}); "_" == t.charAt(0) || t in n || c(n, t, { value: u.f(t) }) } }, function (t, n, r) { var e = r(81), i = r(7)("iterator"), o = r(82); t.exports = r(46).getIteratorMethod = function (t) { if (null != t) return t[i] || t["@@iterator"] || o[e(t)] } }, function (t, n, r) { "use strict"; var e = r(67), i = r(178), o = r(82), u = r(33); t.exports = r(147)(Array, "Array", function (t, n) { this._t = u(t), this._i = 0, this._k = n }, function () { var t = this._t, n = this._k, r = this._i++; return !t || r >= t.length ? (this._t = void 0, i(1)) : i(0, "keys" == n ? r : "values" == n ? t[r] : [r, t[r]]) }, "values"), o.Arguments = o.Array, e("keys"), e("values"), e("entries") }, function (t, n) { t.exports = function (t, n) { t.classList ? t.classList.add(n) : t.className += " " + n } }, function (t, n) { t.exports = function (t, n) { if (t.classList) t.classList.remove(n); else { var r = new RegExp("(^|\\b)" + n.split(" ").join("|") + "(\\b|$)", "gi"); t.className = t.className.replace(r, " ") } } }, function (t, n, r) { var e = r(45); t.exports = function (t, n) { if ("number" != typeof t && "Number" != e(t)) throw TypeError(n); return +t } }, function (t, n, r) { "use strict"; var a = r(17), s = r(78), l = r(8); t.exports = [].copyWithin || function (t, n) { var r = a(this), e = l(r.length), i = s(t, e), o = s(n, e), u = 2 < arguments.length ? arguments[2] : void 0, c = Math.min((void 0 === u ? e : s(u, e)) - o, e - i), f = 1; for (o < i && i < o + c && (f = -1, o += c - 1, i += c - 1); 0 < c--;)o in r ? r[i] = r[o] : delete r[i], i += f, o += f; return r } }, function (t, n, r) { var e = r(71); t.exports = function (t, n) { var r = []; return e(t, !1, r.push, r, n), r } }, function (t, n, r) { var s = r(21), l = r(17), h = r(116), v = r(8); t.exports = function (t, n, r, e, i) { s(n); var o = l(t), u = h(o), c = v(o.length), f = i ? c - 1 : 0, a = i ? -1 : 1; if (r < 2) for (; ;) { if (f in u) { e = u[f], f += a; break } if (f += a, i ? f < 0 : c <= f) throw TypeError("Reduce of empty array with no initial value") } for (; i ? 0 <= f : f < c; f += a)f in u && (e = n(e, u[f], f, o)); return e } }, function (t, n, r) { "use strict"; var o = r(21), u = r(5), c = r(175), f = [].slice, a = {}; t.exports = Function.bind || function (n) { var r = o(this), e = f.call(arguments, 1), i = function () { var t = e.concat(f.call(arguments)); return this instanceof i ? function (t, n, r) { if (!(n in a)) { for (var e = [], i = 0; i < n; i++)e[i] = "a[" + i + "]"; a[n] = Function("F,a", "return new F(" + e.join(",") + ")") } return a[n](t, r) }(r, t.length, t) : c(r, t, n) }; return u(r.prototype) && (i.prototype = r.prototype), i } }, function (t, n, r) { "use strict"; var u = r(11).f, c = r(72), f = r(76), a = r(47), s = r(70), l = r(71), e = r(147), i = r(178), o = r(77), h = r(10), v = r(69).fastKey, p = r(80), d = h ? "_s" : "size", y = function (t, n) { var r, e = v(n); if ("F" !== e) return t._i[e]; for (r = t._f; r; r = r.n)if (r.k == n) return r }; t.exports = { getConstructor: function (t, o, r, e) { var i = t(function (t, n) { s(t, i, o, "_i"), t._t = o, t._i = c(null), t._f = void 0, t._l = void 0, t[d] = 0, null != n && l(n, r, t[e], t) }); return f(i.prototype, { clear: function () { for (var t = p(this, o), n = t._i, r = t._f; r; r = r.n)r.r = !0, r.p && (r.p = r.p.n = void 0), delete n[r.i]; t._f = t._l = void 0, t[d] = 0 }, delete: function (t) { var n = p(this, o), r = y(n, t); if (r) { var e = r.n, i = r.p; delete n._i[r.i], r.r = !0, i && (i.n = e), e && (e.p = i), n._f == r && (n._f = e), n._l == r && (n._l = i), n[d]-- } return !!r }, forEach: function (t) { p(this, o); for (var n, r = a(t, 1 < arguments.length ? arguments[1] : void 0, 3); n = n ? n.n : this._f;)for (r(n.v, n.k, this); n && n.r;)n = n.p }, has: function (t) { return !!y(p(this, o), t) } }), h && u(i.prototype, "size", { get: function () { return p(this, o)[d] } }), i }, def: function (t, n, r) { var e, i, o = y(t, n); return o ? o.v = r : (t._l = o = { i: i = v(n, !0), k: n, v: r, p: e = t._l, n: void 0, r: !1 }, t._f || (t._f = o), e && (e.n = o), t[d]++, "F" !== i && (t._i[i] = o)), t }, getEntry: y, setStrong: function (t, r, n) { e(t, r, function (t, n) { this._t = p(t, r), this._k = n, this._l = void 0 }, function () { for (var t = this, n = t._k, r = t._l; r && r.r;)r = r.p; return t._t && (t._l = r = r ? r.n : t._t._f) ? i(0, "keys" == n ? r.k : "values" == n ? r.v : [r.k, r.v]) : (t._t = void 0, i(1)) }, n ? "entries" : "values", !n, !0), o(r) } } }, function (t, n, r) { var e = r(81), i = r(167); t.exports = function (t) { return function () { if (e(this) != t) throw TypeError(t + "#toJSON isn't generic"); return i(this) } } }, function (t, n, r) { "use strict"; var u = r(76), c = r(69).getWeak, i = r(2), f = r(5), a = r(70), s = r(71), e = r(50), l = r(30), h = r(80), o = e(5), v = e(6), p = 0, d = function (t) { return t._l || (t._l = new y) }, y = function () { this.a = [] }, g = function (t, n) { return o(t.a, function (t) { return t[0] === n }) }; y.prototype = { get: function (t) { var n = g(this, t); if (n) return n[1] }, has: function (t) { return !!g(this, t) }, set: function (t, n) { var r = g(this, t); r ? r[1] = n : this.a.push([t, n]) }, delete: function (n) { var t = v(this.a, function (t) { return t[0] === n }); return ~t && this.a.splice(t, 1), !!~t } }, t.exports = { getConstructor: function (t, r, e, i) { var o = t(function (t, n) { a(t, o, r, "_i"), t._t = r, t._i = p++, t._l = void 0, null != n && s(n, e, t[i], t) }); return u(o.prototype, { delete: function (t) { if (!f(t)) return !1; var n = c(t); return !0 === n ? d(h(this, r)).delete(t) : n && l(n, this._i) && delete n[this._i] }, has: function (t) { if (!f(t)) return !1; var n = c(t); return !0 === n ? d(h(this, r)).has(t) : n && l(n, this._i) } }), o }, def: function (t, n, r) { var e = c(i(n), !0); return !0 === e ? d(t).set(n, r) : e[t._i] = r, t }, ufstore: d } }, function (t, n, r) { "use strict"; var p = r(123), d = r(5), y = r(8), g = r(47), b = r(7)("isConcatSpreadable"); t.exports = function t(n, r, e, i, o, u, c, f) { for (var a, s, l = o, h = 0, v = !!c && g(c, f, 3); h < i;) { if (h in e) { if (a = v ? v(e[h], h, r) : e[h], s = !1, d(a) && (s = void 0 !== (s = a[b]) ? !!s : p(a)), s && 0 < u) l = t(n, r, a, y(a.length), l, u - 1) - 1; else { if (9007199254740991 <= l) throw TypeError(); n[l] = a } l++ } h++ } return l } }, function (t, n, r) { t.exports = !r(10) && !r(4)(function () { return 7 != Object.defineProperty(r(140)("div"), "a", { get: function () { return 7 } }).a }) }, function (t, n) { t.exports = function (t, n, r) { var e = void 0 === r; switch (n.length) { case 0: return e ? t() : t.call(r); case 1: return e ? t(n[0]) : t.call(r, n[0]); case 2: return e ? t(n[0], n[1]) : t.call(r, n[0], n[1]); case 3: return e ? t(n[0], n[1], n[2]) : t.call(r, n[0], n[1], n[2]); case 4: return e ? t(n[0], n[1], n[2], n[3]) : t.call(r, n[0], n[1], n[2], n[3]) }return t.apply(r, n) } }, function (t, n, r) { var e = r(5), i = Math.floor; t.exports = function (t) { return !e(t) && isFinite(t) && i(t) === t } }, function (t, n, r) { var o = r(2); t.exports = function (t, n, r, e) { try { return e ? n(o(r)[0], r[1]) : n(r) } catch (n) { var i = t.return; throw void 0 !== i && o(i.call(t)), n } } }, function (t, n) { t.exports = function (t, n) { return { value: n, done: !!t } } }, function (t, n, r) { var o = r(149), e = Math.pow, u = e(2, -52), c = e(2, -23), f = e(2, 127) * (2 - c), a = e(2, -126); t.exports = Math.fround || function (t) { var n, r, e = Math.abs(t), i = o(t); return e < a ? i * (e / a / c + 1 / u - 1 / u) * a * c : f < (r = (n = (1 + c / u) * e) - (n - e)) || r != r ? i * (1 / 0) : i * r } }, function (t, n) { t.exports = Math.log1p || function (t) { return -1e-8 < (t = +t) && t < 1e-8 ? t - t * t / 2 : Math.log(1 + t) } }, function (t, n) { t.exports = Math.scale || function (t, n, r, e, i) { return 0 === arguments.length || t != t || n != n || r != r || e != e || i != i ? NaN : t === 1 / 0 || t === -1 / 0 ? t : (t - n) * (i - e) / (r - n) + e } }, function (t, n, r) { "use strict"; var h = r(10), v = r(74), p = r(127), d = r(117), y = r(17), g = r(116), i = Object.assign; t.exports = !i || r(4)(function () { var t = {}, n = {}, r = Symbol(), e = "abcdefghijklmnopqrst"; return t[r] = 7, e.split("").forEach(function (t) { n[t] = t }), 7 != i({}, t)[r] || Object.keys(i({}, n)).join("") != e }) ? function (t, n) { for (var r = y(t), e = arguments.length, i = 1, o = p.f, u = d.f; i < e;)for (var c, f = g(arguments[i++]), a = o ? v(f).concat(o(f)) : v(f), s = a.length, l = 0; l < s;)c = a[l++], h && !u.call(f, c) || (r[c] = f[c]); return r } : i }, function (t, n, r) { var u = r(11), c = r(2), f = r(74); t.exports = r(10) ? Object.defineProperties : function (t, n) { c(t); for (var r, e = f(n), i = e.length, o = 0; o < i;)u.f(t, r = e[o++], n[r]); return t } }, function (t, n, r) { var e = r(33), i = r(73).f, o = {}.toString, u = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : []; t.exports.f = function (t) { return u && "[object Window]" == o.call(t) ? function (t) { try { return i(t) } catch (t) { return u.slice() } }(t) : i(e(t)) } }, function (t, n, r) { var u = r(30), c = r(33), f = r(120)(!1), a = r(154)("IE_PROTO"); t.exports = function (t, n) { var r, e = c(t), i = 0, o = []; for (r in e) r != a && u(e, r) && o.push(r); for (; n.length > i;)u(e, r = n[i++]) && (~f(o, r) || o.push(r)); return o } }, function (t, n, r) { var f = r(10), a = r(74), s = r(33), l = r(117).f; t.exports = function (c) { return function (t) { for (var n, r = s(t), e = a(r), i = e.length, o = 0, u = []; o < i;)n = e[o++], f && !l.call(r, n) || u.push(c ? [n, r[n]] : r[n]); return u } } }, function (t, n, r) { var e = r(73), i = r(127), o = r(2), u = r(3).Reflect; t.exports = u && u.ownKeys || function (t) { var n = e.f(o(t)), r = i.f; return r ? n.concat(r(t)) : n } }, function (t, n, r) { var e = r(3).parseFloat, i = r(84).trim; t.exports = 1 / e(r(157) + "-0") != -1 / 0 ? function (t) { var n = i(String(t), 3), r = e(n); return 0 === r && "-" == n.charAt(0) ? -0 : r } : e }, function (t, n, r) { var e = r(3).parseInt, i = r(84).trim, o = r(157), u = /^[-+]?0[xX]/; t.exports = 8 !== e(o + "08") || 22 !== e(o + "0x16") ? function (t, n) { var r = i(String(t), 3); return e(r, n >>> 0 || (u.test(r) ? 16 : 10)) } : e }, function (t, n) { t.exports = function (t) { try { return { e: !1, v: t() } } catch (t) { return { e: !0, v: t } } } }, function (t, n, r) { var e = r(2), i = r(5), o = r(151); t.exports = function (t, n) { if (e(t), i(n) && n.constructor === t) return n; var r = o.f(t); return (0, r.resolve)(n), r.promise } }, function (t, n) { t.exports = Object.is || function (t, n) { return t === n ? 0 !== t || 1 / t == 1 / n : t != t && n != n } }, function (t, n, r) { var s = r(8), l = r(156), h = r(51); t.exports = function (t, n, r, e) { var i = String(h(t)), o = i.length, u = void 0 === r ? " " : String(r), c = s(n); if (c <= o || "" == u) return i; var f = c - o, a = l.call(u, Math.ceil(f / u.length)); return a.length > f && (a = a.slice(0, f)), e ? a + i : i + a } }, function (t, n, r) { var e = r(49), i = r(8); t.exports = function (t) { if (void 0 === t) return 0; var n = e(t), r = i(n); if (n !== r) throw RangeError("Wrong length!"); return r } }, function (t, n, r) { n.f = r(7) }, function (t, n, r) { "use strict"; var e = r(170), i = r(80); t.exports = r(121)("Map", function (t) { return function () { return t(this, 0 < arguments.length ? arguments[0] : void 0) } }, { get: function (t) { var n = e.getEntry(i(this, "Map"), t); return n && n.v }, set: function (t, n) { return e.def(i(this, "Map"), 0 === t ? 0 : t, n) } }, e, !0) }, function (t, n, r) { "use strict"; var e = r(152); r(1)({ target: "RegExp", proto: !0, forced: e !== /./.exec }, { exec: e }) }, function (t, n, r) { r(10) && "g" != /./g.flags && r(11).f(RegExp.prototype, "flags", { configurable: !0, get: r(115) }) }, function (t, n, r) { "use strict"; var e = r(170), i = r(80); t.exports = r(121)("Set", function (t) { return function () { return t(this, 0 < arguments.length ? arguments[0] : void 0) } }, { add: function (t) { return e.def(i(this, "Set"), t = 0 === t ? 0 : t, t) } }, e) }, function (t, n, r) { "use strict"; var o, e = r(3), i = r(50)(0), u = r(27), c = r(69), f = r(182), a = r(172), s = r(5), l = r(80), h = r(80), v = !e.ActiveXObject && "ActiveXObject" in e, p = "WeakMap", d = c.getWeak, y = Object.isExtensible, g = a.ufstore, b = function (t) { return function () { return t(this, 0 < arguments.length ? arguments[0] : void 0) } }, x = { get: function (t) { if (s(t)) { var n = d(t); return !0 === n ? g(l(this, p)).get(t) : n ? n[this._i] : void 0 } }, set: function (t, n) { return a.def(l(this, p), t, n) } }, m = t.exports = r(121)(p, b, x, a, !0, !0); h && v && (f((o = a.getConstructor(b, p)).prototype, x), c.NEED = !0, i(["delete", "has", "get", "set"], function (e) { var t = m.prototype, i = t[e]; u(t, e, function (t, n) { if (!s(t) || y(t)) return i.call(this, t, n); this._f || (this._f = new o); var r = this._f[e](t, n); return "set" == e ? this : r }) })) }, , , , function (t, n) { "use strict"; t.exports = { init: function () { var t = document.querySelector("#page-nav"); t && !document.querySelector("#page-nav .extend.prev") && (t.innerHTML = '<a class="extend prev disabled" rel="prev">上一页</a>' + t.innerHTML), t && !document.querySelector("#page-nav .extend.next") && (t.innerHTML = t.innerHTML + '<a class="extend next disabled" rel="next">下一页</a>'), yiliaConfig && yiliaConfig.open_in_new && document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function (t) { var n = t.getAttribute("target"); n && "" !== n || t.setAttribute("target", "_blank") }), yiliaConfig && yiliaConfig.toc_hide_index && document.querySelectorAll(".toc-number").forEach(function (t) { t.style.display = "none" }) } } }, function (t, n, r) { "use strict"; function e(t) { return t && t.__esModule ? t : { default: t } } function i(t, n, r, e, i) { var o = function (t) { for (var n = t.offsetLeft, r = t.offsetParent; null !== r;)n += r.offsetLeft, r = r.offsetParent; return n }(t), u = function (t) { for (var n = t.offsetTop, r = t.offsetParent; null !== r;)n += r.offsetTop, r = r.offsetParent; return n }(t) - n; if (u - r <= i) { var c = t.$newDom; c || (c = t.cloneNode(!0), (0, a.default)(t, c), (t.$newDom = c).style.position = "fixed", c.style.top = (r || u) + "px", c.style.left = o + "px", c.style.zIndex = e || 2, c.style.width = "100%", c.style.color = "#fff"), c.style.visibility = "visible", t.style.visibility = "hidden" } else { t.style.visibility = "visible"; var f = t.$newDom; f && (f.style.visibility = "hidden") } } function o() { var t = document.querySelector(".js-overlay"), n = document.querySelector(".js-header-menu"); i(t, document.body.scrollTop, -63, 2, 0), i(n, document.body.scrollTop, 1, 3, 0) } var f = e(r(163)), a = e((e(r(164)), r(414))), u = e(r(134)), c = e(r(204)), s = r(135); u.default.versions.mobile && window.screen.width < 800 && (function () { for (var t = document.querySelectorAll(".js-header-menu li a"), n = window.location.pathname, r = 0, e = t.length; r < e; r++) { var i = t[r]; o = n, u = i.getAttribute("href"), c = /\/|index.html/g, o.replace(c, "") === u.replace(c, "") && (0, f.default)(i, "active") } var o, u, c }(), document.querySelector("#container").addEventListener("scroll", function (t) { o() }), window.addEventListener("scroll", function (t) { o() }), o()), (0, s.addLoadEvent)(function () { c.default.init() }), t.exports = {} }, , , function (t, n, r) { (function (t) { "use strict"; function n(t, n, r) { t[n] || Object.defineProperty(t, n, { writable: !0, configurable: !0, value: r }) } if (r(413), r(209), r(211), t._babelPolyfill) throw new Error("only one instance of babel-polyfill is allowed"); t._babelPolyfill = !0; n(String.prototype, "padLeft", "".padStart), n(String.prototype, "padRight", "".padEnd), "pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function (t) { [][t] && n(Array, t, Function.call.bind([][t])) }) }).call(n, function () { return this }()) }, function (L, t) { (function (t) { !function (t) { "use strict"; function o(t, n, r, e) { var o, u, c, f, i = n && n.prototype instanceof h ? n : h, a = Object.create(i.prototype), s = new p(e || []); return a._invoke = (o = t, u = r, c = s, f = _, function (t, n) { if (f === E) throw new Error("Generator is already running"); if (f === M) { if ("throw" === t) throw n; return d() } for (c.method = t, c.arg = n; ;) { var r = c.delegate; if (r) { var e = v(r, c); if (e) { if (e === P) continue; return e } } if ("next" === c.method) c.sent = c._sent = c.arg; else if ("throw" === c.method) { if (f === _) throw f = M, c.arg; c.dispatchException(c.arg) } else "return" === c.method && c.abrupt("return", c.arg); f = E; var i = l(o, u, c); if ("normal" === i.type) { if (f = c.done ? M : O, i.arg === P) continue; return { value: i.arg, done: c.done } } "throw" === i.type && (f = M, c.method = "throw", c.arg = i.arg) } }), a } function l(t, n, r) { try { return { type: "normal", arg: t.call(n, r) } } catch (t) { return { type: "throw", arg: t } } } function h() { } function r() { } function n() { } function e(t) { ["next", "throw", "return"].forEach(function (n) { t[n] = function (t) { return this._invoke(n, t) } }) } function u(c) { function f(t, n, r, e) { var i = l(c[t], c, n); if ("throw" !== i.type) { var o = i.arg, u = o.value; return u && "object" == typeof u && y.call(u, "__await") ? Promise.resolve(u.__await).then(function (t) { f("next", t, r, e) }, function (t) { f("throw", t, r, e) }) : Promise.resolve(u).then(function (t) { o.value = t, r(o) }, e) } e(i.arg) } var n; "object" == typeof t.process && t.process.domain && (f = t.process.domain.bind(f)), this._invoke = function (r, e) { function t() { return new Promise(function (t, n) { f(r, e, t, n) }) } return n = n ? n.then(t, t) : t() } } function v(t, n) { var r = t.iterator[n.method]; if (r === a) { if (n.delegate = null, "throw" === n.method) { if (t.iterator.return && (n.method = "return", n.arg = a, v(t, n), "throw" === n.method)) return P; n.method = "throw", n.arg = new TypeError("The iterator does not provide a 'throw' method") } return P } var e = l(r, t.iterator, n.arg); if ("throw" === e.type) return n.method = "throw", n.arg = e.arg, n.delegate = null, P; var i = e.arg; return i ? i.done ? (n[t.resultName] = i.value, n.next = t.nextLoc, "return" !== n.method && (n.method = "next", n.arg = a), n.delegate = null, P) : i : (n.method = "throw", n.arg = new TypeError("iterator result is not an object"), n.delegate = null, P) } function i(t) { var n = { tryLoc: t[0] }; 1 in t && (n.catchLoc = t[1]), 2 in t && (n.finallyLoc = t[2], n.afterLoc = t[3]), this.tryEntries.push(n) } function c(t) { var n = t.completion || {}; n.type = "normal", delete n.arg, t.completion = n } function p(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(i, this), this.reset(!0) } function f(n) { if (n) { var t = n[b]; if (t) return t.call(n); if ("function" == typeof n.next) return n; if (!isNaN(n.length)) { var r = -1, e = function t() { for (; ++r < n.length;)if (y.call(n, r)) return t.value = n[r], t.done = !1, t; return t.value = a, t.done = !0, t }; return e.next = e } } return { next: d } } function d() { return { value: a, done: !0 } } var a, s = Object.prototype, y = s.hasOwnProperty, g = "function" == typeof Symbol ? Symbol : {}, b = g.iterator || "@@iterator", x = g.asyncIterator || "@@asyncIterator", m = g.toStringTag || "@@toStringTag", S = "object" == typeof L, w = t.regeneratorRuntime; if (w) S && (L.exports = w); else { (w = t.regeneratorRuntime = S ? L.exports : {}).wrap = o; var _ = "suspendedStart", O = "suspendedYield", E = "executing", M = "completed", P = {}, j = {}; j[b] = function () { return this }; var F = Object.getPrototypeOf, A = F && F(F(f([]))); A && A !== s && y.call(A, b) && (j = A); var I = n.prototype = h.prototype = Object.create(j); r.prototype = I.constructor = n, n.constructor = r, n[m] = r.displayName = "GeneratorFunction", w.isGeneratorFunction = function (t) { var n = "function" == typeof t && t.constructor; return !!n && (n === r || "GeneratorFunction" === (n.displayName || n.name)) }, w.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, n) : (t.__proto__ = n, m in t || (t[m] = "GeneratorFunction")), t.prototype = Object.create(I), t }, w.awrap = function (t) { return { __await: t } }, e(u.prototype), u.prototype[x] = function () { return this }, w.AsyncIterator = u, w.async = function (t, n, r, e) { var i = new u(o(t, n, r, e)); return w.isGeneratorFunction(n) ? i : i.next().then(function (t) { return t.done ? t.value : i.next() }) }, e(I), I[m] = "Generator", I[b] = function () { return this }, I.toString = function () { return "[object Generator]" }, w.keys = function (r) { var e = []; for (var t in r) e.push(t); return e.reverse(), function t() { for (; e.length;) { var n = e.pop(); if (n in r) return t.value = n, t.done = !1, t } return t.done = !0, t } }, w.values = f, p.prototype = { constructor: p, reset: function (t) { if (this.prev = 0, this.next = 0, this.sent = this._sent = a, this.done = !1, this.delegate = null, this.method = "next", this.arg = a, this.tryEntries.forEach(c), !t) for (var n in this) "t" === n.charAt(0) && y.call(this, n) && !isNaN(+n.slice(1)) && (this[n] = a) }, stop: function () { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval }, dispatchException: function (r) { function t(t, n) { return o.type = "throw", o.arg = r, e.next = t, n && (e.method = "next", e.arg = a), !!n } if (this.done) throw r; for (var e = this, n = this.tryEntries.length - 1; 0 <= n; --n) { var i = this.tryEntries[n], o = i.completion; if ("root" === i.tryLoc) return t("end"); if (i.tryLoc <= this.prev) { var u = y.call(i, "catchLoc"), c = y.call(i, "finallyLoc"); if (u && c) { if (this.prev < i.catchLoc) return t(i.catchLoc, !0); if (this.prev < i.finallyLoc) return t(i.finallyLoc) } else if (u) { if (this.prev < i.catchLoc) return t(i.catchLoc, !0) } else { if (!c) throw new Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return t(i.finallyLoc) } } } }, abrupt: function (t, n) { for (var r = this.tryEntries.length - 1; 0 <= r; --r) { var e = this.tryEntries[r]; if (e.tryLoc <= this.prev && y.call(e, "finallyLoc") && this.prev < e.finallyLoc) { var i = e; break } } i && ("break" === t || "continue" === t) && i.tryLoc <= n && n <= i.finallyLoc && (i = null); var o = i ? i.completion : {}; return o.type = t, o.arg = n, i ? (this.method = "next", this.next = i.finallyLoc, P) : this.complete(o) }, complete: function (t, n) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && n && (this.next = n), P }, finish: function (t) { for (var n = this.tryEntries.length - 1; 0 <= n; --n) { var r = this.tryEntries[n]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), c(r), P } }, catch: function (t) { for (var n = this.tryEntries.length - 1; 0 <= n; --n) { var r = this.tryEntries[n]; if (r.tryLoc === t) { var e = r.completion; if ("throw" === e.type) { var i = e.arg; c(r) } return i } } throw new Error("illegal catch attempt") }, delegateYield: function (t, n, r) { return this.delegate = { iterator: f(t), resultName: n, nextLoc: r }, "next" === this.method && (this.arg = a), P } } } }("object" == typeof t ? t : "object" == typeof window ? window : "object" == typeof self ? self : this) }).call(t, function () { return this }()) }, , function (t, n, r) { r(221), t.exports = r(46).RegExp.escape }, , , , function (t, n, r) { var e = r(5), i = r(123), o = r(7)("species"); t.exports = function (t) { var n; return i(t) && ("function" != typeof (n = t.constructor) || n !== Array && !i(n.prototype) || (n = void 0), e(n) && (null === (n = n[o]) && (n = void 0))), void 0 === n ? Array : n } }, function (t, n, r) { "use strict"; var e = r(4), i = Date.prototype.getTime, o = Date.prototype.toISOString, u = function (t) { return 9 < t ? t : "0" + t }; t.exports = e(function () { return "0385-07-25T07:06:39.999Z" != o.call(new Date(-5e13 - 1)) }) || !e(function () { o.call(new Date(NaN)) }) ? function () { if (!isFinite(i.call(this))) throw RangeError("Invalid time value"); var t = this, n = t.getUTCFullYear(), r = t.getUTCMilliseconds(), e = n < 0 ? "-" : 9999 < n ? "+" : ""; return e + ("00000" + Math.abs(n)).slice(e ? -6 : -4) + "-" + u(t.getUTCMonth() + 1) + "-" + u(t.getUTCDate()) + "T" + u(t.getUTCHours()) + ":" + u(t.getUTCMinutes()) + ":" + u(t.getUTCSeconds()) + "." + (99 < r ? r : "0" + u(r)) + "Z" } : o }, function (t, n, r) { "use strict"; var e = r(2), i = r(53); t.exports = function (t) { if ("string" !== t && "number" !== t && "default" !== t) throw TypeError("Incorrect hint"); return i(e(this), "number" != t) } }, function (t, n, r) { var c = r(74), f = r(127), a = r(117); t.exports = function (t) { var n = c(t), r = f.f; if (r) for (var e, i = r(t), o = a.f, u = 0; i.length > u;)o.call(t, e = i[u++]) && n.push(e); return n } }, function (t, n, r) { t.exports = r(118)("native-function-to-string", Function.toString) }, function (t, n) { t.exports = function (n, r) { var e = r === Object(r) ? function (t) { return r[t] } : r; return function (t) { return String(t).replace(n, e) } } }, function (t, n, r) { var e = r(1), i = r(220)(/[\\^$*+?.()|[\]{}]/g, "\\$&"); e(e.S, "RegExp", { escape: function (t) { return i(t) } }) }, function (t, n, r) { var e = r(1); e(e.P, "Array", { copyWithin: r(166) }), r(67)("copyWithin") }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(4); e(e.P + e.F * !r(48)([].every, !0), "Array", { every: function (t) { return i(this, t, arguments[1]) } }) }, function (t, n, r) { var e = r(1); e(e.P, "Array", { fill: r(137) }), r(67)("fill") }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(2); e(e.P + e.F * !r(48)([].filter, !0), "Array", { filter: function (t) { return i(this, t, arguments[1]) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(6), o = "findIndex", u = !0; o in [] && Array(1)[o](function () { u = !1 }), e(e.P + e.F * u, "Array", { findIndex: function (t) { return i(this, t, 1 < arguments.length ? arguments[1] : void 0) } }), r(67)(o) }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(5), o = "find", u = !0; o in [] && Array(1)[o](function () { u = !1 }), e(e.P + e.F * u, "Array", { find: function (t) { return i(this, t, 1 < arguments.length ? arguments[1] : void 0) } }), r(67)(o) }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(0), o = r(48)([].forEach, !0); e(e.P + e.F * !o, "Array", { forEach: function (t) { return i(this, t, arguments[1]) } }) }, function (t, n, r) { "use strict"; var h = r(47), e = r(1), v = r(17), p = r(177), d = r(145), y = r(8), g = r(139), b = r(161); e(e.S + e.F * !r(125)(function (t) { Array.from(t) }), "Array", { from: function (t) { var n, r, e, i, o = v(t), u = "function" == typeof this ? this : Array, c = arguments.length, f = 1 < c ? arguments[1] : void 0, a = void 0 !== f, s = 0, l = b(o); if (a && (f = h(f, 2 < c ? arguments[2] : void 0, 2)), null == l || u == Array && d(l)) for (r = new u(n = y(o.length)); s < n; s++)g(r, s, a ? f(o[s], s) : o[s]); else for (i = l.call(o), r = new u; !(e = i.next()).done; s++)g(r, s, a ? p(i, f, [e.value, s], !0) : e.value); return r.length = s, r } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(120)(!1), o = [].indexOf, u = !!o && 1 / [1].indexOf(1, -0) < 0; e(e.P + e.F * (u || !r(48)(o)), "Array", { indexOf: function (t) { return u ? o.apply(this, arguments) || 0 : i(this, t, arguments[1]) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Array", { isArray: r(123) }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(33), o = [].join; e(e.P + e.F * (r(116) != Object || !r(48)(o)), "Array", { join: function (t) { return o.call(i(this), void 0 === t ? "," : t) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(33), o = r(49), u = r(8), c = [].lastIndexOf, f = !!c && 1 / [1].lastIndexOf(1, -0) < 0; e(e.P + e.F * (f || !r(48)(c)), "Array", { lastIndexOf: function (t) { if (f) return c.apply(this, arguments) || 0; var n = i(this), r = u(n.length), e = r - 1; for (1 < arguments.length && (e = Math.min(e, o(arguments[1]))), e < 0 && (e = r + e); 0 <= e; e--)if (e in n && n[e] === t) return e || 0; return -1 } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(1); e(e.P + e.F * !r(48)([].map, !0), "Array", { map: function (t) { return i(this, t, arguments[1]) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(139); e(e.S + e.F * r(4)(function () { function t() { } return !(Array.of.call(t) instanceof t) }), "Array", { of: function () { for (var t = 0, n = arguments.length, r = new ("function" == typeof this ? this : Array)(n); t < n;)i(r, t, arguments[t++]); return r.length = n, r } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(168); e(e.P + e.F * !r(48)([].reduceRight, !0), "Array", { reduceRight: function (t) { return i(this, t, arguments.length, arguments[1], !0) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(168); e(e.P + e.F * !r(48)([].reduce, !0), "Array", { reduce: function (t) { return i(this, t, arguments.length, arguments[1], !1) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(143), a = r(45), s = r(78), l = r(8), h = [].slice; e(e.P + e.F * r(4)(function () { i && h.call(i) }), "Array", { slice: function (t, n) { var r = l(this.length), e = a(this); if (n = void 0 === n ? r : n, "Array" == e) return h.call(this, t, n); for (var i = s(t, r), o = s(n, r), u = l(o - i), c = new Array(u), f = 0; f < u; f++)c[f] = "String" == e ? this.charAt(i + f) : this[i + f]; return c } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(50)(3); e(e.P + e.F * !r(48)([].some, !0), "Array", { some: function (t) { return i(this, t, arguments[1]) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(21), o = r(17), u = r(4), c = [].sort, f = [1, 2, 3]; e(e.P + e.F * (u(function () { f.sort(void 0) }) || !u(function () { f.sort(null) }) || !r(48)(c)), "Array", { sort: function (t) { return void 0 === t ? c.call(o(this)) : c.call(o(this), i(t)) } }) }, function (t, n, r) { r(77)("Array") }, function (t, n, r) { var e = r(1); e(e.S, "Date", { now: function () { return (new Date).getTime() } }) }, function (t, n, r) { var e = r(1), i = r(216); e(e.P + e.F * (Date.prototype.toISOString !== i), "Date", { toISOString: i }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(17), o = r(53); e(e.P + e.F * r(4)(function () { return null !== new Date(NaN).toJSON() || 1 !== Date.prototype.toJSON.call({ toISOString: function () { return 1 } }) }), "Date", { toJSON: function (t) { var n = i(this), r = o(n); return "number" != typeof r || isFinite(r) ? n.toISOString() : null } }) }, function (t, n, r) { var e = r(7)("toPrimitive"), i = Date.prototype; e in i || r(26)(i, e, r(217)) }, function (t, n, r) { var e = Date.prototype, i = "Invalid Date", o = "toString", u = e[o], c = e.getTime; new Date(NaN) + "" != i && r(27)(e, o, function () { var t = c.call(this); return t == t ? u.call(this) : i }) }, function (t, n, r) { var e = r(1); e(e.P, "Function", { bind: r(169) }) }, function (t, n, r) { "use strict"; var e = r(5), i = r(32), o = r(7)("hasInstance"), u = Function.prototype; o in u || r(11).f(u, o, { value: function (t) { if ("function" != typeof this || !e(t)) return !1; if (!e(this.prototype)) return t instanceof this; for (; t = i(t);)if (this.prototype === t) return !0; return !1 } }) }, function (t, n, r) { var e = r(11).f, i = Function.prototype, o = /^\s*function ([^ (]*)/; "name" in i || r(10) && e(i, "name", { configurable: !0, get: function () { try { return ("" + this).match(o)[1] } catch (t) { return "" } } }) }, function (t, n, r) { var e = r(1), i = r(180), o = Math.sqrt, u = Math.acosh; e(e.S + e.F * !(u && 710 == Math.floor(u(Number.MAX_VALUE)) && u(1 / 0) == 1 / 0), "Math", { acosh: function (t) { return (t = +t) < 1 ? NaN : 94906265.62425156 < t ? Math.log(t) + Math.LN2 : i(t - 1 + o(t - 1) * o(t + 1)) } }) }, function (t, n, r) { var e = r(1), i = Math.asinh; e(e.S + e.F * !(i && 0 < 1 / i(0)), "Math", { asinh: function t(n) { return isFinite(n = +n) && 0 != n ? n < 0 ? -t(-n) : Math.log(n + Math.sqrt(n * n + 1)) : n } }) }, function (t, n, r) { var e = r(1), i = Math.atanh; e(e.S + e.F * !(i && 1 / i(-0) < 0), "Math", { atanh: function (t) { return 0 == (t = +t) ? t : Math.log((1 + t) / (1 - t)) / 2 } }) }, function (t, n, r) { var e = r(1), i = r(149); e(e.S, "Math", { cbrt: function (t) { return i(t = +t) * Math.pow(Math.abs(t), 1 / 3) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { clz32: function (t) { return (t >>>= 0) ? 31 - Math.floor(Math.log(t + .5) * Math.LOG2E) : 32 } }) }, function (t, n, r) { var e = r(1), i = Math.exp; e(e.S, "Math", { cosh: function (t) { return (i(t = +t) + i(-t)) / 2 } }) }, function (t, n, r) { var e = r(1), i = r(148); e(e.S + e.F * (i != Math.expm1), "Math", { expm1: i }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { fround: r(179) }) }, function (t, n, r) { var e = r(1), f = Math.abs; e(e.S, "Math", { hypot: function (t, n) { for (var r, e, i = 0, o = 0, u = arguments.length, c = 0; o < u;)c < (r = f(arguments[o++])) ? (i = i * (e = c / r) * e + 1, c = r) : 0 < r ? i += (e = r / c) * e : i += r; return c === 1 / 0 ? 1 / 0 : c * Math.sqrt(i) } }) }, function (t, n, r) { var e = r(1), i = Math.imul; e(e.S + e.F * r(4)(function () { return -5 != i(4294967295, 5) || 2 != i.length }), "Math", { imul: function (t, n) { var r = 65535, e = +t, i = +n, o = r & e, u = r & i; return 0 | o * u + ((r & e >>> 16) * u + o * (r & i >>> 16) << 16 >>> 0) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { log10: function (t) { return Math.log(t) * Math.LOG10E } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { log1p: r(180) }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { log2: function (t) { return Math.log(t) / Math.LN2 } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { sign: r(149) }) }, function (t, n, r) { var e = r(1), i = r(148), o = Math.exp; e(e.S + e.F * r(4)(function () { return -2e-17 != !Math.sinh(-2e-17) }), "Math", { sinh: function (t) { return Math.abs(t = +t) < 1 ? (i(t) - i(-t)) / 2 : (o(t - 1) - o(-t - 1)) * (Math.E / 2) } }) }, function (t, n, r) { var e = r(1), i = r(148), o = Math.exp; e(e.S, "Math", { tanh: function (t) { var n = i(t = +t), r = i(-t); return n == 1 / 0 ? 1 : r == 1 / 0 ? -1 : (n - r) / (o(t) + o(-t)) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { trunc: function (t) { return (0 < t ? Math.floor : Math.ceil)(t) } }) }, function (t, n, r) { "use strict"; var e = r(3), i = r(30), o = r(45), u = r(144), s = r(53), c = r(4), f = r(73).f, a = r(31).f, l = r(11).f, h = r(84).trim, v = "Number", p = e[v], d = p, y = p.prototype, g = o(r(72)(y)) == v, b = "trim" in String.prototype, x = function (t) { var n = s(t, !1); if ("string" == typeof n && 2 < n.length) { var r, e, i, o = (n = b ? n.trim() : h(n, 3)).charCodeAt(0); if (43 === o || 45 === o) { if (88 === (r = n.charCodeAt(2)) || 120 === r) return NaN } else if (48 === o) { switch (n.charCodeAt(1)) { case 66: case 98: e = 2, i = 49; break; case 79: case 111: e = 8, i = 55; break; default: return +n }for (var u, c = n.slice(2), f = 0, a = c.length; f < a; f++)if ((u = c.charCodeAt(f)) < 48 || i < u) return NaN; return parseInt(c, e) } } return +n }; if (!p(" 0o1") || !p("0b1") || p("+0x1")) { p = function (t) { var n = arguments.length < 1 ? 0 : t, r = this; return r instanceof p && (g ? c(function () { y.valueOf.call(r) }) : o(r) != v) ? u(new d(x(n)), r, p) : x(n) }; for (var m, S = r(10) ? f(d) : "MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","), w = 0; S.length > w; w++)i(d, m = S[w]) && !i(p, m) && l(p, m, a(d, m)); (p.prototype = y).constructor = p, r(27)(e, v, p) } }, function (t, n, r) { var e = r(1); e(e.S, "Number", { EPSILON: Math.pow(2, -52) }) }, function (t, n, r) { var e = r(1), i = r(3).isFinite; e(e.S, "Number", { isFinite: function (t) { return "number" == typeof t && i(t) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Number", { isInteger: r(176) }) }, function (t, n, r) { var e = r(1); e(e.S, "Number", { isNaN: function (t) { return t != t } }) }, function (t, n, r) { var e = r(1), i = r(176), o = Math.abs; e(e.S, "Number", { isSafeInteger: function (t) { return i(t) && o(t) <= 9007199254740991 } }) }, function (t, n, r) { var e = r(1); e(e.S, "Number", { MAX_SAFE_INTEGER: 9007199254740991 }) }, function (t, n, r) { var e = r(1); e(e.S, "Number", { MIN_SAFE_INTEGER: -9007199254740991 }) }, function (t, n, r) { var e = r(1), i = r(188); e(e.S + e.F * (Number.parseFloat != i), "Number", { parseFloat: i }) }, function (t, n, r) { var e = r(1), i = r(189); e(e.S + e.F * (Number.parseInt != i), "Number", { parseInt: i }) }, function (t, n, r) { "use strict"; var e = r(1), a = r(49), s = r(165), l = r(156), i = 1..toFixed, o = Math.floor, u = [0, 0, 0, 0, 0, 0], h = "Number.toFixed: incorrect invocation!", v = function (t, n) { for (var r = -1, e = n; ++r < 6;)e += t * u[r], u[r] = e % 1e7, e = o(e / 1e7) }, p = function (t) { for (var n = 6, r = 0; 0 <= --n;)r += u[n], u[n] = o(r / t), r = r % t * 1e7 }, d = function () { for (var t = 6, n = ""; 0 <= --t;)if ("" !== n || 0 === t || 0 !== u[t]) { var r = String(u[t]); n = "" === n ? r : n + l.call("0", 7 - r.length) + r } return n }, y = function (t, n, r) { return 0 === n ? r : n % 2 == 1 ? y(t, n - 1, r * t) : y(t * t, n / 2, r) }; e(e.P + e.F * (!!i && ("0.000" !== 8e-5.toFixed(3) || "1" !== .9.toFixed(0) || "1.25" !== 1.255.toFixed(2) || "1000000000000000128" !== (0xde0b6b3a7640080).toFixed(0)) || !r(4)(function () { i.call({}) })), "Number", { toFixed: function (t) { var n, r, e, i, o = s(this, h), u = a(t), c = "", f = "0"; if (u < 0 || 20 < u) throw RangeError(h); if (o != o) return "NaN"; if (o <= -1e21 || 1e21 <= o) return String(o); if (o < 0 && (c = "-", o = -o), 1e-21 < o) if (r = (n = function (t) { for (var n = 0, r = t; 4096 <= r;)n += 12, r /= 4096; for (; 2 <= r;)n += 1, r /= 2; return n }(o * y(2, 69, 1)) - 69) < 0 ? o * y(2, -n, 1) : o / y(2, n, 1), r *= 4503599627370496, 0 < (n = 52 - n)) { for (v(0, r), e = u; 7 <= e;)v(1e7, 0), e -= 7; for (v(y(10, e, 1), 0), e = n - 1; 23 <= e;)p(1 << 23), e -= 23; p(1 << e), v(1, 1), p(2), f = d() } else v(0, r), v(1 << -n, 0), f = d() + l.call("0", u); return f = 0 < u ? c + ((i = f.length) <= u ? "0." + l.call("0", u - i) + f : f.slice(0, i - u) + "." + f.slice(i - u)) : c + f } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(4), o = r(165), u = 1..toPrecision; e(e.P + e.F * (i(function () { return "1" !== u.call(1, void 0) }) || !i(function () { u.call({}) })), "Number", { toPrecision: function (t) { var n = o(this, "Number#toPrecision: incorrect invocation!"); return void 0 === t ? u.call(n) : u.call(n, t) } }) }, function (t, n, r) { var e = r(1); e(e.S + e.F, "Object", { assign: r(182) }) }, function (t, n, r) { var e = r(1); e(e.S, "Object", { create: r(72) }) }, function (t, n, r) { var e = r(1); e(e.S + e.F * !r(10), "Object", { defineProperties: r(183) }) }, function (t, n, r) { var e = r(1); e(e.S + e.F * !r(10), "Object", { defineProperty: r(11).f }) }, function (t, n, r) { var e = r(5), i = r(69).onFreeze; r(52)("freeze", function (n) { return function (t) { return n && e(t) ? n(i(t)) : t } }) }, function (t, n, r) { var e = r(33), i = r(31).f; r(52)("getOwnPropertyDescriptor", function () { return function (t, n) { return i(e(t), n) } }) }, function (t, n, r) { r(52)("getOwnPropertyNames", function () { return r(184).f }) }, function (t, n, r) { var e = r(17), i = r(32); r(52)("getPrototypeOf", function () { return function (t) { return i(e(t)) } }) }, function (t, n, r) { var e = r(5); r(52)("isExtensible", function (n) { return function (t) { return !!e(t) && (!n || n(t)) } }) }, function (t, n, r) { var e = r(5); r(52)("isFrozen", function (n) { return function (t) { return !e(t) || !!n && n(t) } }) }, function (t, n, r) { var e = r(5); r(52)("isSealed", function (n) { return function (t) { return !e(t) || !!n && n(t) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Object", { is: r(192) }) }, function (t, n, r) { var e = r(17), i = r(74); r(52)("keys", function () { return function (t) { return i(e(t)) } }) }, function (t, n, r) { var e = r(5), i = r(69).onFreeze; r(52)("preventExtensions", function (n) { return function (t) { return n && e(t) ? n(i(t)) : t } }) }, function (t, n, r) { var e = r(5), i = r(69).onFreeze; r(52)("seal", function (n) { return function (t) { return n && e(t) ? n(i(t)) : t } }) }, function (t, n, r) { var e = r(1); e(e.S, "Object", { setPrototypeOf: r(153).set }) }, function (t, n, r) { "use strict"; var e = r(81), i = {}; i[r(7)("toStringTag")] = "z", i + "" != "[object z]" && r(27)(Object.prototype, "toString", function () { return "[object " + e(this) + "]" }, !0) }, function (t, n, r) { var e = r(1), i = r(188); e(e.G + e.F * (parseFloat != i), { parseFloat: i }) }, function (t, n, r) { var e = r(1), i = r(189); e(e.G + e.F * (parseInt != i), { parseInt: i }) }, function (t, n, r) { "use strict"; var e, i, o, u, c = r(68), f = r(3), a = r(47), s = r(81), l = r(1), h = r(5), v = r(21), p = r(70), d = r(71), y = r(119), g = r(158).set, b = r(150)(), x = r(151), m = r(190), S = r(133), w = r(191), _ = "Promise", O = f.TypeError, E = f.process, M = E && E.versions, P = M && M.v8 || "", j = f[_], F = "process" == s(E), A = function () { }, I = i = x.f, L = !!function () { try { var t = j.resolve(1), n = (t.constructor = {})[r(7)("species")] = function (t) { t(A, A) }; return (F || "function" == typeof PromiseRejectionEvent) && t.then(A) instanceof n && 0 !== P.indexOf("6.6") && -1 === S.indexOf("Chrome/66") } catch (t) { } }(), N = function (t) { var n; return !(!h(t) || "function" != typeof (n = t.then)) && n }, T = function (s, r) { if (!s._n) { s._n = !0; var e = s._c; b(function () { for (var f = s._v, a = 1 == s._s, t = 0, n = function (t) { var n, r, e, i = a ? t.ok : t.fail, o = t.resolve, u = t.reject, c = t.domain; try { i ? (a || (2 == s._h && C(s), s._h = 1), !0 === i ? n = f : (c && c.enter(), n = i(f), c && (c.exit(), e = !0)), n === t.promise ? u(O("Promise-chain cycle")) : (r = N(n)) ? r.call(n, o, u) : o(n)) : u(f) } catch (t) { c && !e && c.exit(), u(t) } }; e.length > t;)n(e[t++]); s._c = [], s._n = !1, r && !s._h && k(s) }) } }, k = function (o) { g.call(f, function () { var t, n, r, e = o._v, i = R(o); if (i && (t = m(function () { F ? E.emit("unhandledRejection", e, o) : (n = f.onunhandledrejection) ? n({ promise: o, reason: e }) : (r = f.console) && r.error && r.error("Unhandled promise rejection", e) }), o._h = F || R(o) ? 2 : 1), o._a = void 0, i && t.e) throw t.v }) }, R = function (t) { return 1 !== t._h && 0 === (t._a || t._c).length }, C = function (n) { g.call(f, function () { var t; F ? E.emit("rejectionHandled", n) : (t = f.onrejectionhandled) && t({ promise: n, reason: n._v }) }) }, D = function (t) { var n = this; n._d || (n._d = !0, (n = n._w || n)._v = t, n._s = 2, n._a || (n._a = n._c.slice()), T(n, !0)) }, G = function (t) { var r, e = this; if (!e._d) { e._d = !0, e = e._w || e; try { if (e === t) throw O("Promise can't be resolved itself"); (r = N(t)) ? b(function () { var n = { _w: e, _d: !1 }; try { r.call(t, a(G, n, 1), a(D, n, 1)) } catch (t) { D.call(n, t) } }) : (e._v = t, e._s = 1, T(e, !1)) } catch (t) { D.call({ _w: e, _d: !1 }, t) } } }; L || (j = function (t) { p(this, j, _, "_h"), v(t), e.call(this); try { t(a(G, this, 1), a(D, this, 1)) } catch (t) { D.call(this, t) } }, (e = function (t) { this._c = [], this._a = void 0, this._s = 0, this._d = !1, this._v = void 0, this._h = 0, this._n = !1 }).prototype = r(76)(j.prototype, { then: function (t, n) { var r = I(y(this, j)); return r.ok = "function" != typeof t || t, r.fail = "function" == typeof n && n, r.domain = F ? E.domain : void 0, this._c.push(r), this._a && this._a.push(r), this._s && T(this, !1), r.promise }, catch: function (t) { return this.then(void 0, t) } }), o = function () { var t = new e; this.promise = t, this.resolve = a(G, t, 1), this.reject = a(D, t, 1) }, x.f = I = function (t) { return t === j || t === u ? new o(t) : i(t) }), l(l.G + l.W + l.F * !L, { Promise: j }), r(83)(j, _), r(77)(_), u = r(46)[_], l(l.S + l.F * !L, _, { reject: function (t) { var n = I(this); return (0, n.reject)(t), n.promise } }), l(l.S + l.F * (c || !L), _, { resolve: function (t) { return w(c && this === u ? j : this, t) } }), l(l.S + l.F * !(L && r(125)(function (t) { j.all(t).catch(A) })), _, { all: function (t) { var u = this, n = I(u), c = n.resolve, f = n.reject, r = m(function () { var e = [], i = 0, o = 1; d(t, !1, function (t) { var n = i++, r = !1; e.push(void 0), o++, u.resolve(t).then(function (t) { r || (r = !0, e[n] = t, --o || c(e)) }, f) }), --o || c(e) }); return r.e && f(r.v), n.promise }, race: function (t) { var n = this, r = I(n), e = r.reject, i = m(function () { d(t, !1, function (t) { n.resolve(t).then(r.resolve, e) }) }); return i.e && e(i.v), r.promise } }) }, function (t, n, r) { var e = r(1), o = r(21), u = r(2), c = (r(3).Reflect || {}).apply, f = Function.apply; e(e.S + e.F * !r(4)(function () { c(function () { }) }), "Reflect", { apply: function (t, n, r) { var e = o(t), i = u(r); return c ? c(e, n, i) : f.call(e, n, i) } }) }, function (t, n, r) { var e = r(1), c = r(72), f = r(21), a = r(2), s = r(5), i = r(4), l = r(169), h = (r(3).Reflect || {}).construct, v = i(function () { function t() { } return !(h(function () { }, [], t) instanceof t) }), p = !i(function () { h(function () { }) }); e(e.S + e.F * (v || p), "Reflect", { construct: function (t, n) { f(t), a(n); var r = arguments.length < 3 ? t : f(arguments[2]); if (p && !v) return h(t, n, r); if (t == r) { switch (n.length) { case 0: return new t; case 1: return new t(n[0]); case 2: return new t(n[0], n[1]); case 3: return new t(n[0], n[1], n[2]); case 4: return new t(n[0], n[1], n[2], n[3]) }var e = [null]; return e.push.apply(e, n), new (l.apply(t, e)) } var i = r.prototype, o = c(s(i) ? i : Object.prototype), u = Function.apply.call(t, o, n); return s(u) ? u : o } }) }, function (t, n, r) { var e = r(11), i = r(1), o = r(2), u = r(53); i(i.S + i.F * r(4)(function () { Reflect.defineProperty(e.f({}, 1, { value: 1 }), 1, { value: 2 }) }), "Reflect", { defineProperty: function (t, n, r) { o(t), n = u(n, !0), o(r); try { return e.f(t, n, r), !0 } catch (t) { return !1 } } }) }, function (t, n, r) { var e = r(1), i = r(31).f, o = r(2); e(e.S, "Reflect", { deleteProperty: function (t, n) { var r = i(o(t), n); return !(r && !r.configurable) && delete t[n] } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(2), o = function (t) { this._t = i(t), this._i = 0; var n, r = this._k = []; for (n in t) r.push(n) }; r(146)(o, "Object", function () { var t, n = this._k; do { if (this._i >= n.length) return { value: void 0, done: !0 } } while (!((t = n[this._i++]) in this._t)); return { value: t, done: !1 } }), e(e.S, "Reflect", { enumerate: function (t) { return new o(t) } }) }, function (t, n, r) { var e = r(31), i = r(1), o = r(2); i(i.S, "Reflect", { getOwnPropertyDescriptor: function (t, n) { return e.f(o(t), n) } }) }, function (t, n, r) { var e = r(1), i = r(32), o = r(2); e(e.S, "Reflect", { getPrototypeOf: function (t) { return i(o(t)) } }) }, function (t, n, r) { var u = r(31), c = r(32), f = r(30), e = r(1), a = r(5), s = r(2); e(e.S, "Reflect", { get: function t(n, r) { var e, i, o = arguments.length < 3 ? n : arguments[2]; return s(n) === o ? n[r] : (e = u.f(n, r)) ? f(e, "value") ? e.value : void 0 !== e.get ? e.get.call(o) : void 0 : a(i = c(n)) ? t(i, r, o) : void 0 } }) }, function (t, n, r) { var e = r(1); e(e.S, "Reflect", { has: function (t, n) { return n in t } }) }, function (t, n, r) { var e = r(1), i = r(2), o = Object.isExtensible; e(e.S, "Reflect", { isExtensible: function (t) { return i(t), !o || o(t) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Reflect", { ownKeys: r(187) }) }, function (t, n, r) { var e = r(1), i = r(2), o = Object.preventExtensions; e(e.S, "Reflect", { preventExtensions: function (t) { i(t); try { return o && o(t), !0 } catch (t) { return !1 } } }) }, function (t, n, r) { var e = r(1), i = r(153); i && e(e.S, "Reflect", { setPrototypeOf: function (t, n) { i.check(t, n); try { return i.set(t, n), !0 } catch (t) { return !1 } } }) }, function (t, n, r) { var f = r(11), a = r(31), s = r(32), l = r(30), e = r(1), h = r(75), v = r(2), p = r(5); e(e.S, "Reflect", { set: function t(n, r, e) { var i, o, u = arguments.length < 4 ? n : arguments[3], c = a.f(v(n), r); if (!c) { if (p(o = s(n))) return t(o, r, e, u); c = h(0) } if (l(c, "value")) { if (!1 === c.writable || !p(u)) return !1; if (i = a.f(u, r)) { if (i.get || i.set || !1 === i.writable) return !1; i.value = e, f.f(u, r, i) } else f.f(u, r, h(0, e)); return !0 } return void 0 !== c.set && (c.set.call(u, e), !0) } }) }, function (t, n, r) { var e = r(3), o = r(144), i = r(11).f, u = r(73).f, c = r(124), f = r(115), a = e.RegExp, s = a, l = a.prototype, h = /a/g, v = /a/g, p = new a(h) !== h; if (r(10) && (!p || r(4)(function () { return v[r(7)("match")] = !1, a(h) != h || a(v) == v || "/a/i" != a(h, "i") }))) { a = function (t, n) { var r = this instanceof a, e = c(t), i = void 0 === n; return !r && e && t.constructor === a && i ? t : o(p ? new s(e && !i ? t.source : t, n) : s((e = t instanceof a) ? t.source : t, e && i ? f.call(t) : n), r ? this : l, a) }; for (var d = function (n) { n in a || i(a, n, { configurable: !0, get: function () { return s[n] }, set: function (t) { s[n] = t } }) }, y = u(s), g = 0; y.length > g;)d(y[g++]); (l.constructor = a).prototype = l, r(27)(e, "RegExp", a) } r(77)("RegExp") }, function (t, n, r) { "use strict"; var l = r(2), h = r(8), v = r(136), p = r(128); r(122)("match", 1, function (e, i, a, s) { return [function (t) { var n = e(this), r = null == t ? void 0 : t[i]; return void 0 !== r ? r.call(t, n) : new RegExp(t)[i](String(n)) }, function (t) { var n = s(a, t, this); if (n.done) return n.value; var r = l(t), e = String(this); if (!r.global) return p(r, e); for (var i, o = r.unicode, u = [], c = r.lastIndex = 0; null !== (i = p(r, e));) { var f = String(i[0]); "" === (u[c] = f) && (r.lastIndex = v(e, h(r.lastIndex), o)), c++ } return 0 === c ? null : u }] }) }, function (t, n, r) { "use strict"; var O = r(2), e = r(17), E = r(8), M = r(49), P = r(136), j = r(128), F = Math.max, A = Math.min, h = Math.floor, v = /\$([$&`']|\d\d?|<[^>]*>)/g, p = /\$([$&`']|\d\d?)/g; r(122)("replace", 2, function (i, o, S, w) { function _(o, u, c, f, a, t) { var s = c + o.length, l = f.length, n = p; return void 0 !== a && (a = e(a), n = v), S.call(t, n, function (t, n) { var r; switch (n.charAt(0)) { case "$": return "$"; case "&": return o; case "`": return u.slice(0, c); case "'": return u.slice(s); case "<": r = a[n.slice(1, -1)]; break; default: var e = +n; if (0 === e) return t; if (l < e) { var i = h(e / 10); return 0 === i ? t : i <= l ? void 0 === f[i - 1] ? n.charAt(1) : f[i - 1] + n.charAt(1) : t } r = f[e - 1] }return void 0 === r ? "" : r }) } return [function (t, n) { var r = i(this), e = null == t ? void 0 : t[o]; return void 0 !== e ? e.call(t, r, n) : S.call(String(r), t, n) }, function (t, n) { var r = w(S, t, this, n); if (r.done) return r.value; var e = O(t), i = String(this), o = "function" == typeof n; o || (n = String(n)); var u, c = e.global; if (c) { var f = e.unicode; e.lastIndex = 0 } for (var a = []; ;) { var s = j(e, i); if (null === s) break; if (a.push(s), !c) break; "" === String(s[0]) && (e.lastIndex = P(i, E(e.lastIndex), f)) } for (var l = "", h = 0, v = 0; v < a.length; v++) { s = a[v]; for (var p = String(s[0]), d = F(A(M(s.index), i.length), 0), y = [], g = 1; g < s.length; g++)y.push(void 0 === (u = s[g]) ? u : String(u)); var b = s.groups; if (o) { var x = [p].concat(y, d, i); void 0 !== b && x.push(b); var m = String(n.apply(void 0, x)) } else m = _(p, i, d, y, b, n); h <= d && (l += i.slice(h, d) + m, h = d + p.length) } return l + i.slice(h) }] }) }, function (t, n, r) { "use strict"; var f = r(2), a = r(192), s = r(128); r(122)("search", 1, function (e, i, u, c) { return [function (t) { var n = e(this), r = null == t ? void 0 : t[i]; return void 0 !== r ? r.call(t, n) : new RegExp(t)[i](String(n)) }, function (t) { var n = c(u, t, this); if (n.done) return n.value; var r = f(t), e = String(this), i = r.lastIndex; a(i, 0) || (r.lastIndex = 0); var o = s(r, e); return a(r.lastIndex, i) || (r.lastIndex = i), null === o ? -1 : o.index }] }) }, function (t, n, r) { "use strict"; var l = r(124), x = r(2), m = r(119), S = r(136), w = r(8), _ = r(128), h = r(152), e = r(4), O = Math.min, v = [].push, u = "split", p = "length", d = "lastIndex", E = 4294967295, M = !e(function () { RegExp(E, "y") }); r(122)("split", 2, function (i, o, y, g) { var b; return b = "c" == "abbc"[u](/(b)*/)[1] || 4 != "test"[u](/(?:)/, -1)[p] || 2 != "ab"[u](/(?:ab)*/)[p] || 4 != "."[u](/(.?)(.?)/)[p] || 1 < "."[u](/()()/)[p] || ""[u](/.?/)[p] ? function (t, n) { var r = String(this); if (void 0 === t && 0 === n) return []; if (!l(t)) return y.call(r, t, n); for (var e, i, o, u = [], c = (t.ignoreCase ? "i" : "") + (t.multiline ? "m" : "") + (t.unicode ? "u" : "") + (t.sticky ? "y" : ""), f = 0, a = void 0 === n ? E : n >>> 0, s = new RegExp(t.source, c + "g"); (e = h.call(s, r)) && !(f < (i = s[d]) && (u.push(r.slice(f, e.index)), 1 < e[p] && e.index < r[p] && v.apply(u, e.slice(1)), o = e[0][p], f = i, u[p] >= a));)s[d] === e.index && s[d]++; return f === r[p] ? !o && s.test("") || u.push("") : u.push(r.slice(f)), u[p] > a ? u.slice(0, a) : u } : "0"[u](void 0, 0)[p] ? function (t, n) { return void 0 === t && 0 === n ? [] : y.call(this, t, n) } : y, [function (t, n) { var r = i(this), e = null == t ? void 0 : t[o]; return void 0 !== e ? e.call(t, r, n) : b.call(String(r), t, n) }, function (t, n) { var r = g(b, t, this, n, b !== y); if (r.done) return r.value; var e = x(t), i = String(this), o = m(e, RegExp), u = e.unicode, c = (e.ignoreCase ? "i" : "") + (e.multiline ? "m" : "") + (e.unicode ? "u" : "") + (M ? "y" : "g"), f = new o(M ? e : "^(?:" + e.source + ")", c), a = void 0 === n ? E : n >>> 0; if (0 === a) return []; if (0 === i.length) return null === _(f, i) ? [i] : []; for (var s = 0, l = 0, h = []; l < i.length;) { f.lastIndex = M ? l : 0; var v, p = _(f, M ? i : i.slice(l)); if (null === p || (v = O(w(f.lastIndex + (M ? 0 : l)), i.length)) === s) l = S(i, l, u); else { if (h.push(i.slice(s, l)), h.length === a) return h; for (var d = 1; d <= p.length - 1; d++)if (h.push(p[d]), h.length === a) return h; l = s = v } } return h.push(i.slice(s)), h }] }) }, function (t, n, r) { "use strict"; r(198); var e = r(2), i = r(115), o = r(10), u = "toString", c = /./[u], f = function (t) { r(27)(RegExp.prototype, u, t, !0) }; r(4)(function () { return "/a/b" != c.call({ source: "a", flags: "b" }) }) ? f(function () { var t = e(this); return "/".concat(t.source, "/", "flags" in t ? t.flags : !o && t instanceof RegExp ? i.call(t) : void 0) }) : c.name != u && f(function () { return c.call(this) }) }, function (t, n, r) { "use strict"; r(28)("anchor", function (n) { return function (t) { return n(this, "a", "name", t) } }) }, function (t, n, r) { "use strict"; r(28)("big", function (t) { return function () { return t(this, "big", "", "") } }) }, function (t, n, r) { "use strict"; r(28)("blink", function (t) { return function () { return t(this, "blink", "", "") } }) }, function (t, n, r) { "use strict"; r(28)("bold", function (t) { return function () { return t(this, "b", "", "") } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(131)(!1); e(e.P, "String", { codePointAt: function (t) { return i(this, t) } }) }, function (t, n, r) { "use strict"; var e = r(1), u = r(8), c = r(155), f = "endsWith", a = ""[f]; e(e.P + e.F * r(142)(f), "String", { endsWith: function (t) { var n = c(this, t, f), r = 1 < arguments.length ? arguments[1] : void 0, e = u(n.length), i = void 0 === r ? e : Math.min(u(r), e), o = String(t); return a ? a.call(n, o, i) : n.slice(i - o.length, i) === o } }) }, function (t, n, r) { "use strict"; r(28)("fixed", function (t) { return function () { return t(this, "tt", "", "") } }) }, function (t, n, r) { "use strict"; r(28)("fontcolor", function (n) { return function (t) { return n(this, "font", "color", t) } }) }, function (t, n, r) { "use strict"; r(28)("fontsize", function (n) { return function (t) { return n(this, "font", "size", t) } }) }, function (t, n, r) { var e = r(1), o = r(78), u = String.fromCharCode, i = String.fromCodePoint; e(e.S + e.F * (!!i && 1 != i.length), "String", { fromCodePoint: function (t) { for (var n, r = [], e = arguments.length, i = 0; i < e;) { if (n = +arguments[i++], o(n, 1114111) !== n) throw RangeError(n + " is not a valid code point"); r.push(n < 65536 ? u(n) : u(55296 + ((n -= 65536) >> 10), n % 1024 + 56320)) } return r.join("") } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(155); e(e.P + e.F * r(142)("includes"), "String", { includes: function (t) { return !!~i(this, t, "includes").indexOf(t, 1 < arguments.length ? arguments[1] : void 0) } }) }, function (t, n, r) { "use strict"; r(28)("italics", function (t) { return function () { return t(this, "i", "", "") } }) }, function (t, n, r) { "use strict"; var e = r(131)(!0); r(147)(String, "String", function (t) { this._t = String(t), this._i = 0 }, function () { var t, n = this._t, r = this._i; return r >= n.length ? { value: void 0, done: !0 } : (t = e(n, r), this._i += t.length, { value: t, done: !1 }) }) }, function (t, n, r) { "use strict"; r(28)("link", function (n) { return function (t) { return n(this, "a", "href", t) } }) }, function (t, n, r) { var e = r(1), u = r(33), c = r(8); e(e.S, "String", { raw: function (t) { for (var n = u(t.raw), r = c(n.length), e = arguments.length, i = [], o = 0; o < r;)i.push(String(n[o++])), o < e && i.push(String(arguments[o])); return i.join("") } }) }, function (t, n, r) { var e = r(1); e(e.P, "String", { repeat: r(156) }) }, function (t, n, r) { "use strict"; r(28)("small", function (t) { return function () { return t(this, "small", "", "") } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(8), o = r(155), u = "startsWith", c = ""[u]; e(e.P + e.F * r(142)(u), "String", { startsWith: function (t) { var n = o(this, t, u), r = i(Math.min(1 < arguments.length ? arguments[1] : void 0, n.length)), e = String(t); return c ? c.call(n, e, r) : n.slice(r, r + e.length) === e } }) }, function (t, n, r) { "use strict"; r(28)("strike", function (t) { return function () { return t(this, "strike", "", "") } }) }, function (t, n, r) { "use strict"; r(28)("sub", function (t) { return function () { return t(this, "sub", "", "") } }) }, function (t, n, r) { "use strict"; r(28)("sup", function (t) { return function () { return t(this, "sup", "", "") } }) }, function (t, n, r) { "use strict"; r(84)("trim", function (t) { return function () { return t(this, 3) } }) }, function (t, n, r) { "use strict"; var e = r(3), u = r(30), i = r(10), o = r(1), c = r(27), f = r(69).KEY, a = r(4), s = r(118), l = r(83), h = r(79), v = r(7), p = r(195), d = r(160), y = r(218), g = r(123), b = r(2), x = r(5), m = r(17), S = r(33), w = r(53), _ = r(75), O = r(72), E = r(184), M = r(31), P = r(127), j = r(11), F = r(74), A = M.f, I = j.f, L = E.f, N = e.Symbol, T = e.JSON, k = T && T.stringify, R = "prototype", C = v("_hidden"), D = v("toPrimitive"), G = {}.propertyIsEnumerable, W = s("symbol-registry"), U = s("symbols"), V = s("op-symbols"), B = Object[R], q = "function" == typeof N && !!P.f, z = e.QObject, K = !z || !z[R] || !z[R].findChild, H = i && a(function () { return 7 != O(I({}, "a", { get: function () { return I(this, "a", { value: 7 }).a } })).a }) ? function (t, n, r) { var e = A(B, n); e && delete B[n], I(t, n, r), e && t !== B && I(B, n, e) } : I, J = function (t) { var n = U[t] = O(N[R]); return n._k = t, n }, $ = q && "symbol" == typeof N.iterator ? function (t) { return "symbol" == typeof t } : function (t) { return t instanceof N }, Y = function (t, n, r) { return t === B && Y(V, n, r), b(t), n = w(n, !0), b(r), u(U, n) ? (r.enumerable ? (u(t, C) && t[C][n] && (t[C][n] = !1), r = O(r, { enumerable: _(0, !1) })) : (u(t, C) || I(t, C, _(1, {})), t[C][n] = !0), H(t, n, r)) : I(t, n, r) }, X = function (t, n) { b(t); for (var r, e = y(n = S(n)), i = 0, o = e.length; i < o;)Y(t, r = e[i++], n[r]); return t }, Q = function (t) { var n = G.call(this, t = w(t, !0)); return !(this === B && u(U, t) && !u(V, t)) && (!(n || !u(this, t) || !u(U, t) || u(this, C) && this[C][t]) || n) }, Z = function (t, n) { if (t = S(t), n = w(n, !0), t !== B || !u(U, n) || u(V, n)) { var r = A(t, n); return !r || !u(U, n) || u(t, C) && t[C][n] || (r.enumerable = !0), r } }, tt = function (t) { for (var n, r = L(S(t)), e = [], i = 0; r.length > i;)u(U, n = r[i++]) || n == C || n == f || e.push(n); return e }, nt = function (t) { for (var n, r = t === B, e = L(r ? V : S(t)), i = [], o = 0; e.length > o;)!u(U, n = e[o++]) || r && !u(B, n) || i.push(U[n]); return i }; q || (c((N = function () { if (this instanceof N) throw TypeError("Symbol is not a constructor!"); var n = h(0 < arguments.length ? arguments[0] : void 0), r = function (t) { this === B && r.call(V, t), u(this, C) && u(this[C], n) && (this[C][n] = !1), H(this, n, _(1, t)) }; return i && K && H(B, n, { configurable: !0, set: r }), J(n) })[R], "toString", function () { return this._k }), M.f = Z, j.f = Y, r(73).f = E.f = tt, r(117).f = Q, P.f = nt, i && !r(68) && c(B, "propertyIsEnumerable", Q, !0), p.f = function (t) { return J(v(t)) }), o(o.G + o.W + o.F * !q, { Symbol: N }); for (var rt = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), et = 0; rt.length > et;)v(rt[et++]); for (var it = F(v.store), ot = 0; it.length > ot;)d(it[ot++]); o(o.S + o.F * !q, "Symbol", { for: function (t) { return u(W, t += "") ? W[t] : W[t] = N(t) }, keyFor: function (t) { if (!$(t)) throw TypeError(t + " is not a symbol!"); for (var n in W) if (W[n] === t) return n }, useSetter: function () { K = !0 }, useSimple: function () { K = !1 } }), o(o.S + o.F * !q, "Object", { create: function (t, n) { return void 0 === n ? O(t) : X(O(t), n) }, defineProperty: Y, defineProperties: X, getOwnPropertyDescriptor: Z, getOwnPropertyNames: tt, getOwnPropertySymbols: nt }); var ut = a(function () { P.f(1) }); o(o.S + o.F * ut, "Object", { getOwnPropertySymbols: function (t) { return P.f(m(t)) } }), T && o(o.S + o.F * (!q || a(function () { var t = N(); return "[null]" != k([t]) || "{}" != k({ a: t }) || "{}" != k(Object(t)) })), "JSON", { stringify: function (t) { for (var n, r, e = [t], i = 1; arguments.length > i;)e.push(arguments[i++]); if (r = n = e[1], (x(n) || void 0 !== t) && !$(t)) return g(n) || (n = function (t, n) { if ("function" == typeof r && (n = r.call(this, t, n)), !$(n)) return n }), e[1] = n, k.apply(T, e) } }), N[R][D] || r(26)(N[R], D, N[R].valueOf), l(N, "Symbol"), l(Math, "Math", !0), l(e.JSON, "JSON", !0) }, function (t, n, r) { "use strict"; var e = r(1), i = r(132), o = r(159), a = r(2), s = r(78), l = r(8), u = r(5), c = r(3).ArrayBuffer, h = r(119), v = o.ArrayBuffer, p = o.DataView, f = i.ABV && c.isView, d = v.prototype.slice, y = i.VIEW, g = "ArrayBuffer"; e(e.G + e.W + e.F * (c !== v), { ArrayBuffer: v }), e(e.S + e.F * !i.CONSTR, g, { isView: function (t) { return f && f(t) || u(t) && y in t } }), e(e.P + e.U + e.F * r(4)(function () { return !new v(2).slice(1, void 0).byteLength }), g, { slice: function (t, n) { if (void 0 !== d && void 0 === n) return d.call(a(this), t); for (var r = a(this).byteLength, e = s(t, r), i = s(void 0 === n ? r : n, r), o = new (h(this, v))(l(i - e)), u = new p(this), c = new p(o), f = 0; e < i;)c.setUint8(f++, u.getUint8(e++)); return o } }), r(77)(g) }, function (t, n, r) { var e = r(1); e(e.G + e.W + e.F * !r(132).ABV, { DataView: r(159).DataView }) }, function (t, n, r) { r(57)("Float32", 4, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Float64", 8, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Int16", 2, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Int32", 4, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Int8", 1, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Uint16", 2, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Uint32", 4, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Uint8", 1, function (e) { return function (t, n, r) { return e(this, t, n, r) } }) }, function (t, n, r) { r(57)("Uint8", 1, function (e) { return function (t, n, r) { return e(this, t, n, r) } }, !0) }, function (t, n, r) { "use strict"; var e = r(172), i = r(80); r(121)("WeakSet", function (t) { return function () { return t(this, 0 < arguments.length ? arguments[0] : void 0) } }, { add: function (t) { return e.def(i(this, "WeakSet"), t, !0) } }, e, !1, !0) }, function (t, n, r) { "use strict"; var e = r(1), i = r(173), o = r(17), u = r(8), c = r(21), f = r(138); e(e.P, "Array", { flatMap: function (t) { var n, r, e = o(this); return c(t), n = u(e.length), r = f(e, 0), i(r, e, e, n, 0, 1, t, arguments[1]), r } }), r(67)("flatMap") }, function (t, n, r) { "use strict"; var e = r(1), i = r(173), o = r(17), u = r(8), c = r(49), f = r(138); e(e.P, "Array", { flatten: function () { var t = arguments[0], n = o(this), r = u(n.length), e = f(n, 0); return i(e, n, n, r, 0, void 0 === t ? 1 : c(t)), e } }), r(67)("flatten") }, function (t, n, r) { "use strict"; var e = r(1), i = r(120)(!0); e(e.P, "Array", { includes: function (t) { return i(this, t, 1 < arguments.length ? arguments[1] : void 0) } }), r(67)("includes") }, function (t, n, r) { var e = r(1), i = r(150)(), o = r(3).process, u = "process" == r(45)(o); e(e.G, { asap: function (t) { var n = u && o.domain; i(n ? n.bind(t) : t) } }) }, function (t, n, r) { var e = r(1), i = r(45); e(e.S, "Error", { isError: function (t) { return "Error" === i(t) } }) }, function (t, n, r) { var e = r(1); e(e.G, { global: r(3) }) }, function (t, n, r) { r(129)("Map") }, function (t, n, r) { r(130)("Map") }, function (t, n, r) { var e = r(1); e(e.P + e.R, "Map", { toJSON: r(171)("Map") }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { clamp: function (t, n, r) { return Math.min(r, Math.max(n, t)) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { DEG_PER_RAD: Math.PI / 180 }) }, function (t, n, r) { var e = r(1), i = 180 / Math.PI; e(e.S, "Math", { degrees: function (t) { return t * i } }) }, function (t, n, r) { var e = r(1), o = r(181), u = r(179); e(e.S, "Math", { fscale: function (t, n, r, e, i) { return u(o(t, n, r, e, i)) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { iaddh: function (t, n, r, e) { var i = t >>> 0, o = r >>> 0; return (n >>> 0) + (e >>> 0) + ((i & o | (i | o) & ~(i + o >>> 0)) >>> 31) | 0 } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { imulh: function (t, n) { var r = +t, e = +n, i = 65535 & r, o = 65535 & e, u = r >> 16, c = e >> 16, f = (u * o >>> 0) + (i * o >>> 16); return u * c + (f >> 16) + ((i * c >>> 0) + (65535 & f) >> 16) } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { isubh: function (t, n, r, e) { var i = t >>> 0, o = r >>> 0; return (n >>> 0) - (e >>> 0) - ((~i & o | ~(i ^ o) & i - o >>> 0) >>> 31) | 0 } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { RAD_PER_DEG: 180 / Math.PI }) }, function (t, n, r) { var e = r(1), i = Math.PI / 180; e(e.S, "Math", { radians: function (t) { return t * i } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { scale: r(181) }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { signbit: function (t) { return (t = +t) != t ? t : 0 == t ? 1 / t == 1 / 0 : 0 < t } }) }, function (t, n, r) { var e = r(1); e(e.S, "Math", { umulh: function (t, n) { var r = +t, e = +n, i = 65535 & r, o = 65535 & e, u = r >>> 16, c = e >>> 16, f = (u * o >>> 0) + (i * o >>> 16); return u * c + (f >>> 16) + ((i * c >>> 0) + (65535 & f) >>> 16) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(17), o = r(21), u = r(11); r(10) && e(e.P + r(126), "Object", { __defineGetter__: function (t, n) { u.f(i(this), t, { get: o(n), enumerable: !0, configurable: !0 }) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(17), o = r(21), u = r(11); r(10) && e(e.P + r(126), "Object", { __defineSetter__: function (t, n) { u.f(i(this), t, { set: o(n), enumerable: !0, configurable: !0 }) } }) }, function (t, n, r) { var e = r(1), i = r(186)(!0); e(e.S, "Object", { entries: function (t) { return i(t) } }) }, function (t, n, r) { var e = r(1), f = r(187), a = r(33), s = r(31), l = r(139); e(e.S, "Object", { getOwnPropertyDescriptors: function (t) { for (var n, r, e = a(t), i = s.f, o = f(e), u = {}, c = 0; o.length > c;)void 0 !== (r = i(e, n = o[c++])) && l(u, n, r); return u } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(17), o = r(53), u = r(32), c = r(31).f; r(10) && e(e.P + r(126), "Object", { __lookupGetter__: function (t) { var n, r = i(this), e = o(t, !0); do { if (n = c(r, e)) return n.get } while (r = u(r)) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(17), o = r(53), u = r(32), c = r(31).f; r(10) && e(e.P + r(126), "Object", { __lookupSetter__: function (t) { var n, r = i(this), e = o(t, !0); do { if (n = c(r, e)) return n.set } while (r = u(r)) } }) }, function (t, n, r) { var e = r(1), i = r(186)(!1); e(e.S, "Object", { values: function (t) { return i(t) } }) }, function (t, n, r) { "use strict"; var e = r(1), o = r(3), u = r(46), i = r(150)(), c = r(7)("observable"), f = r(21), a = r(2), s = r(70), l = r(76), h = r(26), v = r(71), p = v.RETURN, d = function (t) { return null == t ? void 0 : f(t) }, y = function (t) { var n = t._c; n && (t._c = void 0, n()) }, g = function (t) { return void 0 === t._o }, b = function (t) { g(t) || (t._o = void 0, y(t)) }, x = function (t, n) { a(t), this._c = void 0, this._o = t, t = new m(this); try { var r = n(t), e = r; null != r && ("function" == typeof r.unsubscribe ? r = function () { e.unsubscribe() } : f(r), this._c = r) } catch (n) { return void t.error(n) } g(this) && y(this) }; x.prototype = l({}, { unsubscribe: function () { b(this) } }); var m = function (t) { this._s = t }; m.prototype = l({}, { next: function (t) { var n = this._s; if (!g(n)) { var r = n._o; try { var e = d(r.next); if (e) return e.call(r, t) } catch (t) { try { b(n) } finally { throw t } } } }, error: function (t) { var n = this._s; if (g(n)) throw t; var r = n._o; n._o = void 0; try { var e = d(r.error); if (!e) throw t; t = e.call(r, t) } catch (t) { try { y(n) } finally { throw t } } return y(n), t }, complete: function (t) { var n = this._s; if (!g(n)) { var r = n._o; n._o = void 0; try { var e = d(r.complete); t = e ? e.call(r, t) : void 0 } catch (t) { try { y(n) } finally { throw t } } return y(n), t } } }); var S = function (t) { s(this, S, "Observable", "_f")._f = f(t) }; l(S.prototype, { subscribe: function (t) { return new x(t, this._f) }, forEach: function (e) { var i = this; return new (u.Promise || o.Promise)(function (t, n) { f(e); var r = i.subscribe({ next: function (t) { try { return e(t) } catch (t) { n(t), r.unsubscribe() } }, error: n, complete: t }) }) } }), l(S, { from: function (t) { var n = "function" == typeof this ? this : S, r = d(a(t)[c]); if (r) { var e = a(r.call(t)); return e.constructor === n ? e : new n(function (t) { return e.subscribe(t) }) } return new n(function (n) { var r = !1; return i(function () { if (!r) { try { if (v(t, !1, function (t) { if (n.next(t), r) return p }) === p) return } catch (t) { if (r) throw t; return void n.error(t) } n.complete() } }), function () { r = !0 } }) }, of: function () { for (var t = 0, n = arguments.length, e = new Array(n); t < n;)e[t] = arguments[t++]; return new ("function" == typeof this ? this : S)(function (n) { var r = !1; return i(function () { if (!r) { for (var t = 0; t < e.length; ++t)if (n.next(e[t]), r) return; n.complete() } }), function () { r = !0 } }) } }), h(S.prototype, c, function () { return this }), e(e.G, { Observable: S }), r(77)("Observable") }, function (t, n, r) { "use strict"; var e = r(1), i = r(46), o = r(3), u = r(119), c = r(191); e(e.P + e.R, "Promise", { finally: function (n) { var r = u(this, i.Promise || o.Promise), t = "function" == typeof n; return this.then(t ? function (t) { return c(r, n()).then(function () { return t }) } : n, t ? function (t) { return c(r, n()).then(function () { throw t }) } : n) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(151), o = r(190); e(e.S, "Promise", { try: function (t) { var n = i.f(this), r = o(t); return (r.e ? n.reject : n.resolve)(r.v), n.promise } }) }, function (t, n, r) { var e = r(56), i = r(2), o = e.key, u = e.set; e.exp({ defineMetadata: function (t, n, r, e) { u(t, n, i(r), o(e)) } }) }, function (t, n, r) { var e = r(56), o = r(2), u = e.key, c = e.map, f = e.store; e.exp({ deleteMetadata: function (t, n) { var r = arguments.length < 3 ? void 0 : u(arguments[2]), e = c(o(n), r, !1); if (void 0 === e || !e.delete(t)) return !1; if (e.size) return !0; var i = f.get(n); return i.delete(r), !!i.size || f.delete(n) } }) }, function (t, n, r) { var o = r(199), u = r(167), e = r(56), i = r(2), c = r(32), f = e.keys, a = e.key, s = function (t, n) { var r = f(t, n), e = c(t); if (null === e) return r; var i = s(e, n); return i.length ? r.length ? u(new o(r.concat(i))) : i : r }; e.exp({ getMetadataKeys: function (t) { return s(i(t), arguments.length < 2 ? void 0 : a(arguments[1])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = r(32), u = e.has, c = e.get, f = e.key, a = function (t, n, r) { if (u(t, n, r)) return c(t, n, r); var e = o(n); return null !== e ? a(t, e, r) : void 0 }; e.exp({ getMetadata: function (t, n) { return a(t, i(n), arguments.length < 3 ? void 0 : f(arguments[2])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = e.keys, u = e.key; e.exp({ getOwnMetadataKeys: function (t) { return o(i(t), arguments.length < 2 ? void 0 : u(arguments[1])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = e.get, u = e.key; e.exp({ getOwnMetadata: function (t, n) { return o(t, i(n), arguments.length < 3 ? void 0 : u(arguments[2])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = r(32), u = e.has, c = e.key, f = function (t, n, r) { if (u(t, n, r)) return !0; var e = o(n); return null !== e && f(t, e, r) }; e.exp({ hasMetadata: function (t, n) { return f(t, i(n), arguments.length < 3 ? void 0 : c(arguments[2])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = e.has, u = e.key; e.exp({ hasOwnMetadata: function (t, n) { return o(t, i(n), arguments.length < 3 ? void 0 : u(arguments[2])) } }) }, function (t, n, r) { var e = r(56), i = r(2), o = r(21), u = e.key, c = e.set; e.exp({ metadata: function (r, e) { return function (t, n) { c(r, e, (void 0 !== n ? i : o)(t), u(n)) } } }) }, function (t, n, r) { r(129)("Set") }, function (t, n, r) { r(130)("Set") }, function (t, n, r) { var e = r(1); e(e.P + e.R, "Set", { toJSON: r(171)("Set") }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(131)(!0); e(e.P, "String", { at: function (t) { return i(this, t) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(51), o = r(8), u = r(124), c = r(115), f = RegExp.prototype, a = function (t, n) { this._r = t, this._s = n }; r(146)(a, "RegExp String", function () { var t = this._r.exec(this._s); return { value: t, done: null === t } }), e(e.P, "String", { matchAll: function (t) { if (i(this), !u(t)) throw TypeError(t + " is not a regexp!"); var n = String(this), r = "flags" in f ? String(t.flags) : c.call(t), e = new RegExp(t.source, ~r.indexOf("g") ? r : "g" + r); return e.lastIndex = o(t.lastIndex), new a(e, n) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(193), o = r(133), u = /Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o); e(e.P + e.F * u, "String", { padEnd: function (t) { return i(this, t, 1 < arguments.length ? arguments[1] : void 0, !1) } }) }, function (t, n, r) { "use strict"; var e = r(1), i = r(193), o = r(133), u = /Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o); e(e.P + e.F * u, "String", { padStart: function (t) { return i(this, t, 1 < arguments.length ? arguments[1] : void 0, !0) } }) }, function (t, n, r) { "use strict"; r(84)("trimLeft", function (t) { return function () { return t(this, 1) } }, "trimStart") }, function (t, n, r) { "use strict"; r(84)("trimRight", function (t) { return function () { return t(this, 2) } }, "trimEnd") }, function (t, n, r) { r(160)("asyncIterator") }, function (t, n, r) { r(160)("observable") }, function (t, n, r) { var e = r(1); e(e.S, "System", { global: r(3) }) }, function (t, n, r) { r(129)("WeakMap") }, function (t, n, r) { r(130)("WeakMap") }, function (t, n, r) { r(129)("WeakSet") }, function (t, n, r) { r(130)("WeakSet") }, function (t, n, r) { for (var e = r(162), i = r(74), o = r(27), u = r(3), c = r(26), f = r(82), a = r(7), s = a("iterator"), l = a("toStringTag"), h = f.Array, v = { CSSRuleList: !0, CSSStyleDeclaration: !1, CSSValueList: !1, ClientRectList: !1, DOMRectList: !1, DOMStringList: !1, DOMTokenList: !0, DataTransferItemList: !1, FileList: !1, HTMLAllCollection: !1, HTMLCollection: !1, HTMLFormElement: !1, HTMLSelectElement: !1, MediaList: !0, MimeTypeArray: !1, NamedNodeMap: !1, NodeList: !0, PaintRequestList: !1, Plugin: !1, PluginArray: !1, SVGLengthList: !1, SVGNumberList: !1, SVGPathSegList: !1, SVGPointList: !1, SVGStringList: !1, SVGTransformList: !1, SourceBufferList: !1, StyleSheetList: !0, TextTrackCueList: !1, TextTrackList: !1, TouchList: !1 }, p = i(v), d = 0; d < p.length; d++) { var y, g = p[d], b = v[g], x = u[g], m = x && x.prototype; if (m && (m[s] || c(m, s, h), m[l] || c(m, l, g), f[g] = h, b)) for (y in e) m[y] || o(m, y, e[y], !0) } }, function (t, n, r) { var e = r(1), i = r(158); e(e.G + e.B, { setImmediate: i.set, clearImmediate: i.clear }) }, function (t, n, r) { var e = r(3), i = r(1), o = r(133), u = [].slice, c = /MSIE .\./.test(o), f = function (i) { return function (t, n) { var r = 2 < arguments.length, e = !!r && u.call(arguments, 2); return i(r ? function () { ("function" == typeof t ? t : Function(t)).apply(this, e) } : t, n) } }; i(i.G + i.B + i.F * c, { setTimeout: f(e.setTimeout), setInterval: f(e.setInterval) }) }, function (t, n, r) { r(341), r(280), r(282), r(281), r(284), r(286), r(291), r(285), r(283), r(293), r(292), r(288), r(289), r(287), r(279), r(290), r(294), r(295), r(247), r(249), r(248), r(297), r(296), r(267), r(277), r(278), r(268), r(269), r(270), r(271), r(272), r(273), r(274), r(275), r(276), r(250), r(251), r(252), r(253), r(254), r(255), r(256), r(257), r(258), r(259), r(260), r(261), r(262), r(263), r(264), r(265), r(266), r(328), r(333), r(340), r(331), r(323), r(324), r(329), r(334), r(336), r(319), r(320), r(321), r(322), r(325), r(326), r(327), r(330), r(332), r(335), r(337), r(338), r(339), r(242), r(244), r(243), r(246), r(245), r(231), r(229), r(235), r(232), r(238), r(240), r(228), r(234), r(225), r(239), r(223), r(237), r(236), r(230), r(233), r(222), r(224), r(227), r(226), r(241), r(162), r(313), r(197), r(318), r(198), r(314), r(315), r(316), r(317), r(298), r(196), r(199), r(200), r(353), r(342), r(343), r(348), r(351), r(352), r(346), r(349), r(347), r(350), r(344), r(345), r(299), r(300), r(301), r(302), r(303), r(306), r(304), r(305), r(307), r(308), r(309), r(310), r(312), r(311), r(356), r(354), r(355), r(397), r(400), r(399), r(401), r(402), r(398), r(403), r(404), r(378), r(381), r(377), r(375), r(376), r(379), r(380), r(362), r(396), r(361), r(395), r(407), r(409), r(360), r(394), r(406), r(408), r(359), r(405), r(358), r(363), r(364), r(365), r(366), r(367), r(369), r(368), r(370), r(371), r(372), r(374), r(373), r(383), r(384), r(385), r(386), r(388), r(387), r(390), r(389), r(391), r(392), r(393), r(357), r(382), r(412), r(411), r(410), t.exports = r(46) }, function (t, n) { t.exports = function (t, n) { if ("string" == typeof n) return t.insertAdjacentHTML("afterend", n); var r = t.nextSibling; return r ? t.parentNode.insertBefore(n, r) : t.parentNode.appendChild(n) } }])</script>
<script src="/./main.a5fda8.js"></script>
<script>!function () { var e, t; e = "/slider.27463f.js", t = document.createElement("script"), document.getElementsByTagName("body")[0].appendChild(t), t.setAttribute("src", e) }()</script>

	
				
					<!--  -->
					
<script>
  /* 标签页标题切换 */
  var originTitle = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
      document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
      titleTime = setTimeout(function () {
        document.title = originTitle;
      }, 2000);
    }
  });
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">html</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">js</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">css</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">egg</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">vue</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">javascript</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">elementUI</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Echar</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia-plus根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://blog.csdn.net/xycy123_com?spm=1010.2135.3001.5343&type=blog" target="_blank" 
                class="search-title" title="记录工作和学习过程中的笔记：Java、前端开发、Hexo博客、软件测试、Linux笔记">
                
                  <img src="https://zhousiwei.gitee.io/ibooks/favicon.ico">
                
                技术笔记
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://github.com/yixiangxiao" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                GitHub
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://gitee.com/xiao-yixiang" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                码云
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://allenchenblog.cn" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                AllenChen
              </a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
        
          
  	  		<div class="aboutme-wrap" id="aboutme">主要涉及技术：<br>web前端开发、软件测试、<br>公众号开发、开源爱好者、Linux<br><br>联系QQ:2324094523<br><br>很惭愧<br><br>只做了一点微小的工作<br>谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>

  
  
<script type="text/javascript" src="/plugins/activate-power-mode/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = false; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>

  
  <!-- <script async type="text/javascript" size="90" alpha="0.2" zIndex="0" src="/plugins/ribbon.js/ribbon.min.js"></script> -->
  
  
    <script type="text/javascript" src="/plugins/live2d-widget.js/L2Dwidget.min.js"></script>
<script type="text/javascript">
  /**
   * 完整配置请参考：https://l2dwidget.js.org/docs/class/src/index.js~L2Dwidget.html#instance-method-init
   */
  var pluginModelPath = "assets/", // 模型的文件路径，无需更改
    pluginRootPath = "/live2d_models/"; // 插件的路径，无需更改
  //特定的模型json文件名称
  var modelPathJson = {
    "epsilon2_1": "Epsilon2.1",
    "gf": "Gantzert_Felixander",
    "haru/01": "haru01",
    "haru/02": "haru02",
    "nietzsche": "nietzche"
  }

  
    var modelName = "hibiki";
  

  var modelJsonPath = "";
  if (modelPathJson[modelName]) {
    modelJsonPath = pluginRootPath + modelName + "/" + pluginModelPath + modelPathJson[modelName] +
      ".model.json";
  } else {
    modelJsonPath = pluginRootPath + modelName + "/" + pluginModelPath + modelName + ".model.json";
  }
  L2Dwidget.init({
    model: {
      jsonPath: modelJsonPath
    },
    display: {
       position: "left", 
       width: 145, 
       height: 315, 
      
      
    },
    mobile: {
      
       scale: 0.6 
    },
    react: {
       opacity: 0.8 
    }
  })

</script>

  
  
  <script type="text/javascript" src="/lib/snow.js"></script>
  <script type="text/javascript" src="/lib/jquery-2.1.4.min.js"></script>
  <script>
    snow.down();
    $(window).resize(function() {
      $("canvas").css("z-index","500").remove();
      snow.down();
    });
  </script>
  
</body>

</html>
